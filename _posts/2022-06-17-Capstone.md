---
layout: post
title:  "Capstone"
date:   2022-06-17
image:  /posts/capstone.png
tags:   SpringBoot Project
---

## Project Description

[Description.pdf]({{site.baseurl}}/images/posts/post-220617/description.pdf)

![]({{site.baseurl}}/images/posts/post-220617/Untitled.png)

![]({{site.baseurl}}/images/posts/post-220617/Untitled 1.png)

## Project Setting

![]({{site.baseurl}}/images/posts/post-220617/Untitled 2.png)


- Gradle Project, Java(ver 11), Spring Boot(ver 2.7.0)
- Spring MVC - Spring Web
- Annotation library - Lombok
- View Template - Thymeleaf
- DataBase - H2 Database (SQL), Spring Data JPA, AWS RDS (SQL)

- ìŠ¤í”„ë§ ë¶€íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬
    - spring-boot-starter-web
        - spring-boot-starter-tomcat: í†°ìº£ (ì›¹ì„œë²„)
        - spring-webmvc: ìŠ¤í”„ë§ ì›¹ MVC
    - spring-boot-starter-thymeleaf: íƒ€ì„ë¦¬í”„ í…œí”Œë¦¿ ì—”ì§„(View)
    - spring-boot-starter(ê³µí†µ): ìŠ¤í”„ë§ ë¶€íŠ¸ + ìŠ¤í”„ë§ ì½”ì–´ + ë¡œê¹…
    - spring-boot
        - spring-core
    - spring-boot-starter-logging
    logback, slf4j

- í…ŒìŠ¤íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬
    - spring-boot-starter-test
        - junit : í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬
        - mockito : ëª© ë¼ì´ë¸ŒëŸ¬ë¦¬
        - aseertj : : í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì¢€ ë” í¸í•˜ê²Œ ì‘ì„±í•˜ê²Œ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
        - spring-test : ìŠ¤í”„ë§ í†µí•© í…ŒìŠ¤íŠ¸ ì§€ì›

- Gradle (build.gradle)
    
    ```java
    plugins {
    	id 'org.springframework.boot' version '2.6.4'
    	id 'io.spring.dependency-management' version '1.0.11.RELEASE'
    	id 'java'
    }
    
    group = 'Talk_with'
    version = '0.0.1-SNAPSHOT'
    sourceCompatibility = '11'
    
    configurations {
    	compileOnly {
    		extendsFrom annotationProcessor
    	}
    }
    
    repositories {
    	mavenCentral()
    }
    
    dependencies {
    	implementation 'org.springframework.boot:spring-boot-starter-data-jpa' //spring-data-jpa
    	implementation 'org.springframework.boot:spring-boot-starter-thymeleaf' //veiw template
    	implementation 'org.springframework.boot:spring-boot-starter-web' // spring-web
    	implementation 'org.springframework.boot:spring-boot-devtools' // for easy rebuilding
    	implementation 'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.8.0' //for tracking sql query
    	runtimeOnly 'mysql:mysql-connector-java' // for AWS RDS
    	// implementation 'com.h2database:h2' // for Test _ in Local DB
    	annotationProcessor 'org.projectlombok:lombok' // for annotation
    	testImplementation 'org.springframework.boot:spring-boot-starter-test' // spring-test
    
    	// AWS SDK (Using S3)
    	implementation platform('com.amazonaws:aws-java-sdk-bom:1.11.1000')
    	implementation 'com.amazonaws:aws-java-sdk-s3'
    }
    
    tasks.named('test') {
    	useJUnitPlatform()
    }
    ```
    

- application.yml
    
    ```yaml
    spring:
      datasource:
        url:  jdbc:mysql://${DB_URL}:3306/capstone # jdbc:h2:tcp://localhost/~/capstone
        username: ${DB_NAME} # park
        password: ${DB_PASSWORD} # 
        driver-class-name: com.mysql.cj.jdbc.Driver # org.h2.Driver
    
      jpa:
        hibernate:
          ddl-auto : update
        properties:
          hibernate:
            format_sql : true
    
    logging:
      level:
        org.hibernate.SQL: debug
    #    org.hibernate.type: trace # p6spyë¡œ ëŒ€ì²´
    ```
    

## Domain Analysis

### ìš”êµ¬ì‚¬í•­ ë¶„ì„

- ê¸°ëŠ¥ ëª©ë¡
    1. ë¼ì´ë¸Œ ì§€ë„ ê¸°ëŠ¥
        - ì‹¤ì‹œê°„ ì¸ì› ì¸¡ì • ë° í˜¼ì¡ë„
        - ì‹¤ì‹œê°„Â ë“œë¡  ì¸¡ì • ìœ„ì¹˜ ì•Œë¦¼
        - ì¢Œí‘œì— ë”°ë¥¸ ì¥ì†Œ ì •ë³´ ì œê³µ
    2. ë¼ì´ë¸Œ í†µê³„ ê¸°ëŠ¥
        - ì‹¤ì‹œê°„ ì¸ì› ë³€í™”ëŸ‰ ì œê³µ
        - ëˆ„ì  ë°ì´í„° í†µê³„ëŸ‰ ì œê³µ

### ë„ë©”ì¸ ëª¨ë¸ê³¼ í…Œì´ë¸” ì„¤ê³„ ë° ë¶„ì„

- ë„ë©”ì¸ ëª¨ë¸ ì„¤ê³„ ë° ë¶„ì„

  ![]({{site.baseurl}}/images/posts/post-220617/Untitled 3.png)
    
    â€œì¥ì†Œâ€ì™€ â€œê²€ì¶œ ê°ì²´â€ì˜ ê´€ê³„
    
    - í•˜ë‚˜ì˜ ì¥ì†Œì— ì—¬ëŸ¬ ê²€ì¶œ ê°ì²´ê°€ Mapping ë¨
    - ê²€ì¶œ ê°ì²´ì˜ ì¢Œí‘œ(ìœ„ë„, ê²½ë„)ì— ë”°ë¼ ì¥ì†Œì— Mapping

- ì—”í‹°í‹° ì„¤ê³„ ë° ë¶„ì„

  ![]({{site.baseurl}}/images/posts/post-220617/Untitled 4.png)
    
    - ì¥ì†Œ(Point)
        - ì¥ì†Œ ì •ë³´ : id(ì‹ë³„ì), place(ì¥ì†Œ ëª…), percentage(í˜¼ì¡ë„), count(ì‹¤ì‹œê°„ ì¸ì›), avgCount(í‰ê·  ì¸ì›), imgSrc(ì¥ì†Œ ì‚¬ì§„), latitude(ìœ„ë„), longitude(ê²½ë„)
        - ìœ„ì¹˜ ì •ë³´ [ì‚¬ê°í˜• ë²”ìœ„] : latTopLeft(ì¢Œìƒë‹¨ ìœ„ë„), lonTopLeft(ì¢Œìƒë‹¨ ê²½ë„), latBottRight(ìš°í•˜ë‹¨ ìœ„ë„), lonBottRight(ìš°í•˜ë‹¨ ê²½ë„)
        - ìµœê·¼ ê´€ë ¨ ë°ì´í„°(ê²€ì¶œ ê°ì²´) ë³€ê²½ ì‹œì  : lastCommittedTime(ìƒˆë¡œ ë“¤ì–´ì˜¨ ë°ì´í„°ë¥¼ ì¸ì§€í•˜ê¸° ìœ„í•¨)
        - **ì—°ê´€ ê´€ê³„** : infos(ê²€ì¶œ ê°ì²´ ì •ë³´, `@OneToMany`)
    - ê²€ì¶œ ê°ì²´(Info)
        - ê²€ì¶œ ê°ì²´ ì •ë³´ : date(ê²€ì¶œ ì‹œê°), leftValue(ê°ì²´ ë°•ìŠ¤ ìœ„ì¹˜), topValue(ê°ì²´ ë°•ìŠ¤ ìœ„ì¹˜), widthValue(ê°ì²´ ë°•ìŠ¤ ë„ˆë¹„), heightValue(ê°ì²´ ë°•ìŠ¤ ë†’ì´)
        - ë“œë¡  ì •ë³´: lat(ìœ„ë„), lon(ê²½ë„), droneHeight(ê³ ë„), azimuth(ë°©ìœ„ê°)
        - **ì—°ê´€ ê´€ê³„** : point(ì¥ì†Œ, `@ManyToOne`)
    - ê²€ì¶œ ë°ì´í„°(Temp)
        - Infoì™€ ë™ì¼í•œ fieldë¥¼ ê°€ì§€ê³  ìˆëŠ” Entityì§€ë§Œ, ì—°ê´€ê´€ê³„ê°€ ì„¤ì •ë˜ì–´ ìˆì§€ ì•Šì€ Entity
        - ë“œë¡ ì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ì €ì¥ëœ ë°ì´í„°
        - í•´ë‹¹ ë°ì´í„°ë¥¼ Springì—ì„œ ë¶„ì„ í›„ JPAë¥¼ í†µí•´ ì¥ì†Œ(Point)ì™€ ë§¤í•‘ì‹œì¼œ ìƒˆë¡œìš´ Infoë¥¼ ë§Œë“œëŠ” ê²ƒ
        - ì¦‰, Infoë¥¼ ë§Œë“¤ê¸° ìœ„í•œ ì¼ì‹œì ì¸ ë°ì´í„°

      ![]({{site.baseurl}}/images/posts/post-220617/Untitled 5.png)
        
    
        > ìµœëŒ€í•œ ë‹¨ìˆœí•œ êµ¬ì¡°ë¡œ Entity ìƒì„±
    
    <aside>
    âš ï¸ <strong> êµ³ì´ Temp ì™€ Info 2ê°œì˜ ê²€ì¶œ ê°ì²´,ë°ì´í„° Entityë¥¼ ë§Œë“  ì´ìœ  </strong>
    <ul>
        <li>ë¨¼ì € TempëŠ” ì‹¤ì‹œê°„ìœ¼ë¡œ ë“œë¡ ì—ì„œ ê²€ì¶œëœ ê°ì²´ì˜ ì •ë³´ë¥¼ DBì— ì €ì¥. ì´ë•Œ, ì €ì¥ë˜ëŠ” ìˆœê°„ì— ì—°ê´€ê´€ê³„ë¥¼ íŒë‹¨í•˜ê³  ë§¤í•‘ì„ ì§„í–‰í•˜ê¸°ì—ëŠ” ì–´ë ¤ì›€ì´ ìˆë‹¤ íŒë‹¨í•˜ì—¬, ì¼ë‹¨ ì €ì¥í•œ í›„ í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì— ì •ë³´ë¥¼ ìš”ì²­í•  ê²½ìš° Tempì˜ ì •ë³´ë¥¼ ì´ìš©í•´ì„œ Point(ì¥ì†Œ)ì™€ ì—°ê´€ê´€ê³„ë¥¼ ìƒì„±í•œ í›„ì— Infoë¥¼ ìƒˆë¡œ ì €ì¥í•˜ëŠ” ë¡œì§ìœ¼ë¡œ êµ¬í˜„. ì¦‰, InfoëŠ” Tempì— Pointì˜ ì—°ê´€ê´€ê³„ê°€ ë“¤ì–´ê°„ ë°ì´í„°</li>
        <li>ë˜í•œ, ì‹¤ì‹œê°„ìœ¼ë¡œ ì œê³µí•´ì•¼ ë˜ëŠ” ë°ì´í„°(Temp)ì™€ ëˆ„ì ë˜ì–´ ì œê³µë˜ëŠ” ë°ì´í„°(Info)ì˜ ì°¨ì´ê°€ ìˆìœ¼ë¯€ë¡œ êµ¬ë¶„í•¨</li>
    </ul>
    </aside>
    

- í…Œì´ë¸” ì„¤ê³„ ë° ë¶„ì„

  ![]({{site.baseurl}}/images/posts/post-220617/Untitled 6.png)
    
    - INFO: pointì˜ point_idë¥¼ forigen keyë¡œ ì„¤ì •í•˜ì—¬ ì—°ê²°
    - TEMPì— POINTì™€ì˜ ì—°ê´€ê´€ê³„ ìƒì„±í•˜ì—¬ ë§Œë“  ê²ƒì´ INFO

- ì—”í‹°í‹° í´ë˜ìŠ¤ ì† ì£¼ìš” ë©”ì„œë“œ
    
    > Entity ìƒì„± ë° ìˆ˜ì •ì€ ë˜ë„ë¡ì´ë©´ Entityì•ˆì—ì„œ ì´ë£¨ì–´ì§€ë„ë¡ ì„¤ì •
    > SetterëŠ” ë˜ë„ë¡ì´ë©´ ì—´ì–´ë‘ì§€ ì•Šë„ë¡ ì„¤ì • (ë³€ê²½ì´ë‚˜ ì €ì¥ ìì²´ë¥¼ ì¶”í›„ì— ì¶”ì í•˜ê¸° í¸í•˜ê²Œ ë§Œë“¤ê¸° ìœ„í•¨. [ìœ ì§€ ë³´ìˆ˜])
    

    1. Point(ì¥ì†Œ)
        - ìƒì„± ë©”ì„œë“œ
            
            ìƒì„±í•  ë•Œ í•„ìš”í•œ ê°’ë“¤ë§Œì„ ê°€ì§€ê³  ìƒì„± 
            (PointëŠ” ë¯¸ë¦¬ ìƒì„±í•´ë‘ëŠ” ê°’ì´ë¯€ë¡œ initDBë¥¼ í†µí•´ DBì— ì €ì¥ í›„ ìƒˆë¡œ ìƒì„±í• ë•Œë§Œ ì‚¬ìš©. ì¦‰, Clientì— ì˜í•´ì„œ ìƒì„±ë˜ì§€ ì•ŠìŒ)
            

            ```java
            public static Point createPoint(String place, int percentage, int count, int avgCount, double latitude, double longitude, String imgSrc,
                                            double lonTopLeft, double latTopLeft, double lonBottRight, double latBottRight, LocalDateTime lastCommittedTime) {
                Point point = new Point();
                point.place = place;
                point.percentage = percentage;
                point.count = count;
                point.avgCount = avgCount;
                point.latitude = latitude;
                point.longitude = longitude;
                point.imgSrc = imgSrc;
                point.lonTopLeft = lonTopLeft;
                point.latTopLeft = latTopLeft;
                point.lonBottRight = lonBottRight;
                point.latBottRight = latBottRight;
                point.lastCommittedTime = lastCommittedTime;
                return point;
            }
            ```
            
        - ìˆ˜ì • ë©”ì„œë“œ
            
            ìˆ˜ì •ì— ì‚¬ìš©ë˜ëŠ” ìƒí™©ì— ë”°ë¥¸ ê°’ë“¤ë§Œì„ ê°€ì§€ê³  ìƒì„±
            
            ```java
            public void changeCount(int cnt) {
                this.count = cnt;
            }
            
            public void changePercentage(int percentage) {
                this.percentage = percentage;
            }
            
            public void changeLastCommittedTime(LocalDateTime lastCommittedTime) {
                this.lastCommittedTime = lastCommittedTime;
            }
            ```
            
            - `changeCount` : Mapì—ì„œì˜ ê° Pointì˜ ì‹¤ì‹œê°„ ì¸¡ì • ì¸ì› ìˆ˜ì˜ ë³€í™”ë¥¼ ìœ„í•œ ìˆ˜ì • ë©”ì„œë“œ
            - `changePercentage` : Mapì—ì„œì˜ ê° Pointì˜ ì‹¤ì‹œê°„ í˜¼ì¡ë„ ë³€í™”ë¥¼ ìœ„í•œ ìˆ˜ì • ë©”ì„œë“œ
            - `changeLastCommittedTime` : ê°€ì¥ ìµœê·¼ ì ‘ê·¼ ì‹œê°„ â†’ í•´ë‹¹ ì‹œê°„ ì´í›„ì˜ ë°ì´í„°ë¥¼ ì¸ì§€í•˜ê¸° ìœ„í•¨
    2. Info(ê²€ì¶œ ê°ì²´)
        - ì—°ê´€ê´€ê³„ ë©”ì„œë“œ
            
            Pointì™€ ì–‘ë°©í–¥ ì—°ê´€ ê´€ê³„ : Infoê°€ ìƒì„±ë˜ë©´ Pointì˜ post listì— ë”í•´ì¤„ í•„ìš”ê°€ ìˆìŒ(â†’ í•´ë‹¹ ê²€ì¶œëœ ê°ì²´(Info)ê°€ ì–´ëŠ ì¥ì†Œ(Point)ì˜ ê²€ì¶œ ê²°ê³¼ì¸ì§€ ë§¤í•‘í•˜ê¸° ìœ„í•¨). ì—°ê´€ê´€ê³„ ë©”ì„œë“œëŠ” ìƒì„±ë©”ì„œë“œ ì•ˆì—ì„œë§Œ ì‚¬ìš©ë˜ë„ë¡ privateìœ¼ë¡œ ì„¤ì •
            
            ```java
            private void setPoint(Point point) {
                this.point = point;
                point.getInfos().add(this);
            }
            ```
            
        - ìƒì„± ë©”ì„œë“œ
            
            ì—°ê´€ê´€ê³„ë¥¼ ì´ìš©í•˜ë©° ìƒì„±í•  í•„ìš”ê°€ ìˆìŒ (Pointì™€ì˜ ì—°ê´€ê´€ê³„)
            
            ```java
            public static Info createInfo(Point point, Temp temp) {
                Info info = new Info();
                info.date = temp.getDate();
                info.leftValue = temp.getLeftValue();
                info.topValue = temp.getTopValue();
                info.widthValue = temp.getWidthValue();
                info.heightValue = temp.getHeightValue();
                info.lon = temp.getLon();
                info.lat = temp.getLat();
                info.droneHeight = temp.getDroneHeight();
                info.azimuth = temp.getAzimuth();
                info.setPoint(point);
                return info;
            }
            ```
            
            - ì—°ê´€ê´€ê³„ë¥¼ ìœ„í•´ pointë¥¼ ì¸ìë¡œ ë°›ì•„, í•´ë‹¹ pointì˜ Info Listì— í˜„ì¬ ìƒì„±ë˜ëŠ” info ì¶”ê°€. pointëŠ” í•´ë‹¹ tempì˜ ìœ„ì¹˜ì •ë³´ë¥¼ í†µí•´ ì •í•´ì§„ ì¥ì†Œ(ìœ„ì¹˜)
            - tempëŠ” infoì˜ ëª¨ë“  ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆëŠ” ê°ì²´. í•´ë‹¹ ê°ì²´ì˜ ì •ë³´ë¥¼ ë°›ì•„ì™€ ìœ„ì¹˜ì •ë³´ë¥¼ ë”°ë¼ pointì™€ì˜ ì—°ê´€ê´€ê³„ë¥¼ ì„¤ì •.

## Application Implementation

### êµ¬í˜„ ìš”êµ¬ì‚¬í•­

- ê¸°ëŠ¥ ëª©ë¡
    1. ê³µí†µ ê´€ì‹¬ì‚¬ ì²˜ë¦¬ (Interceptor)
        - ê²€ì¶œ ê°ì²´ì™€ ì¥ì†Œ ë§¤í•‘
    2. Map ê¸°ëŠ¥ (ì§€ë„)
        - ëª¨ë“  ì¥ì†Œ Floating
        - ì¥ì†Œ ì •ë³´ ì œê³µ ( ì‹¤ì‹œê°„ ë³€ê²½ â†’ ì¸¡ì • ì¸ì›, í˜¼ì¡ë„)
        - ì¥ì†Œ ê²€ìƒ‰
    3. Statics ê¸°ëŠ¥ (ë¶„ì„)
        - ì‹¤ì‹œê°„ ì¸¡ì • ì¸ì› ë° ë³€ê²½ ì¸ì› ì œê³µ
        - ëˆ„ì  ë°ì´í„° ë¶„ì„ ì œê³µ
        - ì¥ì†Œ ê²€ìƒ‰

### ì•„í‚¤í…ì³ êµ¬ì„±

![]({{site.baseurl}}/images/posts/post-220617/Untitled 7.png)

- ê³„ì¸µí˜• êµ¬ì¡° ì‚¬ìš©
    - controller, web: ì›¹ ê³„ì¸µ
    - service: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, íŠ¸ëœì­ì…˜ ì²˜ë¦¬
    - repository: JPAë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ê³„ì¸µ, ì—”í‹°í‹° ë§¤ë‹ˆì € ì‚¬ìš©
    - domain: ì—”í‹°í‹°ê°€ ëª¨ì—¬ ìˆëŠ” ê³„ì¸µ, ëª¨ë“  ê³„ì¸µì—ì„œ ì‚¬ìš©
- íŒ¨í‚¤ì§€ êµ¬ì¡°
    
    Group6.capstone
    
    - config : Interceptorê´€ë ¨ ì„¤ì •
    - Interceptor : custom Interceptor êµ¬í˜„
    - controller : web ê³„ì¸µ ê´€ë ¨ êµ¬í˜„
    - service : Business Logic, Transaction ì •ì˜ ë° êµ¬í˜„
    - repository :  EM(JPA), DB connect ì •ì˜ ë° êµ¬í˜„
    - domain : Entity ì •ì˜ ë° êµ¬í˜„

<aside>
ğŸ’¡ <strong>ê°œë°œ ìˆœì„œ</strong> <br>
ì„œë¹„ìŠ¤, ë¦¬í¬ì§€í† ë¦¬ ê³„ì¸µì„ ê°œë°œí•˜ê³ , í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì‘ì„±í•´ì„œ ê²€ì¦(í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” ìƒëµ), ë§ˆì§€ë§‰ì— ì›¹ ê³„ì¸µ ì ìš©
</aside>

### ì¥ì†Œ ë¡œì§ ê°œë°œ (Point)

> êµ¬í˜„ ìˆœì„œ
 - ì¥ì†Œ ë ˆí¬ì§€í† ë¦¬ ê°œë°œ
 - ì¥ì†Œ ì„œë¹„ìŠ¤ ê°œë°œ
> 

Point (Repository, Service)

- ì¥ì†Œ ë ˆí¬ì§€í† ë¦¬ (PointRepository)
    - JPAë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì—¬ Point Entityì™€ ê´€ë ¨ëœ Tableì— ì ‘ê·¼í•˜ëŠ” ê³„ì¸µ
    - DI(Dependency Injection) : EntityManager(JPA)
    - `public List<Point> findAll()` : ëª¨ë“  ì¥ì†Œ ì¡°íšŒ. jpql(`em.createQuery`) ì‚¬ìš©
    - `public Point findOne(Long id)` : idë¥¼ í†µí•´ í•˜ë‚˜ì˜ ì¥ì†Œ ì¡°íšŒ. `em.find` ì‚¬ìš©
    - `public Point findByName(String name)` : ì´ë¦„ì„ í†µí•´ í•˜ë‚˜ì˜ íšŒì› ì¡°íšŒ.  jpql(`em.createQuery`), whereë¬¸ ì‚¬ìš©
- ì¥ì†Œì„œë¹„ìŠ¤ (PointService)
    - Business Logic, Transaction ì •ì˜ ë° êµ¬í˜„
    - DI(Dependency Injection) : ì¥ì†Œ ë ˆí¬ì§€í† ë¦¬(PointRepository)
    - **@Transactional(readOnly = true)**
        - `public List<Point> findAll()` : ë¦¬í¬ì§€í† ë¦¬ ë‹¨ìˆœ ìœ„ì„
        - `public Point findOne(Long id)` : ë¦¬í¬ì§€í† ë¦¬ ë‹¨ìˆœ ìœ„ì„
        - `public Point findByName(String name)` : ë¦¬í¬ì§€í† ë¦¬ ë‹¨ìˆœ ìœ„ì„
        - `public List<Integer> getStaticsData(String name)`
            - ë¶„ì„ í™”ë©´ì— ì œê³µë  ëˆ„ì  ë°ì´í„° ìƒì„± ë° ë°˜í™˜
            - `findByName()` ì„ í†µí•´ í•´ë‹¹ nameì„ ê°€ì§€ëŠ” pointì— ëŒ€í•´ì„œ â€˜5ì¼ ê°„ì˜ ë°ì´í„°â€™, â€˜í•´ë‹¹ ë‚ ì§œì˜ 3ì‹œê°„ê°„ì˜ ë°ì´í„°â€™ ë¥¼ ê°€ì ¸ì™€ ì œê³µ
            - 5ì¼ ê°„ì˜ ë°ì´í„° : 5ì¼ê°„ì˜ ì¸¡ì • ì¸ì› ìˆ˜ë¥¼ Listì— ì¶”ê°€(+5)
            - 3ì‹œê°„ì˜ ë°ì´í„° : 3ì‹œê°„ë™ì•ˆ(1,2,3)ì˜ ì¸¡ì • ì¸ì›ìˆ˜ë¥¼ Listì— ì¶”ê°€(+3)
            - ë°˜í™˜ : List<Integer> statics â†’ size : 8, `[1ì¼ì „, 2ì¼ì „, ... , 5ì¼ì „, 1ì‹œê°„ì „, 2ì‹œê°„ì „, 3ì‹œê°„ì „]`
    - **@Transactional**
        - `public void updatePoint(Long id)`
            - Point, Info ì—°ê´€ê´€ê³„ ë§¤í•‘ì´ ì´ë£¨ì–´ì§„ ë§ˆì§€ë§‰ ì‹œê° â†’ ì¶”í›„ í•´ë‹¹ ì‹œê° ì´í›„ì˜ ë°ì´í„°ë§Œì„ ë¶ˆëŸ¬ì™€ ë§¤í•‘ í•´ì£¼ê¸° ìœ„í•¨

### ê²€ì¶œ ë°ì´í„° ë¡œì§ ê°œë°œ (Temp)

> êµ¬í˜„ ìˆœì„œ
 - ê²€ì¶œë°ì´í„° ë ˆí¬ì§€í† ë¦¬ ê°œë°œ
 - ê²€ì¶œë°ì´í„° ì„œë¹„ìŠ¤ ê°œë°œ
> 

Temp (Repository, Service)

- ë¼ì´ë¸Œë¡œ ë°›ì•„ì˜¬ ë•Œ ì“°ëŠ” ë°ì´í„°, Infoë¡œ ë³€í™˜í•˜ê¸° ìœ„í•œ ì„ì‹œ ë°ì´í„°
- ê²€ì¶œë°ì´í„° ë ˆí¬ì§€í† ë¦¬ (TempRepository)
    - í•´ë‹¹ ë°ì´í„°ëŠ” ë“œë¡ ì— ì˜í•´ ì´ë¯¸ DBì— ìˆëŠ” Entity
    - navtive queryë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ë¯€ë¡œ Spring Data JPAë¥¼ ì‚¬ìš©í•˜ì—¬ Temp Entityì™€ ê´€ë ¨ëœ Tableì— ì ‘ê·¼í•˜ëŠ” ê³„ì¸µâ†’ `public interface TempRepository extends JpaRepository<Temp, Long>`
    - `List<Temp> getLiveData()` : ìš”ì²­ëœ ì‹œì ì—ì„œì˜ 10ì´ˆì „ë¶€í„° í˜„ì¬ê¹Œì§€ì˜ ê²€ì¶œ ê°ì²´ ì¡°íšŒ.  `@Query(value= *query*, nativeQuery = true)` ì‚¬ìš©
    - `List<Temp> getLastData(@Param(value = "last_commit") LocalDateTime lastCommittedTime);` : lastCommitedTime ì´í›„ì˜ ê²€ì¶œ ê°ì²´ ì¡°íšŒ.
        - `@Param` : nativeQueryì—ì„œ ë³€ìˆ˜ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•œ íŒŒë¼ë¯¸í„° ì„¤ì •
        - `@Query(value= *query*, nativeQuery = true)` ì‚¬ìš©
- ê²€ì¶œë°ì´í„° ì„œë¹„ìŠ¤ (TempService)
    - Business Logic, Transaction ì •ì˜ ë° êµ¬í˜„
    - DI(Dependency Injection) : ê²€ì¶œë°ì´í„°  ë ˆí¬ì§€í† ë¦¬(TempRepository)
    - **@Transactional(readOnly = true)**
        - `public List<Temp> getLiveData()` : ë¦¬í¬ì§€í† ë¦¬ ë‹¨ìˆœ ìœ„ì„
    - **@Transactional**
        - `public int getLiveCount(Long id)`
            - ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ Countí•˜ëŠ” service
            - idì— í•´ë‹¹ í•˜ëŠ” pointì˜ ì˜ì—­ì— ë§ëŠ” ì‹¤ì‹œê°„ ë°ì´í„° tempì˜ ê°œìˆ˜ë¥¼ count

### ê²€ì¶œ ê°ì²´ ë¡œì§ ê°œë°œ (Info)

> êµ¬í˜„ ìˆœì„œ
 - ê²€ì¶œê°ì²´ ë ˆí¬ì§€í† ë¦¬ ê°œë°œ
 - ê²€ì¶œê°ì²´ ì„œë¹„ìŠ¤ ê°œë°œ
> 

Info (Repository, Service)

- ë¼ì´ë¸Œë¡œ ì ì¬ëœ ë°ì´í„°(Temp)ë¥¼ Pointì™€ ì—°ê´€ê´€ê³„ë¥¼ ìƒì„±í•˜ì—¬ ì €ì¥í•˜ëŠ” ë°ì´í„°
- ê²€ì¶œê°ì²´ ë ˆí¬ì§€í† ë¦¬ (InfoRepository)
    - `public void save(Info info)` : ì—°ê´€ê´€ê³„ë¥¼ ìƒì„±í•œ info ì €ì¥. `em.persist()` ì‚¬ìš©
    - í•´ë‹¹ info ë°ì´í„°ë“¤ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ê±´ pointì˜ info Listí†µí•´ ë¶ˆëŸ¬ì˜´
- ê²€ì¶œê°ì²´ ì„œë¹„ìŠ¤ (InfoService)
    - Business Logic, Transaction ì •ì˜ ë° êµ¬í˜„
    - DI(Dependency Injection) : ê²€ì¶œê°ì²´ ë ˆí¬ì§€í† ë¦¬(InfoRepository)
    - **@Transactional**
        - `public void createInfo(Long id)`
            - ì—°ê´€ê´€ê³„ë¥¼ ìƒì„±í•˜ì—¬ Infoë¥¼ ì €ì¥í•˜ëŠ” service
            - idì— í•´ë‹¹ í•˜ëŠ” pointì˜ ì˜ì—­ì— ë§ëŠ” ì‹¤ì‹œê°„ ë°ì´í„° tempì™€ ì—°ê´€ê´€ê³„ë¥¼ ë§ºì€ Infoë¥¼ ìƒì„±í•˜ì—¬ ì €ì¥
            - ì¶”ê°€ë¡œ pointì˜ ì‹¤ì‹œê°„ ë°˜ì˜ ë°ì´í„°(count, percentage)ë„ ë³€ê²½ (ë³€ê²½ê°ì§€ë¥¼ í†µí•´ ì €ì¥)

### ê³µí†µ ê´€ì‹¬ì‚¬ ì²˜ë¦¬

> êµ¬í˜„ ê¸°ëŠ¥ 
 - ê²€ì¶œ ê°ì²´ì™€ ì¥ì†Œ ë§¤í•‘
>
> êµ¬í˜„ ìˆœì„œ
 - Interceptor ê°œë°œ
 - WebConfig ì„¤ì • ë° ê°œë°œ
> 


1. ê¸°ëŠ¥ ì„¤ëª…
    - ê²€ì¶œ ê°ì²´ì™€ ì¥ì†Œ ë§¤í•‘
        - Interceptor ì‚¬ìš© (ê³µí†µ ê´€ì‹¬ì‚¬ ì²˜ë¦¬)
        - Clientì˜ ì„œë¹„ìŠ¤ ë„ì… ì‹œì (Map, Static ì„œë¹„ìŠ¤ ìš”ì²­ ì‹œ)ì— ìƒˆë¡œ ëˆ„ì ëœ ë°ì´í„°(ê²€ì¶œ ê°ì²´)ë“¤ì— ëŒ€í•´ì„œ ì¥ì†Œ(Place)ì— Mapping í•˜ê¸° ìœ„í•¨ â†’ ì—°ê´€ê´€ê³„ ìƒì„±
        - ë“œë¡ ì„ í†µí•´ ì¶•ì ëœ DBì˜ ê°’ì„ ë°›ì•„ì™€ ì—°ê´€ê´€ê³„ë¥¼ ë§Œë“¤ê¸° ìœ„í•¨
        - í•´ë‹¹ `"/", "/statics", "/statics/**"` URIë“¤ì— ëŒ€í•´ ì ìš©
2. ê¸°ëŠ¥ ê°œë°œ
    - custome Interceptor
        - `UpdateInterceptor implements HandlerInterceptor`
            - ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì— í•´ë‹¹ ë¡œì§ ì‹¤í–‰ (preHandle)
            - DI(Dependency Injection) : `infoService`, `pointService`
            - `preHandle`
                - ëª¨ë“  pointë“¤ì— ëŒ€í•´ ìµœê·¼ ì—…ë°ì´íŠ¸ëœ ì‹œì ë¶€í„° í˜„ì¬ê¹Œì§€ ëˆ„ì ëœ ëª¨ë“  Temp(ê²€ì¶œ ë°ì´í„°)ì™€ ì—°ê´€ê´€ê³„ë¥¼ ìƒì„±í•œ Info ìƒì„± â†’ (ëˆ„ì  ë¶„ì„ë°ì´í„°ì— í™œìš©)  â†’ `infoService.createInfo`
                - ì¶”ê°€ë¡œ pointì˜ ìµœê·¼ ì—…ë°ì´íŠ¸ ì‹œê°„ ë³€ê²½ â†’ `pointService.updatePoint`
    - Web Configurer
        - ìƒì„±í•œ Interceptorë¥¼ Webì— ì ìš©
        - DI(Dependency Injection) : `updateInterceptor`
        - `WebConfig`
            - `public void addInterceptors(InterceptorRegistry registry)` : ì¸í„°ì…‰í„° ë“±ë¡ : `updateInterceptor` ë¥¼ ì²«ë²ˆì§¸ ìˆœì„œë¡œ, `"/", "/statics", "/statics/**"` ì˜ URLë“¤ì—ë§Œ ì ìš©ë˜ë„ë¡ `registry`ì— ë“±ë¡

### ì›¹ ì„œë¹„ìŠ¤ ê°œë°œ (controller)

> Map(ì§€ë„) Service
 - ëª¨ë“  ì¥ì†Œ Floating
 - ì¥ì†Œ ì •ë³´ ì œê³µ ( ì‹¤ì‹œê°„ ë³€ê²½ â†’ ì¸¡ì • ì¸ì›, í˜¼ì¡ë„)
 - ì¥ì†Œ ê²€ìƒ‰
>
> Statics(ë¶„ì„) Service
 - ì‹¤ì‹œê°„ ì¸¡ì • ì¸ì› ë° ë³€ê²½ ì¸ì› ì œê³µ
 - ëˆ„ì  ë°ì´í„° ë¶„ì„ ì œê³µ
>



- `HomeController` â†’  @Controller
    - í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ì˜ ë™ê¸°ì‹ í†µì‹ ì„ ìœ„í•œ controller
    - DI : `PointService`, `TempService`
    - `@ModelAttribute("pointList")` : í•´ë‹¹ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ëª¨ë“  methodì— point Listê°€ í•„ìš”í•˜ë¯€ë¡œ modelì— ê¸°ë³¸ìœ¼ë¡œ ì¶”ê°€
    - `@RequestMapping("/")`
        - home(Map) í™”ë©´ ë Œë”ë§
        - Map í™”ë©´ ë° ëª¨ë“  pointë¥¼ Mapí™”ë©´ ì— Floating
        - ê° pointì˜ ìƒì„¸ ì •ë³´ (ì¥ì†Œ ëª…, í˜¼ì¡ë„, ì‹¤ì‹œê°„ ì¸¡ì • ì¸ì›)
    - `@GetMapping(path = {"/statics/{id}", "/static"})`
        - Statics í™”ë©´ ë Œë”ë§
        - ì£¼ì–´ì§„ path variableì— ë”°ë¥¸ ì¥ì†Œì˜ ë¶„ì„í™”ë©´ ë Œë”ë§ (ê¸°ë³¸ê°’ í¬í•¨) â†’ `pointService.findByName("ì„¸ì¢…ëŒ€ ì •ë¬¸")` , `pointService.findOne(id)` ì‚¬ìš©
        - ëˆ„ì  ë°ì´í„° ë¶„ì„ ê²°ê³¼ ë Œë”ë§ â†’ `pointService.getStaticsData(point.getPlace())` ì‚¬ìš©
        - ì‹¤ì‹œê°„ ë°ì´í„° ë¶„ì„ ê²°ê³¼ ë Œë”ë§ â†’ `tempService.getLiveCount(id)` ì‚¬ìš©
- `RestHomeController`â†’ @RestController
    - í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ì˜ ë¹„ë™ê¸°ì‹ í†µì‹ ì„ ìœ„í•œ controller
    - ì‹¤ì‹œê°„ ë°ì´í„° ë³€í™”ëŸ‰ì„ ë¹„ë™ê¸°ì‹ìœ¼ë¡œ ì œê³µ
    - DI : `TempService`
    - `@GetMapping("/info-live/{id}")`
        - í•´ë‹¹ pointì˜ ì‹¤ì‹œê°„ ì¸ì› ì¸¡ì •ëŸ‰ì„ ë°˜í™˜
        - `tempService.getLiveCount(id)` ì‚¬ìš©
    - `@GetMapping("/infos")`
        - í˜„ì¬ ì¸¡ì •ëœ ëª¨ë“  ê²€ì¶œ ê°ì²´ ë°˜í™˜
        - `tempService.getLiveData()` ì‚¬ìš©
        - Jsonìœ¼ë¡œ ë°˜í™˜ ({â€™countâ€™ : int , â€˜dataâ€™ : list})

### ì„œë¹„ìŠ¤ ê²°ê³¼ë¬¼
- Map Service
  ![]({{site.baseurl}}/images/posts/post-220617/result1.gif)
- Statics Service
  ![]({{site.baseurl}}/images/posts/post-220617/result2.gif)
