I"•¤<h2 id="í¼-ì „ì†¡-ë°©ë²•">í¼ ì „ì†¡ ë°©ë²•</h2>

<ul>
  <li>HTML Form ì „ì†¡ ë°©ì‹
    <ul>
      <li><code class="language-plaintext highlighter-rouge">application/x-www-form-urlencoded</code></li>
      <li><code class="language-plaintext highlighter-rouge">multipart/form-data</code></li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">application/x-www-form-urlencoded</code></p>

    <p><img src="/images/posts/post-220630/Untitled.png" alt="Untitled" /></p>

    <ul>
      <li><strong>Form ë°ì´í„°</strong>ë¥¼ ì„œë²„ë¡œ ì „ì†¡í•˜ëŠ” <strong>ê°€ì¥ ê¸°ë³¸ì ì¸ ë°©ì‹</strong></li>
      <li>form íƒœê·¸(&lt;form â€¦&gt;)ì— ë³„ë„ì˜ enctype ì„¤ì •ì´ ì—†ìœ¼ë©´ ì›¹ ë¸Œë¼ìš°ì €ëŠ” ìš”ì²­ HTTP ë©”ì‹œì§€ í—¤ë”ì— <code class="language-plaintext highlighter-rouge">Content-Type: application/x-www-form-urlencoded</code> ë¥¼ ì¶”ê°€í•¨</li>
      <li>ê·¸ í›„ í¼ì— ì…ë ¥ëœ(ì „ì†¡í• ) ê²ƒë“¤ì„ <strong>HTTP Body</strong>ì— ë¬¸ìë¡œ <code class="language-plaintext highlighter-rouge">username=kim&amp;age=20</code> ì™€ ê°™ì´ &amp; ë¡œ êµ¬ë¶„í•´ì„œ ì „ì†¡í•¨</li>
      <li>ê·¸ë ‡ë‹¤ë©´ ë¬¸ìê°€ ì•„ë‹Œ <strong>ë°”ì´ë„ˆë¦¬ë¡œ êµ¬ì„±ëœ ì²¨ë¶€íŒŒì¼</strong>ë„ í•¨ê»˜ ì „ì†¡í•˜ê³  ì‹¶ë‹¤ë©´ ì–´ë–»ê²Œ í• ê¹Œ? â†’ <strong><code class="language-plaintext highlighter-rouge">multipart/form-data</code></strong></li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">multipart/form-data</code></p>

    <p><img src="/images/posts/post-220630/Untitled 1.png" alt="Untitled" /></p>

    <ul>
      <li><strong>ë‹¤ë¥¸ ì¢…ë¥˜ì˜ ì—¬ëŸ¬ íŒŒì¼ê³¼ í¼ì˜ ë‚´ìš© í•¨ê»˜ ì „ì†¡</strong> ê°€ëŠ¥ (<strong>ë¬¸ì</strong>ì™€ <strong>ì²¨ë¶€íŒŒì¼</strong> ë“±)</li>
      <li>ê°ê°ì˜ í•­ëª©ì„ êµ¬ë¶„í•´ì„œ, í•œë²ˆì— ì „ì†¡í•˜ëŠ” ê²ƒ</li>
      <li>form íƒœê·¸(&lt;form â€¦&gt;)ì˜ <strong>enctype</strong>ì— ë³„ë„ì˜ ì„¤ì • í•„ìš” â†’ <code class="language-plaintext highlighter-rouge">enctype="multipart/form-data"</code> ì§€ì •</li>
      <li>Formì˜ ì…ë ¥ ê²°ê³¼ë¡œ ìƒì„±ëœ ìš”ì²­ HTTP ë©”ì‹œì§€ë¥¼ ë³´ë©´ ì•Œ ìˆ˜ ìˆë“¯ì´ ê°ê°ì˜ ì „ì†¡ í•­ëª©ì´ â€œ<strong>â€”â€”â€”â€”XXX</strong>â€ ë¡œ <strong>êµ¬ë¶„(Part)</strong>ë˜ì–´ ìˆìœ¼ë©° <strong>Content-Dispositon ì´ë¼ëŠ” í•­ëª©ë³„ í—¤ë”</strong>ê°€ ì¶”ê°€ë˜ì–´ ìˆê³  <strong>ë¶€ê°€ ì •ë³´</strong> ë˜í•œ í¬í•¨ë˜ì–´ ìˆìŒ.</li>
      <li>í•´ë‹¹ ì˜ˆì‹œì—ì„œëŠ” uesrname, age, file1ì´ ë¶„ë¦¬ë˜ì–´ ìˆê³  ë‚´ìš©ì—ëŠ” ë¬¸ì, <strong>íŒŒì¼ì˜ ê²½ìš°</strong>ëŠ” <strong>ì´ë¦„ê³¼ Content-Typeì´ ì¶”ê°€ë˜ê³  ë°”ì´ë„ˆë¦¬ ë°ì´í„°ê°€ ì „ì†¡</strong>ë¨</li>
      <li>ê·¸ë ‡ë‹¤ë©´ ì´ë ‡ê²Œ êµ¬ë¶„ëœ ë°ì´í„°ë¥¼ í¬í•¨í•œ ìš”ì²­ HTTP ë©”ì‹œì§€ë¥¼ ì–´ë–»ê²Œ ì„œë²„ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆì„ê¹Œ? â†’ <strong>ìŠ¤í”„ë§ ì—†ì´ ì„œë¸”ë¦¿ë§Œìœ¼ë¡œ ì‚¬ìš© â‡’ ìŠ¤í”„ë§ì—ì„œ íŒŒì¼ ë°›ê¸° ì˜ ìˆœì„œ</strong>ë¡œ ì•Œì•„ë³´ìì‰</li>
    </ul>
  </li>
</ul>

<h2 id="file-upload-in-servlet-without-spring">File Upload in Servlet (without Spring)</h2>

<h3 id="ì„œë¸”ë¦¿ì—ì„œ-multipart-í˜•ì‹ì˜-form-ë°ì´í„°-ë°›ì•„ì˜¤ê¸°">ì„œë¸”ë¦¿ì—ì„œ Multipart í˜•ì‹ì˜ Form ë°ì´í„° ë°›ì•„ì˜¤ê¸°</h3>

<ul>
  <li>Springì—ì„œ ì œê³µí•˜ëŠ” íŒŒì¼ ì—…ë¡œë“œ ê¸°ëŠ¥ì—†ì´ <strong>ì„œë¸”ë¦¿ë§Œìœ¼ë¡œ íŒŒì¼ ì—…ë¡œë“œ</strong> êµ¬í˜„</li>
  <li>
    <p>html</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nt">&lt;form</span> <span class="na">th:action</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
  	 <span class="nt">&lt;ul&gt;</span>
  		 <span class="nt">&lt;li&gt;</span>ìƒí’ˆëª… <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"itemName"</span><span class="nt">&gt;&lt;/li&gt;</span>
  		 <span class="nt">&lt;li&gt;</span>íŒŒì¼<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"file"</span> <span class="nt">&gt;&lt;/li&gt;</span>
  	 <span class="nt">&lt;/ul&gt;</span>
  	 <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/form&gt;</span>
</code></pre></div>    </div>

    <ul>
      <li>multipartë¡œ formì„ ë°›ì•„ì˜¬ ë•ŒëŠ” í•­ìƒ <code class="language-plaintext highlighter-rouge">enctype="multipart/form-data"</code> ë¶€ë¶„ ì¶”ê°€!</li>
      <li>multipartë¡œ text, file 2ê°€ì§€ <strong>Part</strong>ë¥¼ ë°›ì•„ì˜´</li>
    </ul>
  </li>
  <li>
    <p>Controller</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/upload"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">saveFileV1</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
  	<span class="nc">String</span> <span class="n">itemName</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"itemName"</span><span class="o">);</span>
  	<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"itemName={}"</span><span class="o">,</span> <span class="n">itemName</span><span class="o">);</span>
  	<span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">Part</span><span class="o">&gt;</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParts</span><span class="o">();</span>
  	<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"parts={}"</span><span class="o">,</span> <span class="n">parts</span><span class="o">);</span>
  	<span class="k">return</span> <span class="s">"upload-form"</span><span class="o">;</span>
  <span class="o">}</span>
</code></pre></div>    </div>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">request.getParameter</code> ë¥¼ í†µí•´ì„œ <strong>textì˜ ê°’</strong>ì„ ê°€ì ¸ì˜¬ ìˆ˜ëŠ” ìˆìŒ. but fileì˜ ê°’ì€ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŒ! â†’ fileì€ parameterí˜•ì‹ìœ¼ë¡œ ë„˜ì–´ì˜¤ëŠ”ê²Œ ì•„ë‹ˆë‹ˆê¹!</li>
      <li><code class="language-plaintext highlighter-rouge">request.getParts()</code> : <code class="language-plaintext highlighter-rouge">multipart/form-data</code> ì „ì†¡ ë°©ì‹ì—ì„œ <strong>ê°ê° ë‚˜ëˆ„ì–´ì§„ ë¶€ë¶„ì„ ë°›</strong>ì•„ì„œ í™•ì¸ ê°€ëŠ¥ â†’ <code class="language-plaintext highlighter-rouge">parts=[org.apache.catalina.core.ApplicationPart@13766755, org.apache.catalina.core.ApplicationPart@30602154]</code></li>
      <li>
        <p><strong>application.properties</strong> ì—ì„œ <code class="language-plaintext highlighter-rouge">logging.level.org.apache.coyote.http11=debug</code> ì„¤ì •ì„ í†µí•´ HTTP ìš”ì²­ ë©”ì‹œì§€ë¥¼ í™•ì¸í•´ ë³´ë©´ <strong>Partë¡œ êµ¬ë¶„ë˜ì–´ ì „ë‹¬</strong>ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ</p>

        <p><img src="/images/posts/post-220630/Untitled 2.png" alt="Untitled" /></p>
      </li>
    </ul>
  </li>
  <li>Multipart ì‚¬ìš© ì˜µì…˜
    <ul>
      <li>application.properties ì—ì„œ <code class="language-plaintext highlighter-rouge">multipart</code> ì˜µì…˜ ì„¤ì • ê°€ëŠ¥</li>
      <li>ì—…ë¡œë“œ ì‚¬ì´ì¦ˆ ì œí•œ
        <ul>
          <li><code class="language-plaintext highlighter-rouge">spring.servlet.multipart.max-file-size=1MB</code> : íŒŒì¼ í•˜ë‚˜ì˜ ìµœëŒ€ ì‚¬ì´ì¦ˆ(default = 1MB)</li>
          <li><code class="language-plaintext highlighter-rouge">spring.servlet.multipart.max-request-size=10MB</code> : ì „ì²´ íŒŒì¼(ì—¬ëŸ¬ íŒŒì¼ì˜ í•©)ì˜ ìµœëŒ€ ì‚¬ì´ì¦ˆ(default = 10MB)</li>
        </ul>
      </li>
      <li>mutlipart í—ˆìš©
        <ul>
          <li><code class="language-plaintext highlighter-rouge">spring.servlet.multipart.enabled=true</code>
            <ul>
              <li>defalut = true</li>
              <li>ì´ ì˜µì…˜ì„ ì¼œë©´ ë³µì¡í•œ ë©€í‹°íŒŒíŠ¸ ìš”ì²­ì„ ì²˜ë¦¬í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ì œê³µ</li>
              <li>í•´ë‹¹ ì˜µì…˜ì„ í‚¤ë©´ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í–ˆë˜ <code class="language-plaintext highlighter-rouge">HttpServletRequest</code> ê°€ <code class="language-plaintext highlighter-rouge">MultipartResolver</code>ë¥¼ í†µí•´ì„œ <strong><code class="language-plaintext highlighter-rouge">MultipartHttpServletRequest</code></strong>ë¡œ ë³€í™˜ë¨</li>
              <li><strong>MultipartHttpServletRequest</strong>
                <ul>
                  <li>HttpServletRequest ì˜ ìì‹ ì¸í„°í˜ì´ìŠ¤</li>
                  <li><strong>ë©€í‹°íŒŒíŠ¸ì™€ ê´€ë ¨ëœ ì¶”ê°€ ê¸°ëŠ¥</strong>ì„ ì œê³µ</li>
                  <li>ì´ê²ƒì„ ì‚¬ìš©í•˜ë©´ <strong>ë©€í‹°íŒŒíŠ¸</strong>ì™€ ê´€ë ¨ëœ ì—¬ëŸ¬ê°€ì§€ ì²˜ë¦¬ë¥¼ <strong>í¸ë¦¬í•˜ê²Œ ì‚¬ìš©</strong> ê°€ëŠ¥</li>
                </ul>
              </li>
              <li>BUT ìš°ë¦° HttpServletRequest ê°€ ë³€í™˜ëœ MultipartHttpServletRequestë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  <strong><code class="language-plaintext highlighter-rouge">MultipartFile</code></strong> ì´ë¼ëŠ” <strong>ìŠ¤í”„ë§ì—ì„œ ì œê³µí•˜ëŠ” ìœ ìš©í•œ ê¸°ëŠ¥ì„ ì‚¬ìš©</strong>í•  ê²ƒ!</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="ì„œë¸”ë¦¿ì—ì„œ-multipartí˜•ì‹ì˜-file-ì—…ë¡œë“œ">ì„œë¸”ë¦¿ì—ì„œ Multipartí˜•ì‹ì˜ File ì—…ë¡œë“œ</h3>

<ul>
  <li><strong>ì„œë¸”ë¦¿</strong>ì´ ì œê³µí•˜ëŠ” <strong>Part</strong>ë¥¼ ì´ìš©í•´ì„œ ì‹¤ì œë¡œ íŒŒì¼ ì—…ë¡œë“œ êµ¬í˜„ (Springì˜ ê¸°ëŠ¥ì„ ì´ìš©í•˜ì§€ ì•Šê³  ì„œë¸”ë¦¿ì˜ Part ê¸°ëŠ¥ë§Œì„ ì´ìš©í•˜ì—¬)</li>
  <li>ê²½ë¡œ ì„¤ì •
    <ul>
      <li>application.properties ì— <code class="language-plaintext highlighter-rouge">file.dir</code> ì†ì„±ì— ì—…ë¡œë“œ ê²½ë¡œ ì„¤ì • (ex_<code class="language-plaintext highlighter-rouge">/Users/park/servlet/file/</code>)</li>
      <li>í•´ë‹¹ ê²½ë¡œ ê°’ì€ <code class="language-plaintext highlighter-rouge">@Value</code> ë¥¼ í†µí•´ ê°€ì ¸ì™€ ì‚¬ìš©í•  ì˜ˆì •</li>
    </ul>
  </li>
  <li>ServletUploadController
    <ul>
      <li>
        <p>ê²½ë¡œ ë¶ˆëŸ¬ì˜¤ê¸°</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@Value</span><span class="o">(</span><span class="s">"${file.dir}"</span><span class="o">)</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">fileDir</span><span class="o">;</span>
</code></pre></div>        </div>

        <ul>
          <li><code class="language-plaintext highlighter-rouge">@Value</code> ë¥¼ í†µí•´ <strong>application.propretiesì˜ ì†ì„± ê°’</strong>ì„ ê°€ì ¸ì˜´</li>
        </ul>
      </li>
      <li>
        <p>íŒŒì¼ í™•ì¸ ë° ì—…ë¡œë“œ (<strong>Servletì˜ Part ì´ìš©</strong>)</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/upload"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">saveFileV1</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        
      <span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">Part</span><span class="o">&gt;</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParts</span><span class="o">();</span> <span class="c1">// ê°ê°ì˜ ë¶€ë¶„(Part)ë“¤ì„ ê°€ì ¸ì˜´</span>
        
      <span class="k">for</span> <span class="o">(</span><span class="nc">Part</span> <span class="n">part</span> <span class="o">:</span> <span class="n">parts</span><span class="o">)</span> <span class="o">{</span>
          <span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">headerNames</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="na">getHeaderNames</span><span class="o">();</span> <span class="c1">// parts ë„ header ì™€ body ë¡œ êµ¬ë¶„ë¨!</span>
          <span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">headerName</span> <span class="o">:</span> <span class="n">headerNames</span><span class="o">)</span> <span class="o">{</span>
              <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"header {}: {}"</span><span class="o">,</span> <span class="n">headerName</span><span class="o">,</span> <span class="n">part</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="n">headerName</span><span class="o">));</span>
          <span class="o">}</span>
        
          <span class="c1">//í¸ì˜ ë©”ì„œë“œ</span>
          <span class="c1">//content-disposition ì˜ filename ë”°ì˜¤ê¸°</span>
          <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"submittedFilename={}"</span><span class="o">,</span> <span class="n">part</span><span class="o">.</span><span class="na">getSubmittedFileName</span><span class="o">());</span> <span class="c1">// ìë™ íŒŒì‹±í•´ì£¼ëŠ” ê²ƒ</span>
          <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"size={}"</span><span class="o">,</span> <span class="n">part</span><span class="o">.</span><span class="na">getSize</span><span class="o">());</span> <span class="c1">//part body size</span>
        
          <span class="c1">//ë°ì´í„° ì½ê¸°</span>
          <span class="nc">InputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span> <span class="c1">// ì‹¤ì œ ë°›ì•„ì˜¨ ë°”ì´ë„ˆë¦¬ ê°’ì„ ì½ëŠ” ê²ƒ</span>
          <span class="nc">String</span> <span class="n">body</span> <span class="o">=</span> <span class="nc">StreamUtils</span><span class="o">.</span><span class="na">copyToString</span><span class="o">(</span><span class="n">inputStream</span><span class="o">,</span> <span class="nc">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span> <span class="c1">// ê·¸ ì½ì–´ ì˜¨ ê°’ì„ String ìœ¼ë¡œ ë³´ê¸° í¸í•˜ê²Œ ë³€ê²½</span>
          <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"body={}"</span><span class="o">,</span> <span class="n">body</span><span class="o">);</span>
        
          <span class="c1">//íŒŒì¼ì— ì €ì¥í•˜ê¸°</span>
          <span class="k">if</span> <span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">hasText</span><span class="o">(</span><span class="n">part</span><span class="o">.</span><span class="na">getSubmittedFileName</span><span class="o">()))</span> <span class="o">{</span> <span class="c1">// íŒŒì¼ ì œì¶œì¸ì§€ í™•ì¸</span>
              <span class="nc">String</span> <span class="n">fullPath</span> <span class="o">=</span> <span class="n">fileDir</span> <span class="o">+</span> <span class="n">part</span><span class="o">.</span><span class="na">getSubmittedFileName</span><span class="o">();</span>
              <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"íŒŒì¼ ì €ì¥ fullPath={}"</span><span class="o">,</span> <span class="n">fullPath</span><span class="o">);</span>
              <span class="n">part</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">fullPath</span><span class="o">);</span> <span class="c1">// í•´ë‹¹ ì„¤ì •ëœ ê²½ë¡œë¥¼ í†µí•´ ì €ì¥</span>
          <span class="o">}</span>
      <span class="o">}</span>
        
      <span class="k">return</span> <span class="s">"upload-form"</span><span class="o">;</span>
  <span class="o">}</span>
</code></pre></div>        </div>

        <ul>
          <li><strong>Servletì˜ Part</strong> : Multipartì˜ ê°ê°ì˜ ë¶€ë¶„ë“¤ ì¤‘ <strong>Fileê³¼ ê´€ë ¨ëœ Partì— ëŒ€í•´</strong>ì„œ í™•ì¸í•˜ê±°ë‚˜ ì—…ë¡œë“œí•  ë•Œ ì‚¬ìš©</li>
          <li><code class="language-plaintext highlighter-rouge">part.getInputStream()</code>: Partì˜ ì „ì†¡ ë°ì´í„°ë¥¼ ì½ì„ ìˆ˜ ìˆìŒ</li>
          <li>ì¤‘ìš”í•œ ë¶€ë¶„ì€ â€œíŒŒì¼ì— ì €ì¥í•˜ê¸°â€ ë¶€ë¶„
            <ul>
              <li><code class="language-plaintext highlighter-rouge">StringUtils.hasText(part.getSubmittedFileName())</code> ì„ í†µí•´ í˜„ì¬ partê°€ ì œì¶œëœ íŒŒì¼ì¸ì§€ í™•ì¸ â†’ (<code class="language-plaintext highlighter-rouge">part.getSubmittedFileName()</code> : í´ë¼ì´ì–¸íŠ¸ê°€ ì „ë‹¬í•œ íŒŒì¼ëª…. íŒŒì¼ì´ ì—†ë‹¤ë©´ <code class="language-plaintext highlighter-rouge">null</code>)</li>
              <li><code class="language-plaintext highlighter-rouge">part.write(fullPath)</code> : ì§€ì •ëœ ê²½ë¡œì— í•´ë‹¹ íŒŒì¼ ì €ì¥</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>ì´ë ‡ê²Œ ì„œë¸”ë¦¿ì´ ì œê³µí•˜ëŠ” <strong>Part ë¡œë„ íŒŒì¼ì„ ì €ì¥í•  ìˆ˜ ìˆ</strong>ì§€ë§Œ, ì¶”ê°€ì ìœ¼ë¡œ <strong>HttpServletRequest ë¥¼ ì‚¬ìš©</strong>í•´ì•¼ í•˜ê¸°ë„ í•˜ê³ . ì¶”ê°€ì ìœ¼ë¡œ íŒŒì¼ì¸ì§€ ì•„ë‹Œì§€ <strong>í™•ì¸ í•˜ê³  êµ¬ë¶„í•´ì•¼ë˜ëŠ” ì—¬ëŸ¬ì½”ë“œë¥¼ ìš”êµ¬</strong>í•¨. â†’ <strong>Springì„ ì‚¬ìš©í•˜ë©´ í›¨ì”¬ ë” í¸ë¦¬í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥!!</strong></li>
</ul>

<h2 id="file-upload-in-spring">File Upload in Spring</h2>

<h3 id="ìŠ¤í”„ë§ê³¼-íŒŒì¼-ì—…ë¡œë“œ-multipartfile">ìŠ¤í”„ë§ê³¼ íŒŒì¼ ì—…ë¡œë“œ (MultipartFile)</h3>

<ul>
  <li>ìŠ¤í”„ë§ì€ <strong><code class="language-plaintext highlighter-rouge">MultipartFile</code></strong> ì´ë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ multipartì˜ fileì„ ì‰½ê²Œ ë‹¤ë£° ìˆ˜ ìˆë„ë¡ ì§€ì›</li>
  <li>
    <p>Controller</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/upload"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">saveFile</span><span class="o">(</span><span class="nd">@RequestParam</span> <span class="nc">String</span> <span class="n">itemName</span><span class="o">,</span> <span class="nd">@RequestParam</span> <span class="nc">MultipartFile</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
    
      <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"itemName={}"</span><span class="o">,</span> <span class="n">itemName</span><span class="o">);</span>
      <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"multipartFile={}"</span><span class="o">,</span> <span class="n">file</span><span class="o">);</span>
    
      <span class="c1">// íŒŒì¼ ì €ì¥</span>
      <span class="k">if</span> <span class="o">(!</span><span class="n">file</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
          <span class="nc">String</span> <span class="n">fullPath</span> <span class="o">=</span> <span class="n">fileDir</span> <span class="o">+</span> <span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">();</span>
          <span class="n">file</span><span class="o">.</span><span class="na">transferTo</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">fullPath</span><span class="o">));</span>
      <span class="o">}</span>
    
      <span class="k">return</span> <span class="s">"upload-form"</span><span class="o">;</span>
  <span class="o">}</span>
</code></pre></div>    </div>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">@RequestParam MultipartFile file</code> : ì œì¶œëœ íŒŒì¼ì„ <strong>MultipartFile</strong>ë¡œ ë°›ì•„ì˜´ â†’ ì„œë¸”ë¦¿ì˜ ë³µì¡í•œ ê³¼ì •ì´ <strong>ì–´ë…¸í…Œì´ì…˜ê³¼ Springì—ì„œ ì§€ì›í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ í•œë²ˆì— í•´ê²°</strong>ë˜ëŠ” ê²ƒ (HTML Formì˜ nameì— ë§ì¶”ì–´ <code class="language-plaintext highlighter-rouge">@RequestParam</code> ì„ ì ìš©. <code class="language-plaintext highlighter-rouge">@ModelAttribute</code> ë„ ê°€ëŠ¥!)</li>
      <li><code class="language-plaintext highlighter-rouge">file.getOriginalFilename()</code> : ì—…ë¡œë“œ íŒŒì¼ ëª…</li>
      <li><code class="language-plaintext highlighter-rouge">file.transferTo(new File(fullPath));</code> : í•´ë‹¹ ê²½ë¡œë¡œ íŒŒì¼ ì €ì¥</li>
    </ul>
  </li>
</ul>

<aside>
âš ï¸ <strong>ArgumentResolver, ConversionService in @RequestParam MultipartFile file</strong> <br />
ë¨¼ì € ArguementResolver ê°€ @RequestParamê³¼ MultipartFile ì„ ì§€ì›í•˜ëŠ”ì§€ í™•ì¸í•œ í›„, ConversionServiceë¥¼ í†µí•´ String â†’ MultipartFile Converterê°€ ìˆëŠ”ì§€ í™•ì¸í•œ í›„ Type Convertingì„ ì§„í–‰. ê·¸ í›„ ìƒì„±ëœ ê°ì²´(MultipartFile)ë¥¼ ArgumentResolverê°€ ë§ˆë ¨í•´ì¤Œ <br />
â‡’ ì¦‰, <b>ì„œë¸”ë¦¿ë§Œìœ¼ë¡œ íŒŒì¼ì„ í™•ì¸í•˜ëŠ” ê³¼ì • ìì²´ë¥¼ MultipartFileì„ ë§Œë“¤ì–´ì£¼ëŠ” ArgumentResolverê°€ ë‹¤ ìë™ìœ¼ë¡œ</b> í•´ì£¼ëŠ” ê²ƒ!

</aside>

<h3 id="íŒŒì¼-ì—…ë¡œë“œ-ë°-í™•ì¸-ë‹¤ìš´ë¡œë“œ-ì‹¤ì „">íŒŒì¼ ì—…ë¡œë“œ ë° í™•ì¸, ë‹¤ìš´ë¡œë“œ (ì‹¤ì „)</h3>

<ul>
  <li>ì‹¤ì œ íŒŒì¼,ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° í™•ì¸, ë‹¤ìš´ë¡œë“œì—ì„œëŠ” ê³ ë ¤í•´ì•¼í•  ì ë“¤ì´ ìˆìŒ. ê·¸ëŸ° ì‚¬í•­ë“¤ì„ í™•ì¸</li>
  <li>ìƒí’ˆ ê°ì²´ ë° DTO
    <ul>
      <li>ìƒí’ˆ ì´ë¦„, ì²¨ë¶€íŒŒì¼ í•˜ë‚˜, ì´ë¯¸ì§€ íŒŒì¼ ì—¬ëŸ¬ê°œ(multiple)</li>
      <li>
        <p>ì—…ë¡œë“œ íŒŒì¼ ì •ë³´ ë³´ê´€</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@Data</span>
  <span class="nd">@AllArgsConstructor</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">UploadFile</span> <span class="o">{</span>
  	 <span class="kd">private</span> <span class="nc">String</span> <span class="n">uploadFileName</span><span class="o">;</span>
  	 <span class="kd">private</span> <span class="nc">String</span> <span class="n">storeFileName</span><span class="o">;</span>
  <span class="o">}</span>
</code></pre></div>        </div>

        <ul>
          <li><code class="language-plaintext highlighter-rouge">uploadFileName</code> ì€ íŒŒì¼ì˜ ì›ë³¸ëª…</li>
          <li><code class="language-plaintext highlighter-rouge">storeFileName</code> ì€ Repositoryì— ì €ì¥ë˜ëŠ” íŒŒì¼ì˜ ì´ë¦„ â†’ UUID ì‚¬ìš© (ë˜‘ê°™ì€ ì´ë¦„ìœ¼ë¡œ ì €ì¥ë˜ë©´ ì•ˆë¨! <strong>ì¶©ëŒ ì˜ˆë°©</strong>)</li>
        </ul>
      </li>
      <li>
        <p>Repositoryì— ì €ì¥ë˜ëŠ” ìƒí’ˆ ê°ì²´</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@Data</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Item</span> <span class="o">{</span>
  		<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
  		<span class="kd">private</span> <span class="nc">String</span> <span class="n">itemName</span><span class="o">;</span>
  		<span class="kd">private</span> <span class="nc">UploadFile</span> <span class="n">attachFile</span><span class="o">;</span> <span class="c1">// ë‹¨ì¼ íŒŒì¼</span>
  		<span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">UploadFile</span><span class="o">&gt;</span> <span class="n">imageFiles</span><span class="o">;</span> <span class="c1">// íŒŒì¼ ì—¬ëŸ¬ê°œ</span>
  <span class="o">}</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>Item ê°ì²´ì˜ DTO</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@Data</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">ItemForm</span> <span class="o">{</span>
  	 <span class="kd">private</span> <span class="nc">Long</span> <span class="n">itemId</span><span class="o">;</span>
  	 <span class="kd">private</span> <span class="nc">String</span> <span class="n">itemName</span><span class="o">;</span>
  	 <span class="kd">private</span> <span class="nc">MultipartFile</span> <span class="n">attachFile</span><span class="o">;</span>
  	 <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">MultipartFile</span><span class="o">&gt;</span> <span class="n">imageFiles</span><span class="o">;</span>
  <span class="o">}</span>
</code></pre></div>        </div>

        <ul>
          <li>Form íƒœê·¸ë¡œ ë°›ì•„ì˜¬ ë•Œ ì‚¬ìš©ë˜ëŠ” <strong>Item DTO</strong> (ìƒí’ˆ ì €ì¥ìš© í¼)</li>
          <li>Form ì—ì„œ ë°›ì•„ì˜¬ ë•Œì˜ <strong>ë‹¨ì¼ íŒŒì¼ì€ MultipartFile</strong>ë¡œ, **ì—¬ëŸ¬ íŒŒì¼ì€ List<MultipartFile>**ë¡œ ë°›ì•„ì˜¬ ìˆ˜ ìˆìŒ</MultipartFile></li>
        </ul>

        <aside>
  âš ï¸ <strong>DTOë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ !</strong> <br />
  <code>@ModelAttribute</code>ë¡œ Form ì˜ ì…ë ¥ ê°’ë“¤ì„ ë°›ì•„ì˜¤ëŠ”ë°, ì´ë•Œ <b>íŒŒì¼ì„ ë°›ì•„ì˜¤ê¸° ìœ„í•´ì„  MultipartFile ì„ ì‚¬ìš©</b>í•´ì•¼ë¨. í•˜ì§€ë§Œ ì €ì¥ì†Œì—ëŠ” ì´ ê·¸ëŒ€ë¡œ ì €ì¥í•˜ë©´ ì•ˆë˜ê³  í•´ë‹¹ íŒŒì¼ì„ <b>ì €ì¥í•œ ê²½ë¡œë¥¼ ì €ì¥</b>í•´ì•¼ë¨. ê·¸ëŸ¬ê¸° ë•Œë¬¸ì— <b>DTOë¥¼ ì‚¬ìš©í•´ì„œ MultipartFileë¡œ ë°›ì•„ì˜¤ê³ </b> ì´ë¥¼ Storageì— ì €ì¥ í›„ <b>ì €ì¥ ê²½ë¡œë¥¼ ê°€ì§€ê³  ìˆëŠ” ì‹¤ì œ Item ê°ì²´ë¥¼ Repositoryì— ì €ì¥</b>í•´ì•¼ ë¨
        
  </aside>
      </li>
      <li>ìƒí’ˆì€ ì—…ë¡œë“œ ë° í™•ì¸, ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥</li>
    </ul>
  </li>
  <li>ì—…ë¡œë“œ
    <ul>
      <li>RepositoryëŠ” ì´ì „ê³¼ ë™ì¼í•˜ë¯€ë¡œ ìƒëµ (ì´ì „ íŒŒíŠ¸ ì°¸ê³ )</li>
      <li>
        <p>ì—…ë¡œë“œ Form</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/items/new"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">newItem</span><span class="o">(</span><span class="nd">@ModelAttribute</span> <span class="nc">ItemForm</span> <span class="n">form</span><span class="o">)</span> <span class="o">{</span>
  	<span class="k">return</span> <span class="s">"item-form"</span><span class="o">;</span>
  <span class="o">}</span>
</code></pre></div>        </div>

        <ul>
          <li>ë¹ˆ itemDTOë¥¼ ë³´ë‚´ì£¼ì–´ formì˜ objectë¥¼ ë§ì¶° ì¤Œ</li>
        </ul>
      </li>
      <li>
        <p>ì—…ë¡œë“œ ì§„í–‰</p>

        <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nt">&lt;form</span> <span class="na">th:action</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
  	 <span class="nt">&lt;ul&gt;</span>
  		 <span class="nt">&lt;li&gt;</span>ìƒí’ˆëª… <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"itemName"</span><span class="nt">&gt;&lt;/li&gt;</span>
  		 <span class="nt">&lt;li&gt;</span>ì²¨ë¶€íŒŒì¼<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"attachFile"</span> <span class="nt">&gt;&lt;/li&gt;</span>
  		 <span class="nt">&lt;li&gt;</span>ì´ë¯¸ì§€ íŒŒì¼ë“¤<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">multiple=</span><span class="s">"multiple"</span> <span class="na">name=</span><span class="s">"imageFiles"</span> <span class="nt">&gt;&lt;/li&gt;</span>
  	 <span class="nt">&lt;/ul&gt;</span>
  	 <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/form&gt;</span>
</code></pre></div>        </div>

        <ul>
          <li>ë‹¨ì¼ íŒŒì¼ì€ ê·¸ëƒ¥ fileì„ í†µí•´ì„œ ë°›ì•„ì™€ ì£¼ë©´ ë¨ â†’ Controllerì—ì„œ <code class="language-plaintext highlighter-rouge">MultipartFile</code> ë¡œ ë°›ìŒ</li>
          <li>ì—¬ëŸ¬ íŒŒì¼ì˜ inputì€ multiple ì„¤ì •ì„ í†µí•´ ë°›ì•„ì™€ì•¼ ë¨! â†’ Controllerì—ì„œ <code class="language-plaintext highlighter-rouge">List&lt;MultipartFile&gt;</code> ë¡œ ë°›ìŒ</li>
        </ul>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/items/new"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">saveItem</span><span class="o">(</span><span class="nd">@ModelAttribute</span> <span class="nc">ItemForm</span> <span class="n">form</span><span class="o">,</span> <span class="nc">RedirectAttributes</span> <span class="n">redirectAttributes</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
      <span class="nc">UploadFile</span> <span class="n">attachFile</span> <span class="o">=</span> <span class="n">fileStore</span><span class="o">.</span><span class="na">storeFile</span><span class="o">(</span><span class="n">form</span><span class="o">.</span><span class="na">getAttachFile</span><span class="o">());</span>
      <span class="nc">List</span><span class="o">&lt;</span><span class="nc">UploadFile</span><span class="o">&gt;</span> <span class="n">storeImageFiles</span> <span class="o">=</span> <span class="n">fileStore</span><span class="o">.</span><span class="na">storeFiles</span><span class="o">(</span><span class="n">form</span><span class="o">.</span><span class="na">getImageFiles</span><span class="o">());</span>
        
  		<span class="c1">// DTO â†’ Item</span>
      <span class="nc">Item</span> <span class="n">item</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Item</span><span class="o">();</span>
  		<span class="n">item</span><span class="o">.</span><span class="na">setItemName</span><span class="o">(</span><span class="n">form</span><span class="o">.</span><span class="na">getItemName</span><span class="o">());</span>
      <span class="n">item</span><span class="o">.</span><span class="na">setAttachFile</span><span class="o">(</span><span class="n">attachFile</span><span class="o">);</span>
  		<span class="n">item</span><span class="o">.</span><span class="na">setImageFiles</span><span class="o">(</span><span class="n">storeImageFiles</span><span class="o">);</span>
      <span class="n">itemRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">item</span><span class="o">);</span> <span class="c1">//ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥</span>
        
      <span class="n">redirectAttributes</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"itemId"</span><span class="o">,</span> <span class="n">item</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
      <span class="k">return</span> <span class="s">"redirect:/items/{itemId}"</span><span class="o">;</span>
  <span class="o">}</span>
</code></pre></div>        </div>

        <ul>
          <li><code class="language-plaintext highlighter-rouge">@ModelAttribute</code> ë¥¼ í†µí•´ì„œ Formì˜ ì…ë ¥ ê°’ë“¤(text, file, multiple files)ì„ ë°›ì•„ì˜´</li>
          <li><strong>DTO â†’ Item</strong> : ë°›ì•„ì˜¨ <strong>MutlipartFile ì„ UploadFileë¡œ ë³€ê²½</strong>í•¨ìœ¼ë¡œì¨ ì‹¤ì œ íŒŒì¼ì´ ì•„ë‹Œ ì›ë³¸ <strong>íŒŒì¼ ëª…ê³¼ íŒŒì¼ ì €ì¥ ê²½ë¡œë§Œì„ Itemì— ì €ì¥</strong></li>
          <li><strong>PRG</strong> : Post í›„ Redircetë¥¼ í†µí•´ Get ìš”ì²­ ì‹¤í–‰</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>ì¡°íšŒ ë° ë‹¤ìš´ë¡œë“œ
    <ul>
      <li>
        <p>Item ì¡°íšŒ</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/items/{id}"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">items</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">Item</span> <span class="n">item</span> <span class="o">=</span> <span class="n">itemRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
      <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"item"</span><span class="o">,</span> <span class="n">item</span><span class="o">);</span>
      <span class="k">return</span> <span class="s">"item-view"</span><span class="o">;</span>
  <span class="o">}</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>Itemì˜ ì²¨ë¶€íŒŒì¼, ì´ë¯¸ì§€ íŒŒì¼ ì¡°íšŒ ë° ë‹¤ìš´ë¡œë“œ</p>

        <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ìƒí’ˆëª…: <span class="nt">&lt;span</span> <span class="na">th:text=</span><span class="s">"${item.itemName}"</span><span class="nt">&gt;</span>ìƒí’ˆëª…<span class="nt">&lt;/span&gt;&lt;br/&gt;</span>
  ì²¨ë¶€íŒŒì¼: <span class="nt">&lt;a</span> <span class="na">th:if=</span><span class="s">"${item.attachFile}"</span> <span class="na">th:href=</span><span class="s">"|/attach/${item.id}|"</span>
  						 <span class="na">th:text=</span><span class="s">"${item.getAttachFile().getUploadFileName()}"</span> <span class="nt">/&gt;&lt;br/&gt;</span>
  <span class="nt">&lt;img</span> <span class="na">th:each=</span><span class="s">"imageFile : ${item.imageFiles}"</span> 
  		 <span class="na">th:src=</span><span class="s">"|/images/${imageFile.getStoreFileName()}|"</span> 
  		<span class="na">width=</span><span class="s">"300"</span> <span class="na">height=</span><span class="s">"300"</span><span class="nt">/&gt;</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p><strong>ì´ë¯¸ì§€ ì¡°íšŒ</strong> (ê° ì´ë¯¸ì§€ë“¤ì„ ë³´ì—¬ì£¼ê¸° ìœ„í•¨) â†’ <code class="language-plaintext highlighter-rouge">th:src="|/images/${imageFile.getStoreFileName()}|"</code></p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@ResponseBody</span>
  <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/images/{filename}"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nc">Resource</span> <span class="nf">imgViewer</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="nc">String</span> <span class="n">filename</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">MalformedURLException</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nf">UrlResource</span><span class="o">(</span><span class="s">"file:"</span> <span class="o">+</span> <span class="n">fileStore</span><span class="o">.</span><span class="na">getFullPath</span><span class="o">(</span><span class="n">filename</span><span class="o">));</span> <span class="c1">// ì§ì ‘ ê²½ë¡œë¥¼ ë”°ë¼ ê°€ì„œ íŒŒì¼ì„ ì°¾ì•„ì™€ì„œ ì•„ì›ƒí’‹ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ë°˜í™˜</span>
  <span class="o">}</span>
</code></pre></div>        </div>

        <ul>
          <li><code class="language-plaintext highlighter-rouge">@ResponseBody</code> : ë°˜í™˜ëœ <strong>ì•„ì›ƒí’‹ ìŠ¤íŠ¸ë¦¼ ê·¸ëŒ€ë¡œ HTTP Bodyì—</strong> ë‹´ê¸°ìœ„í•¨ (View Resolverê°€ ì•„ë‹Œ HttpMessageConverter ë™ì‘) â†’ img íƒœê·¸ê°€ ì´ë¥¼ ë°›ì•„ì„œ ì´ë¯¸ì§€ë¥¼ ë„ì›Œì£¼ëŠ” ê²ƒ</li>
          <li><strong>Resource, UrlResource</strong> : í•´ë‹¹ ê²½ë¡œì— ëŒ€í•œ íŒŒì¼ì„ <strong>ì•„ì›ƒí’‹ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì „ë‹¬</strong></li>
        </ul>
      </li>
      <li>
        <p>ì²¨ë¶€íŒŒì¼ ë‹¤ìš´ë¡œë“œ (í´ë¦­ ì‹œ ë‹¤ìš´ë¡œë“œ) â†’ <code class="language-plaintext highlighter-rouge">th:href="|/attach/${item.id}|"</code></p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/attach/{itemId}"</span><span class="o">)</span>
      <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">Resource</span><span class="o">&gt;</span> <span class="nf">downloadAttach</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="nc">Long</span> <span class="n">itemId</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">MalformedURLException</span> <span class="o">{</span>
          <span class="nc">Item</span> <span class="n">item</span> <span class="o">=</span> <span class="n">itemRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">itemId</span><span class="o">);</span>
          <span class="nc">String</span> <span class="n">storeFileName</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="na">getAttachFile</span><span class="o">().</span><span class="na">getStoreFileName</span><span class="o">();</span>
          <span class="nc">String</span> <span class="n">uploadFileName</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="na">getAttachFile</span><span class="o">().</span><span class="na">getUploadFileName</span><span class="o">();</span>
        
          <span class="nc">UrlResource</span> <span class="n">resource</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UrlResource</span><span class="o">(</span><span class="s">"file:"</span> <span class="o">+</span> <span class="n">fileStore</span><span class="o">.</span><span class="na">getFullPath</span><span class="o">(</span><span class="n">storeFileName</span><span class="o">));</span>
        
          <span class="nc">String</span> <span class="n">encodedUploadFileName</span> <span class="o">=</span> <span class="nc">UriUtils</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">uploadFileName</span><span class="o">,</span> <span class="nc">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span> <span class="c1">// ì¸ì½”ë”© (í•œê¸€ì„ ìœ„í•¨)</span>
          <span class="nc">String</span> <span class="n">contentDisposition</span> <span class="o">=</span> <span class="s">"attachment; filename=\""</span> <span class="o">+</span> <span class="n">encodedUploadFileName</span> <span class="o">+</span> <span class="s">"\""</span><span class="o">;</span> <span class="c1">// ë‹¤ìš´ë¡œë“œí•˜ê¸° ìœ„í•œ ê·œì•½</span>
        
          <span class="k">return</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">()</span>
                  <span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="nc">HttpHeaders</span><span class="o">.</span><span class="na">CONTENT_DISPOSITION</span><span class="o">,</span> <span class="n">contentDisposition</span><span class="o">)</span> <span class="c1">// ë‹¤ìš´ë¡œë“œë¥¼ ìœ„í•œ í—¤ë”</span>
                  <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">resource</span><span class="o">);</span>
      <span class="o">}</span>
</code></pre></div>        </div>

        <ul>
          <li>ì¼ë°˜ì ì¸ <code class="language-plaintext highlighter-rouge">@ResponseBody</code> ë¡œ UrlResourceë¥¼ ë°˜í™˜í•˜ë©´ ê·¸ëƒ¥ ì¡°íšŒë§Œ ë¨.</li>
          <li>ë‹¤ìš´ë¡œë“œë¥¼ ìœ„í•´ì„  <strong>response Http Header ê°’ì„ ë³€ê²½</strong>í•´ì¤˜ì•¼ ë¨ â†’ <strong>ResponseEntity ì‚¬ìš©</strong></li>
          <li>bodyì—ëŠ” ì¡°íšŒì˜ ë°©ì‹ ê·¸ëŒ€ë¡œ UrlResourceë¡œ ì±„ì›Œì¤Œ (ì•„ì›ƒí’‹ìŠ¤íŠ¸ë¦¼)</li>
          <li><code class="language-plaintext highlighter-rouge">ResponseEntity.ok().header(...).body(resource)</code>
            <ul>
              <li><code class="language-plaintext highlighter-rouge">ResponseEntity.ok()</code> : <code class="language-plaintext highlighter-rouge">ResponseEntity</code> ì˜ statusë¥¼ 200ìœ¼ë¡œ ì„¤ì •</li>
              <li><code class="language-plaintext highlighter-rouge">.header(HttpHeaders.CONTENT_DISPOSITION, contentDisposition)</code> : ë‹¤ìš´ë¥´ë„ë¥¼ ìœ„í•´ headerì˜ <strong>content-disposition ì´ë¼ëŠ” í•­ëª©ì„ ë”°ë¡œ ì„¤ì •</strong>í•´ì¤Œ(í•œê¸€ì„ í¬í•¨í•œ ì œëŒ€ë¡œëœ ê²½ë¡œë¥¼ ìœ„í•´ ì¸ì½”ë”© ì„¤ì • í•„ìˆ˜) â†’ <strong>ë‹¤ìš´ë¡œë“œ ê·œì•½!</strong></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
:ET