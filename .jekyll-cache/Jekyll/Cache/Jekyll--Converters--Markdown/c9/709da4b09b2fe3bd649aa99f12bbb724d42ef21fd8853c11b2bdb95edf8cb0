I"<h1 id="ìŠ¤í”„ë§-ë°ì´í„°-jpa---advanced">ìŠ¤í”„ë§ ë°ì´í„° JPA - Advanced</h1>

<h2 id="í™•ì¥-ê¸°ëŠ¥">í™•ì¥ ê¸°ëŠ¥</h2>

<h3 id="ì‚¬ìš©ì-ì •ì˜-repo-êµ¬í˜„">ì‚¬ìš©ì ì •ì˜ REPO êµ¬í˜„</h3>

<ul>
  <li>í˜„ì¬ ìŠ¤í”„ë§ ë°ì´í„° JPAë¥¼ ì‚¬ìš©í•˜ëŠ” REPOì—ì„œ JPAë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ê±°ë‚˜ JDBC Template, MyBatis ë¥¼ ì‚¬ìš©í•˜ëŠ” ë“± <strong>ìŠ¤í”„ë§ ë°ì´í„° JPAê°€ ì•„ë‹Œ ë©”ì„œë“œë¥¼ ì§ì ‘ êµ¬í˜„í•˜ê³  ì‹¶ì„ ë•Œ</strong>ì˜ ë°©ë²• (<strong>íŠ¹íˆ QueryDSL</strong>ì„ ì‚¬ìš©í•´ì•¼ í•  ë•Œ)</li>
  <li>ë§Œì•½ í•´ë‹¹ ë°©ë²•ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  í˜„ì¬ REPOì˜ <strong>êµ¬í˜„ì²´ë¥¼ ë§Œë“¤ì–´ ë©”ì„œë“œë¥¼ ì¶”ê°€í•œë‹¤ë©´?</strong> â†’  Spring Data Jpaê°€ êµ¬í˜„í•´ì£¼ëŠ” ëª¨ë“  ë©”ì„œë“œë“¤ì„ ì§ì ‘ êµ¬í˜„í•´ì¤€ í›„ì— ë©”ì„œë“œë¥¼ ì¶”ê°€í•´ì£¼ì–´ì•¼ í•¨! <strong>ë„ˆë¬´ë‚˜ ë³µì¡!</strong></li>
  <li><strong>ì‚¬ìš©ì ì •ì˜ Repository</strong> êµ¬í˜„
    <ol>
      <li>
        <p>ì‚¬ìš©ì ì •ì˜ <strong>ì¸í„°í˜ì´ìŠ¤</strong> ìƒì„±</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberRepositoryCustom</span> <span class="o">{</span>
 	 <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findMemberCustom</span><span class="o">();</span>
 <span class="o">}</span>
</code></pre></div>        </div>

        <ul>
          <li><code class="language-plaintext highlighter-rouge">List&lt;Member&gt; findMemberCustom();</code> : <strong>Spring Data Jpa ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì€</strong> ì‚¬ìš©ì ì •ì˜ ë©”ì„œë“œ â†’ <strong>JPAë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ê±°ë‚˜ QueryDSL ë“±ì„ ì‚¬ìš©</strong>í•˜ê³ ì í•˜ëŠ” ë©”ì„œë“œ</li>
        </ul>
      </li>
      <li>
        <p>ì‚¬ìš©ì ì •ì˜ <strong>ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´</strong> ìƒì„± (êµ¬í˜„ì²´ì˜ <strong>ì´ë¦„ì€ ì •í•´ì§„ ê·œì¹™ì— ë”°ë¼ ìƒì„±</strong>)</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nd">@RequiredArgsConstructor</span>
 <span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberRepositoryImpl</span> <span class="kd">implements</span> <span class="nc">MemberRepositoryCustom</span> <span class="o">{</span>
 	 <span class="kd">private</span> <span class="kd">final</span> <span class="nc">EntityManager</span> <span class="n">em</span><span class="o">;</span>
 	 <span class="nd">@Override</span>
 	 <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findMemberCustom</span><span class="o">()</span> <span class="o">{</span>
 			 <span class="k">return</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select m from Member m"</span><span class="o">)</span>
 					 <span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
 	 <span class="o">}</span>
 <span class="o">}</span>
</code></pre></div>        </div>

        <ul>
          <li>í•´ë‹¹ Interfaceì˜ <strong>ë©”ì„œë“œë¥¼ êµ¬í˜„</strong> (<code class="language-plaintext highlighter-rouge">@Override</code>)</li>
          <li>í•´ë‹¹ êµ¬í˜„ì²´ëŠ” <strong>JPAë¥¼ ì§ì ‘ ì‚¬ìš©(JPQL)í•˜ê¸° ìœ„í•œ ë©”ì„œë“œ</strong></li>
          <li>êµ¬í˜„ì²´ì˜ ì´ë¦„ì€ í˜„ì¬ Spring Data JPAë¥¼ ì‚¬ìš©(JpaRepository&lt;&gt;)í•˜ëŠ” Interface(<code class="language-plaintext highlighter-rouge">MeberRepository</code>)ì— â€œ<code class="language-plaintext highlighter-rouge">Impl</code>â€ ì´ë¼ëŠ” í‚¤ì›Œë“œë¥¼ ë¶™ì—¬ì¤˜ì•¼í•¨ (<code class="language-plaintext highlighter-rouge">MeberRepositoryImpl</code>) â†’ ì •í•´ì§„ ê·œì¹™ (<strong>ê·œì¹™: ë¦¬í¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤ ì´ë¦„ + Impl or ì‚¬ìš©ì ì •ì˜ ì¸í„°í˜ì´ìŠ¤ ëª… + â€œImplâ€ â†’</strong> <code class="language-plaintext highlighter-rouge">MeberRepositoryCustomImpl</code>)</li>
          <li>ì´ë ‡ê²Œ ê·œì¹™ì— ë”°ë¼ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì£¼ë©´ ë”°ë¡œ <strong>ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•  í•„ìš” ì—†ì´ ìŠ¤í”„ë§ ë°ì´í„° JPAê°€ ì¸ì‹í•˜ì—¬ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡!</strong> â†’ ë”°ë¼ì„œ ê·œì¹™ì— ë”°ë¼ì•¼í•˜ëŠ” ê²ƒì€ í•„ìˆ˜!!</li>
        </ul>
      </li>
      <li>
        <p>í•´ë‹¹ ì‚¬ìš©ì ì •ì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ í˜„ì¬ <strong>Spring Data JPAë¥¼ ì‚¬ìš©(JpaRepository&lt;&gt;)í•˜ëŠ” Interfaceì— ìƒì†</strong>ì„ ì¤Œ</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberRepository</span>
 			 <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;,</span> <span class="nc">MemberRepositoryCustom</span> <span class="o">{}</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>ì‚¬ìš©ì ì •ì˜ ë©”ì„œë“œ í˜¸ì¶œ ë° ì‚¬ìš©</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findMemberCustom</span><span class="o">();</span>
</code></pre></div>        </div>

        <ul>
          <li>ì´ì§ˆê° ì—†ì´ ê·¸ëƒ¥ <strong>ë°”ë¡œ memberRepository ì—ì„œ í˜¸ì¶œí•´ì„œ ì‚¬ìš©</strong> ê°€ëŠ¥</li>
        </ul>
      </li>
    </ol>
  </li>
</ul>

<aside>
âš ï¸ **ì–¸ì œ ì‚¬ìš©í•´ì•¼ ë˜ë‚˜?**

ì‹¤ë¬´ì—ì„œëŠ” ì£¼ë¡œ **QueryDSL**ì´ë‚˜ **SpringJdbcTemplate**ì„ **í•¨ê»˜ ì‚¬ìš©**í•  ë•Œ ì‚¬ìš©ì ì •ì˜ ë¦¬í¬ì§€í† ë¦¬ ê¸°ëŠ¥ ìì£¼ ì‚¬ìš©

</aside>

<aside>
âš ï¸ **ì‚¬ìš©ì ì •ì˜ ë¦¬í¬ ì£¼ì˜ì !**
í•­ìƒ ì‚¬ìš©ì ì •ì˜ ë¦¬í¬ì§€í† ë¦¬ê°€ í•„ìš”í•œ ê²ƒì€ ì•„ë‹˜. **ê·¸ëƒ¥ ì„ì˜ì˜ ë ˆí¬ë¥¼ ìƒì„±í•´ì„œ ì‚¬ìš©í•´ë„ ë¨!!** ì˜ˆë¥¼ë“¤ì–´ MemberRepositoryForQuerydslë¥¼ ë³„ë„ì˜ í´ë˜ìŠ¤ë¡œ ë§Œë“¤ê³  ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì„œ ê·¸ëƒ¥ ì§ì ‘ ì‚¬ìš©í•´ë„ ë¨ â†’ **í•µì‹¬ ë¹„ì§€ë‹ˆìŠ¤ì— ì†í•˜ëŠ” REPOë‘ í™”ë©´ì— ë§ì¶˜ REPOëŠ” ë¶„ë¦¬í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ìŒ!**

</aside>

<h3 id="auditing">Auditing</h3>

<ul>
  <li>Entityë¥¼ ìƒì„±í•˜ê³  ë³€ê²½í•  ë•Œ <strong>ìë™ìœ¼ë¡œ ë³€ê²½í•œ ì‚¬ëŒê³¼ ì‹œê°„ì„ ì¶”ì </strong>í•˜ê²Œ í•´ì¤„ ìˆ˜ ìˆëŠ” ê¸°ëŠ¥</li>
  <li>ë“±ë¡ì¼, ìˆ˜ì •ì¼, (ë“±ë¡ì, ìˆ˜ì •ì) ëŠ” ì‹¤ë¬´ì— ìˆì–´ì„œ í•„ìˆ˜ Colâ†’ <strong>ì¶”ì </strong>ì„ ìœ„í•´</li>
  <li>ì¦‰, ì´ë“¤ì€ <strong>ê³µí†µì ìœ¼ë¡œ ë“¤ì–´ê°€ëŠ” Field</strong> ì´ê³ , ì´ë“¤ì— ëŒ€í•´ì„œ <strong>ìë™ìœ¼ë¡œ ê¸°ë¡í•´ì£¼ëŠ” ìˆ˜ë‹¨ì´ í•„ìš”!</strong> â†’ í•´ë‹¹ Entityê°€ ë“±ë¡ë˜ê¸° ì§ì „, ìë™ìœ¼ë¡œ ë“±ë¡ì¼ê³¼ ë“±ë¡ìë¥¼ ê¸°ë¡í•´ì£¼ê³ , ìˆ˜ì •ë˜ê¸° ì§ì „, ìë™ìœ¼ë¡œ ìˆ˜ì •ì¼ê³¼ ìˆ˜ì •ìë¥¼ ê¸°ë¡í•´ì£¼ëŠ” ìˆ˜ë‹¨</li>
  <li>
    <p>ìˆœìˆ˜ JPAì—ì„œì˜ Auditing (<code class="language-plaintext highlighter-rouge">@PrePersist</code>, <code class="language-plaintext highlighter-rouge">@PreUpdate</code>)</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@MappedSuperclass</span>
  <span class="nd">@Getter</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaBaseEntity</span> <span class="o">{</span>
  		<span class="nd">@Column</span><span class="o">(</span><span class="n">updatable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
  		<span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">createdDate</span><span class="o">;</span>
  		<span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">updatedDate</span><span class="o">;</span>
    
  		<span class="nd">@PrePersist</span>
  		<span class="kd">public</span> <span class="kt">void</span> <span class="nf">prePersist</span><span class="o">()</span> <span class="o">{...}</span>
  		<span class="nd">@PreUpdate</span>
  		<span class="kd">public</span> <span class="kt">void</span> <span class="nf">preUpdate</span><span class="o">()</span> <span class="o">{...}</span>
  <span class="o">}</span>
</code></pre></div>    </div>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">JpaBaseEntity</code>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">@MappedSuperclass</code> : í•´ë‹¹ Classì˜ Fieldë¥¼ <strong>ê³µí†µ Field</strong>ë¡œ ë§Œë“¤ê² ë‹¤ëŠ”  ëœ». â†’ ë‹¤ë¥¸ Entityë“¤ì€ í•´ë‹¹ Class ë¥¼ ìƒì†ë°›ê³  ê³µí†µ Fieldë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ</li>
          <li>ë“±ë¡ì¼ê³¼ ìˆ˜ì •ì¼ Field ë³´ìœ  (ê³µí†µ Field)</li>
          <li>ex) <code class="language-plaintext highlighter-rouge">public class Member extends JpaBaseEntity {}</code> â†’ MemberëŠ” createdDate, updatedDate Fieldë¥¼ ë³´ìœ í•˜ê²Œ ë¨</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">@PrePersist</code>
        <ul>
          <li>í•´ë‹¹ class ë¥¼ ìƒì†ë°›ì€ Entityê°€ <strong>ì €ì¥ë˜ê¸° ì§ì „</strong>ì— í•´ë‹¹ <strong>ì–´ë…¸í…Œì´ì…˜ì´ ë‹¬ë¦° ë©”ì„œë“œ(createdDate, updatedDate ì„¤ì •) ì‹¤í–‰</strong></li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">@PreUpdate</code>
        <ul>
          <li>í•´ë‹¹ class ë¥¼ ìƒì†ë°›ì€ Entityê°€ <strong>ìˆ˜ì •ë˜ê¸° ì§ì „</strong>ì— í•´ë‹¹ <strong>ì–´ë…¸í…Œì´ì…˜ì´ ë‹¬ë¦° ë©”ì„œë“œ(updatedDate ì„¤ì •) ì‹¤í–‰</strong></li>
        </ul>
      </li>
      <li>JPA ì£¼ìš” ì´ë²¤íŠ¸ ì–´ë…¸í…Œì´ì…˜
        <ul>
          <li><strong>ì €ì¥</strong> ê´€ë ¨ : <code class="language-plaintext highlighter-rouge">@PrePersist</code>, <code class="language-plaintext highlighter-rouge">@PostPersist</code></li>
          <li><strong>ìˆ˜ì •</strong> ê´€ë ¨ : <code class="language-plaintext highlighter-rouge">@PreUpdate</code>, <code class="language-plaintext highlighter-rouge">@PostUpdate</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>ìŠ¤í”„ë§ ë°ì´í„° JPA ì—ì„œì˜ Auditing</strong> (<code class="language-plaintext highlighter-rouge">@CreatedDate</code>, <code class="language-plaintext highlighter-rouge">@LastModifiedDate</code>) ì‚¬ìš©
    <ol>
      <li>
        <p><strong>ìŠ¤í”„ë§ ë¶€íŠ¸ ì„¤ì • í´ë˜ìŠ¤</strong>ì— <code class="language-plaintext highlighter-rouge">@EnableJpaAuditing</code> ì ìš© (ì¶”ê°€ë¡œ ë“±ë¡ì, ìˆ˜ì •ì ì²˜ë¦¬ë¥¼ ì›í•œë‹¤ë©´, <code class="language-plaintext highlighter-rouge">AuditorAware</code>ë¥¼ ìŠ¤í”„ë§ ë¹ˆ ë“±ë¡)</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nd">@EnableJpaAuditing</span> <span class="c1">// Auditingê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì„¤ì •</span>
 <span class="nd">@SpringBootApplication</span>
 <span class="kd">public</span> <span class="kd">class</span> <span class="nc">DataJpaApplication</span> <span class="o">{</span>
        
 	<span class="o">...</span> 
 	<span class="nd">@Bean</span> <span class="c1">// ë“±ë¡ì, ìˆ˜ì •ìë¥¼ ì²˜ë¦¬í•´ì£¼ëŠ” AuditorAware ìŠ¤í”„ë§ ë¹ˆ ë“±ë¡</span>
 	<span class="kd">public</span> <span class="nc">AuditorAware</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">auditorProvider</span><span class="o">()</span> <span class="o">{</span>
 		<span class="k">return</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="nc">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="no">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>
 	<span class="o">}</span> <span class="c1">// ë‚´ë¶€ getCurrentAuditor() ë¥¼ ëŒë‹¤ë¡œ êµ¬í˜„í•œ ê²ƒ</span>
        
 <span class="o">}</span>
</code></pre></div>        </div>

        <ul>
          <li>ì—¬ê¸°ì„œëŠ” UUIDë¥¼ í†µí•´ì„œ ì§„í–‰í–ˆì§€ë§Œ, <strong>ì‹¤ë¬´ì—ì„  ì„¸ì…˜ ì •ë³´ë‚˜, ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ë¡œê·¸ì¸ ì •ë³´ì—ì„œ IDë¥¼ ë°›ì•„ì™€ ì €ì¥</strong>í•´ì¤Œ (<code class="language-plaintext highlighter-rouge">@CreatedBy</code>, <code class="language-plaintext highlighter-rouge">@LastModifiedBy</code> ê°€ ë‹¬ë¦° Fieldì—)</li>
        </ul>
      </li>
      <li>
        <p>Auditingì„ ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” (ë“±ë¡ì¼, ìˆ˜ì •ì¼ ë“±ì„ ê°€ì§„) <strong>ì—”í‹°í‹°ì—</strong>  <code class="language-plaintext highlighter-rouge">@EntityListeners(AuditingEntityListener.class)</code> (<strong>ì´ë²¤íŠ¸ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•œë‹¤</strong>ëŠ” ê²ƒì„ ëª…ì‹œ) ì ìš©í•œ í›„ <code class="language-plaintext highlighter-rouge">@CreatedDate</code>(ë“±ë¡ì¼), <code class="language-plaintext highlighter-rouge">@LastModifiedDate</code>(ë³€ê²½ì¼), <code class="language-plaintext highlighter-rouge">@CreatedBy</code>(ë“±ë¡ì), <code class="language-plaintext highlighter-rouge">@LastModifiedBy</code>(ë³€ê²½ì)</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nd">@EntityListeners</span><span class="o">(</span><span class="nc">AuditingEntityListener</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
 <span class="nd">@MappedSuperclass</span>
 <span class="nd">@Getter</span>
 <span class="kd">public</span> <span class="kd">class</span> <span class="nc">BaseEntity</span> <span class="o">{</span>
 		 <span class="nd">@CreatedDate</span>
 		 <span class="nd">@Column</span><span class="o">(</span><span class="n">updatable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
 		 <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">createdDate</span><span class="o">;</span>
        
 		 <span class="nd">@LastModifiedDate</span>
 		 <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">lastModifiedDate</span><span class="o">;</span>
        
 		 <span class="nd">@CreatedBy</span>
 		 <span class="nd">@Column</span><span class="o">(</span><span class="n">updatable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
 		 <span class="kd">private</span> <span class="nc">String</span> <span class="n">createdBy</span><span class="o">;</span>
        
 		 <span class="nd">@LastModifiedBy</span>
 		 <span class="kd">private</span> <span class="nc">String</span> <span class="n">lastModifiedBy</span><span class="o">;</span>
 <span class="o">}</span>
</code></pre></div>        </div>
      </li>
    </ol>

    <ul>
      <li>ì´ë ‡ê²Œ ì„¤ì •í•˜ê²Œ ë˜ë©´ ìˆœìˆ˜ JPAì²˜ëŸ¼ ì§ì ‘ Methodë¥¼ ì§¤ í•„ìš” ì—†ì´ <strong>ìë™ìœ¼ë¡œ ë“±ë¡, ìˆ˜ì •ê³¼ ê´€ë ¨ëœ í•„ë“œë¥¼</strong> ë§ˆì¹˜ ìˆœìˆ˜ JPAì—ì„œì˜ Auditing ë™ì‘ê³¼ ë™ì¼í•˜ê²Œ <strong>ì €ì¥</strong>í•´ì¤Œ</li>
      <li>ë“±ë¡ì, ë³€ê²½ì ë“±ì€ í•„ìˆ˜ì ì´ì§€ ì•ŠëŠ” ê²½ìš°ê°€ ë” ë§ìŒ â†’ Base íƒ€ì…ì„ ë¶„ë¦¬í•˜ê³ , ì›í•˜ëŠ” íƒ€ì…ì„ ì„ íƒí•´ì„œ ìƒì†í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ ì§„í–‰í•˜ë©´ íš¨ìœ¨ì </li>
    </ul>
  </li>
</ul>

<h3 id="í˜ì´ì§•ê³¼-ì •ë ¬---web-í™•ì¥">í˜ì´ì§•ê³¼ ì •ë ¬ - web í™•ì¥</h3>

<ul>
  <li>ìŠ¤í”„ë§ ë°ì´í„°ì—ì„œ ì œê³µí•˜ëŠ” <strong>Pagingê³¼ Sorting ê¸°ëŠ¥</strong>ì„ <strong>ìŠ¤í”„ë§ MVCì—ì„œ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©</strong> ê°€ëŠ¥</li>
  <li>ìŠ¤í”„ë§ MVCì—ì„œ <strong>íŒŒë¼ë¯¸í„°ë¥¼</strong> <strong>Pageable</strong>ë¡œ ë°›ê³ , í•´ë‹¹ <strong>Pageableì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ì—¬ ì¡°ê±´ì— ë§ëŠ” í˜ì´ì§€ ê²°ê³¼ë¥¼ ì–»</strong>ì–´ë‚¼ ìˆ˜ ìˆìŒ</li>
  <li>
    <p>ì˜ˆì‹œ)</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@RestController</span>
  <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/members"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">MemberDto</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">)</span> <span class="o">{</span>
  	 <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="n">pageable</span><span class="o">);</span>
  	 <span class="k">return</span> <span class="n">page</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">MemberDto:</span><span class="o">:</span><span class="k">new</span><span class="o">);</span>
  <span class="o">}</span>
</code></pre></div>    </div>

    <ul>
      <li>íŒŒë¼ë¯¸í„° : <code class="language-plaintext highlighter-rouge">Pageable</code>
        <ul>
          <li><strong>Requestë¡œì¨</strong> ë°›ì•„ì˜¬ ìˆ˜ ìˆìŒ</li>
          <li>Pageableì€ Interfaceì´ê³ , ìš”ì²­íŒŒë¼ë¯¸í„°ë¥¼ ë„£ì–´ì£¼ê²Œ ë˜ë©´ <strong>ìŠ¤í”„ë§ë¶€íŠ¸ì—ì„œ ìë™ìœ¼ë¡œ ì´ì— ëŒ€í•œ êµ¬í˜„ì²´ì¸</strong> <code class="language-plaintext highlighter-rouge">PageRequest</code> <strong>ê°ì²´ë¥¼ ìƒì„±</strong>í•´ì¤Œ (PageRequest  ëŠ” ì´ì „ í˜ì´ì§•ê³¼ ì •ë ¬ì—ì„œ <code class="language-plaintext highlighter-rouge">PageRequest.of(page,size,Sort)</code> ì˜ ê·¸ PageRequest)</li>
          <li>ì°¸ê³  : Spring Data Jpa ì—ì„œì˜ â€œê³µí†µ ì¸í„°í˜ì´ìŠ¤ ê¸°ëŠ¥(method)ë“¤, ë©”ì„œë“œì´ë¦„ìœ¼ë¡œ ì¿¼ë¦¬ ìƒì„±â€ì€ ëª¨ë‘ PageRequestë¥¼ ì¸ìë¡œ ë°›ì„ ìˆ˜ ìˆìŒ</li>
        </ul>
      </li>
      <li>ë°˜í™˜ : <code class="language-plaintext highlighter-rouge">Page&lt;MemberDto&gt;</code>
        <ul>
          <li>ì¡°ê±´ì— ë”°ë¥¸ ê²°ê³¼ <strong>List Content í¬í•¨</strong></li>
          <li>ë¶€ê°€ì ì¸ <strong>í˜ì´ì§€ ì •ë³´</strong> í¬í•¨</li>
          <li>ì£¼ì˜ : í•­ìƒ <strong>Controllerì˜ ë°˜í™˜</strong>ì€ Entityê°€ ì•„ë‹Œ <strong>DTO</strong>ë¡œ í•´ì•¼ë˜ëŠ” ì !</li>
        </ul>
      </li>
      <li>ìš”ì²­ íŒŒë¼ë¯¸í„° ì˜ˆì‹œ
        <ul>
          <li><code class="language-plaintext highlighter-rouge">/members?page=0&amp;size=3&amp;sort=id,desc&amp;sort=username,desc</code></li>
          <li><strong>page</strong>
            <ul>
              <li>focusí•  í˜ì´ì§€ (ì£¼ì˜ : 0ë¶€í„° ì‹œì‘)</li>
              <li>ê°’ì„ ë„£ì§€ ì•Šìœ¼ë©´ default=0</li>
            </ul>
          </li>
          <li><strong>size</strong>
            <ul>
              <li>í•´ë‹¹ í˜ì´ì§€ì— ê°€ì ¸ì˜¬ ë°ì´í„°ì˜ ê°œìˆ˜</li>
              <li>ê°’ì„ ë„£ì§€ ì•Šìœ¼ë©´ default = 20</li>
            </ul>
          </li>
          <li><strong>sort</strong>
            <ul>
              <li>ì •ë ¬ ì¡°ê±´</li>
              <li>ê°’ì„ ë„£ì§€ ì•Šìœ¼ë©´ ì •ë ¬ X</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>ìš”ì²­ íŒŒë¼ë¯¸í„° Default ê°’ ì„¤ì •
    <ul>
      <li><strong>Global</strong>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">spring.data.web.pageable.max-page-size=2000</code> : ìµœëŒ€ í˜ì´ì§€ ì‚¬ì´ì¦ˆ ì„¤ì •</li>
          <li><code class="language-plaintext highlighter-rouge">spring.data.web.pageable.default-page-size=20</code> : size default ê°’ ì„¤ì •</li>
        </ul>
      </li>
      <li><strong>ê°œë³„ ì„¤ì •</strong>
        <ul>
          <li>
            <p><code class="language-plaintext highlighter-rouge">@PageableDefault</code> ì–´ë…¸í…Œì´ì…˜ ì‚¬ìš©</p>

            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@GetMapping</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">list</span><span class="o">(</span>
  		<span class="nd">@PageableDefault</span><span class="o">(</span><span class="n">size</span> <span class="o">=</span> <span class="mi">12</span><span class="o">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="err">â€œ</span><span class="n">username</span><span class="err">â€</span><span class="o">,</span>
  		<span class="n">direction</span> <span class="o">=</span> <span class="nc">Sort</span><span class="o">.</span><span class="na">Direction</span><span class="o">.</span><span class="na">DESC</span><span class="o">)</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">)</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>ì ‘ë‘ì‚¬
    <ul>
      <li><code class="language-plaintext highlighter-rouge">@Qualifier</code></li>
      <li>í˜ì´ì§• <strong>ì •ë³´ê°€ ë‘˜ ì´ìƒ</strong>ì¼ ë•Œ ì‚¬ìš©</li>
      <li><code class="language-plaintext highlighter-rouge">@Qualifier</code> ì—ëŠ” ì ‘ë‘ì‚¬ëª… ë¶€ì—¬(<code class="language-plaintext highlighter-rouge">@Qualifier("member")</code>), ìš”ì²­íŒŒë¼ë¯¸í„°ì—ëŠ” ì ‘ë‘ì‚¬ë¡œ êµ¬ë¶„(<code class="language-plaintext highlighter-rouge">"{ì ‘ë‘ì‚¬ëª…}_xxxâ€</code>)</li>
      <li>ex)
        <ul>
          <li><strong>ìš”ì²­ íŒŒë¼ë¯¸í„°</strong> : <code class="language-plaintext highlighter-rouge">/members?member_page=0&amp;order_page=1</code></li>
          <li>
            <p><strong>Controller íŒŒë¼ë¯¸í„°</strong></p>

            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">list</span><span class="o">(</span>
   <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"member"</span><span class="o">)</span> <span class="nc">Pageable</span> <span class="n">memberPageable</span><span class="o">,</span>
   <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"order"</span><span class="o">)</span> <span class="nc">Pageable</span> <span class="n">orderPageable</span><span class="o">,</span> <span class="o">...)</span> <span class="o">{}</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="ë¶€ê°€-ê¸°ëŠ¥">ë¶€ê°€ ê¸°ëŠ¥</h2>

<h3 id="projections">Projections</h3>

<ul>
  <li>ì—”í‹°í‹° ëŒ€ì‹ , <strong>DTOë¥¼ í¸ë¦¬í•˜ê²Œ ì¡°íšŒ</strong>í•  ë•Œ ì‚¬ìš©</li>
  <li><strong>ë‹¨ìˆœí•œ DTO ì¡°íšŒ ì‹œ ìœ ìš©</strong></li>
  <li>ë‹¨ì  : ì—°ê´€ê´€ê³„ë¥¼ í¬í•¨í•œ DTO ì¡°íšŒ ì‹œ ìµœì í™” ë¶ˆê°€ëŠ¥ + LEFT OUTER JOINë§Œ ì‚¬ìš© ê°€ëŠ¥</li>
  <li>ì˜ˆì‹œ)
    <ul>
      <li>íšŒì› ì´ë¦„ë§Œ ì¡°íšŒí•˜ê³  ì‹¶ì€ ìƒí™©</li>
      <li>
        <p>ì¼ë°˜ ìŠ¤í”„ë§ ë°ì´í„° JPA</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@Query</span><span class="o">(</span><span class="s">"select m.name from Member m where m.name = :name"</span><span class="o">)</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">findNamesByName</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">name</span><span class="o">);</span>
</code></pre></div>        </div>

        <ul>
          <li><code class="language-plaintext highlighter-rouge">@Query</code> ë¥¼ í†µí•´ <strong>ì§ì ‘ jpqlë¬¸ì„ ì‘ì„±</strong>í•´ì¤˜ì•¼ í•˜ê³ , <strong>ë°”ì¸ë”©ë„ ì§ì ‘</strong>í•´ì£¼ëŠ” <strong>ë²ˆê±°ëŸ¬ì›€</strong> ì¡´ì¬</li>
          <li>ë‹¤ë¥¸ ì¡°ê±´ìœ¼ë¡œ ê²€ìƒ‰ ì‹œ JPQLì„ ë˜ nameìœ¼ë¡œ ë°˜í™˜í•  ìˆ˜ ìˆë„ë¡ ì‘ì„±í•´ì£¼ì–´ì•¼ í•¨</li>
        </ul>
      </li>
      <li><strong>ìŠ¤í”„ë§ ë°ì´í„° JPAì—ì„œ Projections ì‚¬ìš©</strong> <strong>(Closed Projections)</strong>
        <ul>
          <li>
            <p>Interface ìƒì„±</p>

            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">NameOnly</span> <span class="o">{</span>
  	 <span class="nc">String</span> <span class="nf">getName</span><span class="o">();</span>
  <span class="o">}</span>
</code></pre></div>            </div>

            <ul>
              <li>í•´ë‹¹ Interfaceë¡œ <strong>Projectionì˜ ê²°ê³¼</strong>ë¥¼ ë°›ìŒ</li>
              <li><code class="language-plaintext highlighter-rouge">getName()</code> ì„ í†µí•´ì„œ <strong>ì´ë¦„ë§Œ</strong> ë°›ì•„ì˜´</li>
            </ul>
          </li>
          <li>
            <p>MemberRepositoryì— ë©”ì„œë“œ ì¶”ê°€</p>
            <ul>
              <li><code class="language-plaintext highlighter-rouge">List&lt;NameOnly&gt; findProjectionsByName(String name);</code></li>
              <li><strong>ë°˜í™˜ íƒ€ì…ì„ ë°©ê¸ˆ ìƒì„±í•œ Interfaceë¡œ ì„¤ì •</strong></li>
              <li>Member Entityì˜ ëª¨ë“  Fieldë¥¼ selectí•´ì„œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ ì•„ë‹Œ <strong>name fieldë§Œ selectí•´ì„œ ê°€ì ¸ì˜´ â†’ ìµœì í™”</strong></li>
              <li>ë°˜í™˜ íƒ€ì…ìœ¼ë¡œ ì¸ì§€í•˜ê¸°ì— <code class="language-plaintext highlighter-rouge">findâ€¦By</code>~ ì—ì„œ â€¦ ì€ ììœ </li>
            </ul>
          </li>
        </ul>
      </li>
      <li>
        <p><strong>ìŠ¤í”„ë§ ë°ì´í„° JPAì—ì„œ Projections ì‚¬ìš© (Open Proejctions)</strong></p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UsernameOnly</span> <span class="o">{</span>
  	 <span class="nd">@Value</span><span class="o">(</span><span class="s">"#{target.username + ' ' + target.age + ' ' + target.team.name}"</span><span class="o">)</span>
  	 <span class="nc">String</span> <span class="nf">getUsername</span><span class="o">();</span>
  <span class="o">}</span>
</code></pre></div>        </div>

        <ul>
          <li><code class="language-plaintext highlighter-rouge">@Value</code> ë¥¼ í†µí•´ì„œ <strong>ì§ì ‘ select í•´ì˜¬ fieldë¥¼ ì§€ì •í•˜ê³  í•´ë‹¹ ê²°ê³¼ë¥¼ ì–´ë–»ê²Œ í‘œí˜„</strong>í•´ ë‚¼ì§€ ì§€ì • ê°€ëŠ¥</li>
          <li>í•˜ì§€ë§Œ ì´ë ‡ê²Œ í•  ê²½ìš° DBì—ì„œ <strong>ì—”í‹°í‹° í•„ë“œë¥¼ ë‹¤ ì¡°íšŒí•´ì˜¨ ë‹¤ìŒì— ê³„ì‚°</strong> â†’ JPQL SELECT ì ˆ <strong>ìµœì í™” ë¶ˆê°€ëŠ¥</strong></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p>DTO class Projection</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@Getter</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">NameOnlyDto</span> <span class="o">{</span>
  	 <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
  	 <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>
    
  	 <span class="kd">public</span> <span class="nf">NameOnlyDto</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
  		 <span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">=</span> <span class="n">username</span><span class="o">;</span>
  		 <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span>
  	 <span class="o">}</span>
  <span class="o">}</span>
</code></pre></div>    </div>

    <ul>
      <li><strong>êµ¬ì²´ì ì¸ DTO í˜•ì‹ìœ¼ë¡œ Projection</strong></li>
      <li>ìƒì„±ìì˜ <strong>íŒŒë¼ë¯¸í„° ì´ë¦„ìœ¼ë¡œ ë§¤ì¹­</strong> â†’ <code class="language-plaintext highlighter-rouge">public NameOnlyDto(String name, int age)</code></li>
    </ul>
  </li>
  <li>ë™ì  class Projections
    <ul>
      <li>
        <p>MemberRepositoryì˜ Spring Data JPAì˜ methodì—ì„œ <strong>Generic Typeì„ ë¶€ì—¬í•´ì£¼ë©´ ë™ì ìœ¼ë¡œë„ í”„ë¡œì ì…˜ ë³€ê²½ ê°€ëŠ¥</strong></p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">findProjectionsByUsername</span><span class="o">(</span><span class="nc">String</span> <span class="n">username</span><span class="o">,</span> <span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">);</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>ì‚¬ìš©</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">UsernameOnly</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findProjectionsByUsername</span><span class="o">(</span><span class="s">"m1"</span><span class="o">,</span> <span class="nc">UsernameOnly</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h3 id="ë„¤ì´í‹°ë¸Œ-ì¿¼ë¦¬">ë„¤ì´í‹°ë¸Œ ì¿¼ë¦¬</h3>

<ul>
  <li><strong>SQL ì–¸ì–´ë¡œ ì§ì ‘ queryë¥¼ ì‘ì„±</strong>í•˜ëŠ” ê²ƒ (Spring Data Jpaì˜ í˜ì´ì§• ê¸°ëŠ¥ ì§€ì›)</li>
  <li>ë„¤ì´í‹°ë¸Œ ì¿¼ë¦¬ëŠ” ê°€ê¸‰ì  ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ê²Œ ì¢‹ìŒ â†’ <strong>ë°˜í™˜íƒ€ì…ë„ ì œí•œë˜ê³  ì œì•½ì¡°ê±´ì´ ë§ìŒ</strong>
    <ul>
      <li>ë°˜í™˜ íƒ€ì…
        <ul>
          <li>Object[], Tuple, DTO(ìŠ¤í”„ë§ ë°ì´í„° ì¸í„°í˜ì´ìŠ¤ Projections ì§€ì›)</li>
        </ul>
      </li>
      <li>ì œì•½
        <ul>
          <li>Sort íŒŒë¼ë¯¸í„°ë¥¼ í†µí•œ <strong>ì •ë ¬ì´ ì •ìƒ ë™ì‘í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ</strong></li>
          <li>JPQLì²˜ëŸ¼ ì• í”Œë¦¬ì¼€ì´ì…˜ <strong>ë¡œë”© ì‹œì ì— ë¬¸ë²• í™•ì¸ ë¶ˆê°€</strong></li>
          <li><strong>ë™ì  ì¿¼ë¦¬ ë¶ˆê°€</strong></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>ë„¤ì´í‹°ë¸Œ ì¿¼ë¦¬ + Projections</strong>
    <ul>
      <li>ë„¤ì´í‹°ë¸Œ ì¿¼ë¦¬ê°€ Projectionsë¥¼ í†µí•´ DTOë¡œ ì–´ë µì§€ ì•Šê²Œ ë°˜í™˜ ê°€ëŠ¥ â†’ ê·¸ë‚˜ë§ˆ ìœ ìš©í•œ ê¸°ëŠ¥</li>
      <li>
        <p>MemberProjection Interface</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberProjection</span> <span class="o">{</span>
  	<span class="nc">Long</span> <span class="nf">getId</span><span class="o">();</span>
  	<span class="nc">String</span> <span class="nf">getName</span><span class="o">();</span>
  	<span class="nc">String</span> <span class="nf">getTeamName</span><span class="o">();</span>
  <span class="o">}</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>NativeQuery with Projections</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@Query</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"SELECT m.member_id as id, m.username, t.name as teamName "</span> <span class="o">+</span>
  	 <span class="s">"FROM member m left join team t"</span><span class="o">,</span>
  	 <span class="n">countQuery</span> <span class="o">=</span> <span class="s">"SELECT count(*) from member"</span><span class="o">,</span>
  	 <span class="n">nativeQuery</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
  <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">MemberProjection</span><span class="o">&gt;</span> <span class="nf">findByNativeProjection</span><span class="o">(</span><span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">);</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<aside>
âš ï¸ **Native Queryê°€ í•„ìš”í•˜ë‹¤ë©´?**
ìŠ¤í”„ë§ ë°ì´í„° JPAë¥¼ ì‚¬ìš©í•˜ê¸°ë³´ë‹¤ëŠ” ìŠ¤í”„ë§ JdbcTemplate, myBatis ë“±ì„ í†µí•´ í•´ê²°í•˜ëŠ” ê²ƒì´ í›¨ì”¬ ë‚˜ìŒ!

</aside>
:ET