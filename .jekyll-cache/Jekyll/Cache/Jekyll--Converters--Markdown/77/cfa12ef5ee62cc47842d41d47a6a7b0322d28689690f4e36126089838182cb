I"áâ<aside>
âš ï¸ <strong>í•„í„°ë‚˜ ì¸í„°ì…‰í„°ë¥¼ ì™œ ì¨ì•¼ í• ê¹Œ?</strong> 
<ul>
<li>í•„í„°ë‚˜ ì¸í„°ì…‰í„° ì—†ì´ ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ì‚¬ìš©ìê°€ ì ‘ê·¼í•  ìˆ˜ ì—†ëŠ” í˜ì´ì§€ë¥¼ ìƒì„±í•˜ë ¤ë©´ <b>ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ ë¡œì§ì— ê³µí†µì ìœ¼ë¡œ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ í™•ì¸</b>í•´ì•¼ ë¨. ì´ë ‡ê²Œ ë˜ë©´ ë³µì¡í•˜ê¸°ë„ í•˜ê³  ì¶”í›„ ìˆ˜ì • ì‹œ ì´ ëª¨ë‘ë¥¼ ìˆ˜ì •í•´ì•¼ë˜ëŠ” í° ë¬¸ì œê°€ ë°œìƒí•¨.</li>
<li>ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„  <strong>ê³µí†µ ê´€ì‹¬ì‚¬ ê°œë…</strong>ì„ ë„ì…í•´ì•¼ ë¨.</li>
<li>ì¼ë°˜ì ì¸ ê³µí†µ ê´€ì‹¬ì‚¬ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ í•´ê²°í•˜ê¸° ìœ„í•´ì„  <b>AOP</b>ë„ ì‚¬ìš© ë˜ì§€ë§Œ, ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ì‚¬ëŠ” HttpServletRequestë¥¼ ì œê³µí•˜ëŠ” <b>Servlet Filter</b> ë‚˜ <b>Spring Interceptor</b>ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ì¢‹ìŒ!</li>
</ul>
</aside>

<h2 id="servlet-filter">Servlet Filter</h2>

<h3 id="ì„œë¸”ë¦¿-í•„í„°">ì„œë¸”ë¦¿ í•„í„°</h3>

<ul>
  <li>ì„œë¸”ë¦¿ì— ë“¤ì–´ê°€ê¸° ì „ ê·¸ <strong>ì…êµ¬ë¥¼ ì§€í‚¤ëŠ” ìˆ˜ë¬¸ì¥</strong>ê³¼ ê°™ì€ ì—­í• </li>
  <li><strong>ì„œë¸”ë¦¿</strong>ì´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥</li>
  <li>í•„í„° ì „ë°˜ì  íë¦„
    <ul>
      <li><code class="language-plaintext highlighter-rouge">HTTP ìš”ì²­ -&gt; WAS -&gt; í•„í„° -&gt; ì„œë¸”ë¦¿ -&gt; ì»¨íŠ¸ë¡¤ëŸ¬</code></li>
      <li><strong>í•„í„°ê°€ í˜¸ì¶œëœ ë‹¤ìŒ ì„œë¸”ë¦¿</strong>ì´ í˜¸ì¶œ (í•„í„° ì ìš© ì‹œ)</li>
      <li>ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤ ì˜ˆì‹œ â†’ ëª¨ë“  ê³ ê°ì˜ <strong>ìš”ì²­ ë¡œê·¸</strong>ë¥¼ ë‚¨ê¸°ëŠ” ìš”êµ¬ì‚¬í•­</li>
      <li>ì¶”ê°€ë¡œ í•„í„°ëŠ” <strong>URL íŒ¨í„´ì— ì ìš©</strong> ê°€ëŠ¥ (<strong>ì›¹ ê³µí†µ ê´€ì‹¬ì‚¬ì— ì‚¬ìš©</strong>í•˜ê¸° ì¢‹ìŒ)</li>
    </ul>
  </li>
  <li>í•„í„° ì œí•œ íë¦„ (ë¡œê·¸ì¸)
    <ul>
      <li>ë¡œê·¸ì¸ ì‚¬ìš©ì : <code class="language-plaintext highlighter-rouge">HTTP ìš”ì²­ -&gt; WAS -&gt; í•„í„° -&gt; ì„œë¸”ë¦¿ -&gt; ì»¨íŠ¸ë¡¤ëŸ¬</code></li>
      <li>ë¹„ ë¡œê·¸ì¸ ì‚¬ìš©ì : <code class="language-plaintext highlighter-rouge">HTTP ìš”ì²­ -&gt; WAS -&gt; í•„í„°(ì ì ˆí•˜ì§€ ì•Šì€ ìš”ì²­ì´ë¼ íŒë‹¨, **ì„œë¸”ë¦¿ í˜¸ì¶œX**)</code></li>
      <li>ì¦‰, í•„í„°ì—ì„œ íŒë‹¨ í›„ <strong>ê·¸ ì‹œì ì— ë°”ë¡œ ëë‚¼ ìˆ˜ ìˆ</strong>ìŒ</li>
    </ul>
  </li>
  <li>í•„í„° <strong>ì²´ì¸</strong>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">HTTP ìš”ì²­ -&gt; WAS -&gt; **í•„í„°1 -&gt; í•„í„°2 -&gt; í•„í„°3** -&gt; ì„œë¸”ë¦¿ -&gt; ì»¨íŠ¸ë¡¤ëŸ¬</code></li>
      <li>í•„í„°ëŠ” <strong>ì²´ì¸ìœ¼ë¡œ êµ¬ì„±</strong>, ì¤‘ê°„ì— ììœ ë¡­ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆìŒ</li>
      <li>ë¡œê·¸ ë‚¨ê¸´ í›„ ë¡œê·¸ì¸ ì²´í¬ ë“± ì—¬ëŸ¬ í•„í„°ë¥¼ ê°ˆì•„ ë¼ìš¸ ìˆ˜ ìˆìŒ</li>
      <li>í•„í„°ì˜ ì˜ë¯¸ ê·¸ëŒ€ë¡œì˜ ì—­í• ì¸ ê²ƒ</li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Filter interface</code></p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Filter</span> <span class="o">{</span>
  	 <span class="kd">public</span> <span class="k">default</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">FilterConfig</span> <span class="n">filterConfig</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{}</span>
  	 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">chain</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span><span class="o">;</span>
  	 <span class="kd">public</span> <span class="k">default</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{}</span>
  <span class="o">}</span>
</code></pre></div>    </div>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">init()</code> : í•„í„° ì´ˆê¸°í™” ë©”ì„œë“œ, ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ ìƒì„±ë  ë•Œ í˜¸ì¶œ</li>
      <li><strong><code class="language-plaintext highlighter-rouge">doFilter()</code></strong> : ê³ ê°ì˜ ìš”ì²­ì´ ì˜¬ ë•Œ ë§ˆë‹¤ í˜¸ì¶œë¨. <strong>í•„í„°ì˜ ë¡œì§ êµ¬í˜„ ë¶€ë¶„. (í•„ìˆ˜ êµ¬í˜„ í•­ëª©)</strong></li>
      <li><code class="language-plaintext highlighter-rouge">destroy()</code> : ì¢…ë£Œ ë©”ì„œë“œ, ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë  ë•Œ í˜¸ì¶œë¨</li>
      <li>í•´ë‹¹ interfaceë¥¼ ìš°ë¦¬ê°€ <strong>ì‚¬ìš©í•˜ê³  ì‹¶ì€ ìš©ë„ì˜ êµ¬í˜„ì²´ë¡œ</strong> ë§Œë“¤ì–´ ì‚¬ìš©í•˜ë©´ ë¨</li>
    </ul>
  </li>
</ul>

<h3 id="ìš”ì²­-ë¡œê·¸-by-ì„œë¸”ë¦¿-í•„í„°">ìš”ì²­ ë¡œê·¸ (by ì„œë¸”ë¦¿ í•„í„°)</h3>

<ul>
  <li>ëª¨ë“  ìš”ì²­ì„ ë¡œê·¸ë¡œ ë‚¨ê¸°ëŠ” í•„í„° ê°œë°œ</li>
  <li><code class="language-plaintext highlighter-rouge">LogFilter</code>
    <ul>
      <li>Filter interfaceë¥¼ êµ¬í˜„í•˜ì—¬ custom Filter ìƒì„± â†’ <code class="language-plaintext highlighter-rouge">public class LogFilter implements Filter {}</code></li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">doFilter</code></p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@Override</span> <span class="c1">// í•„í„° ë™ì‘</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">chain</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
      <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"log filter doFilter"</span><span class="o">);</span>
        
      <span class="nc">HttpServletRequest</span> <span class="n">httpRequest</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpServletRequest</span><span class="o">)</span> <span class="n">request</span><span class="o">;</span> <span class="c1">// Httpë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•¨</span>
      <span class="nc">String</span> <span class="n">requestURI</span> <span class="o">=</span> <span class="n">httpRequest</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">();</span>
        
      <span class="nc">String</span> <span class="n">uuid</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span> <span class="c1">// ìš”ì²­ êµ¬ë¶„ì„ ìœ„í•œ UUID</span>
        
      <span class="k">try</span> <span class="o">{</span>
          <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"REQUEST [{}][{}]"</span><span class="o">,</span> <span class="n">uuid</span><span class="o">,</span> <span class="n">requestURI</span><span class="o">);</span>
          <span class="n">chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span> <span class="c1">// ë‹¤ìŒ í•„í„°ê°€ ìˆìœ¼ë©´ í•„í„°ë¥¼ í˜¸ì¶œí•˜ê³ , í•„í„°ê°€ ì—†ìœ¼ë©´ ë””ìŠ¤íŒ¨ì¹˜ì„œë¸”ë¦¿ì„ í˜¸ì¶œ</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">throw</span> <span class="n">e</span><span class="o">;</span>
      <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
          <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"RESPONSE [{}][{}]"</span><span class="o">,</span> <span class="n">uuid</span><span class="o">,</span> <span class="n">requestURI</span><span class="o">);</span>
      <span class="o">}</span>
        
  <span class="o">}</span>
</code></pre></div>        </div>

        <ul>
          <li>HTTP ìš”ì²­ì´ ì˜¤ë©´ í•´ë‹¹ <strong>doFilter í˜¸ì¶œ</strong>ë¨</li>
          <li><strong>ì›¹ ìƒì˜ request</strong>ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ <code class="language-plaintext highlighter-rouge">HttpServletRequest</code> ë¡œ <strong>down casting</strong> ì§„í–‰ â†’ <code class="language-plaintext highlighter-rouge">(HttpServletRequest) request;</code></li>
          <li><code class="language-plaintext highlighter-rouge">try</code> : ìš”ì²­ ë¡œê·¸ë¥¼ ë‚¨ê¸°ê³  <code class="language-plaintext highlighter-rouge">chain.doFilter(request, response)</code> ë¥¼ í†µí•´ ìš”ì²­ê³¼ ì‘ë‹µì„ ê°€ì§„ ìƒíƒœë¡œ <strong>ë‹¤ìŒ í•„í„° í˜¹ì€ ì„œë¸”ë¦¿ì„ í˜¸ì¶œ</strong> (ë‹¤ìŒ ì²´ì¸ìœ¼ë¡œ ë„˜ì–´ê°€ì§€ ì•Šìœ¼ë©´ ê·¸ëŒ€ë¡œ ì¢…ë£Œë¨!)</li>
          <li><code class="language-plaintext highlighter-rouge">catch</code> : ì—ëŸ¬ ë°œìƒì‹œ ì¡ì•„ì„œ ê·¸ëƒ¥ ë˜ì ¸ì¤Œ</li>
          <li><code class="language-plaintext highlighter-rouge">finally</code> : ì—ëŸ¬ê°€ ë°œìƒí•˜ë“  ë°œìƒí•˜ì§€ ì•Šë“  ë¬´ì¡°ê±´ ì‹¤í–‰</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">WebConfig</code></p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@Bean</span> <span class="c1">// í•„í„° ë“±ë¡</span>
  <span class="kd">public</span> <span class="nc">FilterRegistrationBean</span> <span class="nf">logFilter</span><span class="o">()</span> <span class="o">{</span>
      <span class="nc">FilterRegistrationBean</span><span class="o">&lt;</span><span class="nc">Filter</span><span class="o">&gt;</span> <span class="n">filterRegistrationBean</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FilterRegistrationBean</span><span class="o">&lt;&gt;();</span>
      <span class="n">filterRegistrationBean</span><span class="o">.</span><span class="na">setFilter</span><span class="o">(</span><span class="k">new</span> <span class="nc">LogFilter</span><span class="o">());</span> <span class="c1">// í•„í„° ì§€ì •</span>
      <span class="n">filterRegistrationBean</span><span class="o">.</span><span class="na">setOrder</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span> <span class="c1">// ìˆœì„œ ì§€ì •</span>
      <span class="n">filterRegistrationBean</span><span class="o">.</span><span class="na">addUrlPatterns</span><span class="o">(</span><span class="s">"/*"</span><span class="o">);</span> <span class="c1">// ì ìš©í•  URI íŒ¨í„´ ì„¤ì •</span>
    
      <span class="k">return</span> <span class="n">filterRegistrationBean</span><span class="o">;</span>
  <span class="o">}</span>
</code></pre></div>    </div>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">@Configuration</code> : Springì˜ ì„¤ì • ë¶€ë¶„</li>
      <li>í•´ë‹¹ LogFilter ì‚¬ìš©í•˜ë„ë¡ <strong>ë“±ë¡</strong></li>
      <li>Spring Bootì—ì„  <code class="language-plaintext highlighter-rouge">FilterRegistrationBean</code> ë¥¼ í†µí•´ <strong>Filter ë“±ë¡ ê°€ëŠ¥</strong></li>
      <li><code class="language-plaintext highlighter-rouge">filterRegistrationBean.setFilter()</code> : ì‚¬ìš©í•  í•„í„° ì§€ì •</li>
      <li><code class="language-plaintext highlighter-rouge">filterRegistrationBean.setOrder(1);</code> : í•„í„° <strong>ìˆœì„œ</strong> ì§€ì • (1ì´ ê°€ì¥ ë¨¼ì €)</li>
      <li><code class="language-plaintext highlighter-rouge">filterRegistrationBean.addUrlPatterns("/*");</code> : <strong>ì ìš©í•  URI íŒ¨í„´</strong> ì„¤ì • (í•œë²ˆì— ì—¬ëŸ¬ íŒ¨í„´ì„ ì§€ì • ê°€ëŠ¥)</li>
    </ul>
  </li>
</ul>

<aside>
âš ï¸ <strong>Filter ë“±ë¡ì˜ ë‹¤ë¥¸ ë°©ë²•</strong> <br />
<code>@ServletComponentScan</code> , <code>@WebFilter(filterName = "logFilter", urlPatterns = "/*")</code> ì˜ ì–´ë…¸íƒœì´ì…˜ ê¸°ë°˜ìœ¼ë¡œë„ ê°„í¸íˆ ë“±ë¡í•  ìˆ˜ ìˆì§€ë§Œ, í•´ë‹¹ ì–´ë…¸í…Œì´ì…˜ë“¤ë¡œëŠ” <b>í•„í„° ìˆœì„œ ì¡°ì ˆ ë¶ˆê°€</b>! ê·¸ë˜ì„œ <code>Confinguration</code>ì—ì„œ <code>FilterRegistrationBean</code> ì„ <code>Bean</code>ìœ¼ë¡œ ë“±ë¡í•˜ì—¬ ì„¤ì •í•˜ëŠ”ê²Œ BEST!

</aside>

<blockquote>
  <p>ì°¸ê³  : HTTP ìš”ì²­ ì‹œ ê°™ì€ ìš”ì²­ì˜ ë¡œê·¸ì— ëª¨ë‘ ê°™ì€ ì‹ë³„ìë¥¼ ìë™ìœ¼ë¡œ ë‚¨ê¸°ëŠ” ë°©ë²•ì€ <strong>logback mdc</strong></p>

</blockquote>

<h3 id="ë¡œê·¸ì¸-ì¸ì¦-by-ì„œë¸”ë¦¿-í•„í„°">ë¡œê·¸ì¸ ì¸ì¦ (by ì„œë¸”ë¦¿ í•„í„°)</h3>

<ul>
  <li><strong>ë¡œê·¸ì¸ ì¸ì¦ ì²´í¬ í•„í„°</strong>. ë¡œê·¸ì¸ ë˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ì ‘ê·¼ ë¶ˆê°€í•˜ë„ë¡!</li>
  <li><code class="language-plaintext highlighter-rouge">LoginCheckFilter</code>
    <ul>
      <li>ì ‘ê·¼ ë¶ˆê°€ í˜ì´ì§€ë¥¼ ì§€ì •í•˜ê¸° ë³´ë‹¤ëŠ” <strong>ì ‘ê·¼ ê°€ëŠ¥í•œ white list ë¥¼ í†µí•´ ê´€ë¦¬</strong>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">private static final String[] *whiteList* = new String[]{"/", "/login", "/logout", "/members/add", "/css/*"};</code></li>
          <li>í™ˆ, ë¡œê·¸ì¸í™”ë©´, ë¡œê·¸ì•„ì›ƒ, íšŒì›ê°€ì…, â€œ<strong>css íŒŒì¼â€</strong> ë“±ì€ ë¡œê·¸ì¸ ì—†ì´ë„ ì ‘ê·¼ ê°€ëŠ¥í•´ì•¼ ë¨!</li>
          <li>
            <p>whilteListì— í¬í•¨ë˜ëŠ” ì§€ í™•ì¸ (í¬í•¨ë˜ì§€ ì•Šì€ ì• ë“¤ì— ëŒ€í•´ì„œë§Œ ì¸ì¦ì²´í¬ ì‹¤í–‰!)</p>

            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isLoginCheckPath</span><span class="o">(</span><span class="nc">String</span> <span class="n">requestURI</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="o">!</span><span class="nc">PatternMatchUtils</span><span class="o">.</span><span class="na">simpleMatch</span><span class="o">(</span><span class="n">whiteList</span><span class="o">,</span> <span class="n">requestURI</span><span class="o">);</span>
  <span class="o">}</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>Filter interfaceë¥¼ êµ¬í˜„í•˜ì—¬ custom Filter ìƒì„± â†’ <code class="language-plaintext highlighter-rouge">public class LoginCheckFilter implements Filter {}</code></li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">doFilter</code></p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">chain</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
      <span class="nc">HttpServletRequest</span> <span class="n">httpRequest</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpServletRequest</span><span class="o">)</span> <span class="n">request</span><span class="o">;</span>
      <span class="nc">String</span> <span class="n">requestURI</span> <span class="o">=</span> <span class="n">httpRequest</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">();</span>
        
      <span class="nc">HttpServletResponse</span> <span class="n">httpResponse</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpServletResponse</span><span class="o">)</span> <span class="n">response</span><span class="o">;</span>
        
      <span class="k">try</span> <span class="o">{</span>
          <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"ì¸ì¦ ì²´í¬ í•„í„° ì‹œì‘ : [{}]"</span><span class="o">,</span> <span class="n">requestURI</span><span class="o">);</span>
        
          <span class="k">if</span> <span class="o">(</span><span class="n">isLoginCheckPath</span><span class="o">(</span><span class="n">requestURI</span><span class="o">))</span> <span class="o">{</span>
              <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"ì¸ì¦ ì²´í¬ ë¡œì§ ì‹¤í–‰ : [{}]"</span><span class="o">,</span> <span class="n">requestURI</span><span class="o">);</span>
              <span class="nc">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">httpRequest</span><span class="o">.</span><span class="na">getSession</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
              <span class="k">if</span> <span class="o">(</span><span class="n">session</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="nc">SessionConst</span><span class="o">.</span><span class="na">LOGIN_MEMBER</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                  <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"ë¯¸ì¸ì¦ ì‚¬ìš©ì ìš”ì²­ : [{}]"</span><span class="o">,</span> <span class="n">requestURI</span><span class="o">);</span>
                  <span class="c1">// ë¡œê·¸ì¸ìœ¼ë¡œ redirect. urlì„ ì´ë ‡ê²Œ ë³´ë‚´ëŠ” ê²ƒì€ ë¡œê·¸ì¸ í›„ ë‹¤ì‹œ í˜„ì¬ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸° ìœ„í•¨ -&gt; pathVariable ì´ìš©</span>
                  <span class="n">httpResponse</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">"/login?redirectURL="</span> <span class="o">+</span> <span class="n">requestURI</span><span class="o">);</span>
                  <span class="k">return</span><span class="o">;</span>
              <span class="o">}</span>
          <span class="o">}</span>
        
          <span class="n">chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span> <span class="c1">// ë‹¤ìŒ í•„í„°ë¡œ ì´ë™. í•„í„°ê°€ ì—†ìœ¼ë©´ ë””ìŠ¤íŒ¨ì¹˜ì„œë¸”ë¦¿ìœ¼ë¡œ ì´ë™í•˜ì—¬ ì»¨í…Œì´ë„ˆ ë™ì‘</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">throw</span> <span class="n">e</span><span class="o">;</span>
      <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
          <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"ì¸ì¦ ì²´í¬ í•„í„° ì¢…ë£Œ : [{}]"</span><span class="o">,</span> <span class="n">requestURI</span><span class="o">);</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></div>        </div>

        <ul>
          <li>HTTP ìš”ì²­ì´ ì˜¤ë©´ í•´ë‹¹ <strong>doFilter í˜¸ì¶œ</strong>ë¨</li>
          <li><strong>ì›¹ ìƒì˜ request</strong>ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ <code class="language-plaintext highlighter-rouge">HttpServletRequest</code> ë¡œ <strong>down casting</strong> ì§„í–‰ â†’ <code class="language-plaintext highlighter-rouge">(HttpServletRequest) request;</code></li>
          <li>try
            <ul>
              <li><code class="language-plaintext highlighter-rouge">isLoginCheckPath(requestURI)</code> ë¥¼ í†µí•´ whiteListì— í¬í•¨ë˜ëŠ” ì§€ í™•ì¸ (í¬í•¨ë˜ì§€ ì•Šì€ ì• ë“¤ì— ëŒ€í•´ì„œë§Œ ì¸ì¦ì²´í¬ ì‹¤í–‰!)</li>
              <li>ë¡œê·¸ì¸ ì¸ì¦ì´ í•„ìš”í•œ ê²½ìš°
                <ul>
                  <li>Sessionì„ í†µí•´ ë¡œê·¸ì¸ ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸</li>
                  <li>
                    <p>ë¡œê·¸ì¸ ë˜ì–´ ìˆì§€ ì•Šê±°ë‚˜ ë¯¸ì¸ì¦ ì‚¬ìš©ìì¼ ê²½ìš° <strong><code class="language-plaintext highlighter-rouge">httpResponse.sendRedirect("/login?redirectURL=" + requestURI);</code></strong> ë¥¼ í†µí•´ <strong>redirect ì‹¤í–‰</strong></p>

                    <aside>
  âš ï¸ <strong>RedirectURL</strong> <br />
  redirectë¥¼ ë³´ë‚¼ ë•Œ, ë¡œê·¸ì¸ í›„ ë°”ë¡œ <b>ë‹¤ì‹œ ê·¸ ìš”ì²­í–ˆë˜ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê²Œ</b> í•˜ê¸° ìœ„í•´ì„œ <b>í•´ë‹¹ í˜ì´ì§€ ì •ë³´ë¥¼ ë³´ë‚´ì¤Œ</b>. <br />
  â†’ ë¡œê·¸ì¸ í›„ controllerì—ì„œ <code>@RequestParam</code> ì„ í†µí•´ ì´ì „ í˜ì´ì§€ë¡œ ë‹¤ì‹œ ëŒì•„ê°ˆ ìˆ˜ ìˆìŒ [ì‚¬ìš©ì í¸ì˜ì„± ì¦ëŒ€] 
                    
  </aside>
                  </li>
                  <li><code class="language-plaintext highlighter-rouge">return</code> ì„ í†µí•´ ë‹¤ìŒ ì²´ì¸ìœ¼ë¡œ ë„˜ì–´ê°€ì§€ ì•Šê³  <strong>í•´ë‹¹ redirectë¥¼ ë°”ë¡œ ì‹¤í–‰</strong>í•  ìˆ˜ ìˆë„ë¡ ì„¤ì • <strong>[ì¤‘ìš”]</strong></li>
                </ul>
              </li>
              <li>ë¡œê·¸ì¸ ì¸ì¦ì´ í•„ìš”í•˜ì§€ ì•Šê±°ë‚˜ ë¡œê·¸ì¸ ì¸ì¦ì—ì„œ í†µê³¼í•œ ê²½ìš°
                <ul>
                  <li><code class="language-plaintext highlighter-rouge">chain.doFilter(request, response)</code> ë¥¼ í†µí•´ ìš”ì²­ê³¼ ì‘ë‹µì„ ê°€ì§„ ìƒíƒœë¡œ <strong>ë‹¤ìŒ í•„í„° í˜¹ì€ ì„œë¸”ë¦¿ì„ í˜¸ì¶œ</strong></li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">WebConfig</code>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">loginCheckFilter()</code> ì¶”ê°€
            <ul>
              <li>ì´ì „ê³¼ ì½”ë“œëŠ” ìœ ì‚¬</li>
              <li>í•˜ì§€ë§Œ, orderë¥¼ 2ë¡œ ë‘ ìœ¼ë¡œì¨ <strong>LogFilter ì´í›„ì— ì§„í–‰</strong>ë  ìˆ˜ ìˆë„ë¡ ì„¤ì •</li>
              <li>ëª¨ë“  URLì— ì‘ë™í•˜ë„ë¡ íŒ¨í„´ ì§€ì • â†’ <strong>í•„í„° ì•ˆì—ì„œ whiteListë¡œ ê±¸ëŸ¬</strong>ëƒ„ (ë¯¸ë˜ì˜ ì¶”ê°€ì ì¸ ì¸ì¦ í˜ì´ì§€ë¥¼ í¸í•˜ê²Œ ë„£ê¸° ìœ„í•¨)</li>
            </ul>
          </li>
        </ul>
      </li>
      <li><strong>RedirectURL ì²˜ë¦¬ [ì¤‘ìš”]</strong>
        <ul>
          <li>ë¡œê·¸ì¸ì— ì„±ê³µí•˜ë©´ <strong>ì²˜ìŒ ìš”ì²­í•œ URLë¡œ ì´ë™</strong>í•˜ëŠ” ê¸°ëŠ¥</li>
          <li><code class="language-plaintext highlighter-rouge">@PostMapping("/login")</code> ë¶€ë¶„</li>
        </ul>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/login"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">loginV4</span><span class="o">(</span>
  		<span class="nd">@Validated</span> <span class="nd">@ModelAttribute</span><span class="o">(</span><span class="s">"loginForm"</span><span class="o">)</span> <span class="nc">LoginForm</span> <span class="n">form</span><span class="o">,</span> <span class="nc">BindingResult</span> <span class="n">bindingResult</span><span class="o">,</span>
      <span class="nd">@RequestParam</span><span class="o">(</span><span class="n">defaultValue</span> <span class="o">=</span> <span class="s">"/"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">redirectURL</span><span class="o">,</span>
      <span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        
  		<span class="o">...</span>
        
      <span class="k">return</span> <span class="s">"redirect:"</span><span class="o">+</span><span class="n">redirectURL</span><span class="o">;</span>
  <span class="o">}</span>
</code></pre></div>        </div>

        <ul>
          <li><code class="language-plaintext highlighter-rouge">@RequestParam(defaultValue = "/") String redirectURL</code> ì„ í†µí•´ì„œ query parameter ê°€ ìˆìœ¼ë©´ í•´ë‹¹ urlë¡œ ê°ˆ ìˆ˜ ìˆë„ë¡ ì„¤ì • (ì—†ìœ¼ë©´ ê·¸ëƒ¥ Home ìœ¼ë¡œ)</li>
          <li>ë¡œê·¸ì¸ ì²´í¬ í•„í„°ì—ì„œ, ë¯¸ì¸ì¦ ì‚¬ìš©ìëŠ” ìš”ì²­ ê²½ë¡œë¥¼ í¬í•¨í•´ì„œ <code class="language-plaintext highlighter-rouge">/login</code> ì— <strong>redirectURL ìš”ì²­ íŒŒë¼ë¯¸í„°</strong>ë¥¼ ì¶”ê°€í•´ì„œ ìš”ì²­. ì´ ê°’ì„ ì‚¬ìš©í•´ì„œ ë¡œê·¸ì¸ ì„±ê³µì‹œ í•´ë‹¹ ê²½ë¡œë¡œ ê³ ê°ì„ <strong>redirect</strong> í•¨</li>
          <li>ì¦‰, ì´ë¥¼ í†µí•´ì„œ ë§Œì•½ ì¸ì¦ì´ í•„ìš”í•œ URLë¡œ ë“¤ì–´ê°”ë‹¤ê°€ ë¡œê·¸ì¸ì´ í•„ìš”í•˜ì—¬ <strong>ë¡œê·¸ì¸ í•œ í›„ì— ë‹¤ì‹œ ê·¸ URLë¡œ ê°ˆ ìˆ˜ ìˆë„ë¡ ì„¤ì •</strong>ì´ ê°€ëŠ¥!! <strong>[ì‚¬ìš©ì í¸ì˜ì„±ì„ ìœ„í•´ ë§ì´ ì“°ëŠ” ë°©ì‹, ì¤‘ìš”!]</strong></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<aside>
âš ï¸ <strong>ì„œë¸”ë¦¿ í•„í„°ë¥¼ ì‚¬ìš©í•œ ê²°ê³¼!</strong> <br />
ì„œë¸”ë¦¿ í•„í„°ë¥¼ ì˜ ì‚¬ìš©í•œ ë•ë¶„ì— ë¡œê·¸ì¸ í•˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ë‚˜ë¨¸ì§€ ê²½ë¡œì— ë“¤ì–´ê°ˆ ìˆ˜ ì—†ê²Œ ë¨! ë˜í•œ <b>ê³µí†µ ê´€ì‹¬ì‚¬ë¥¼ ì„œë¸”ë¦¿ í•„í„°ë¥¼ ì‚¬ìš©í•´ì„œ í•´ê²°</b>í•œ ë•ë¶„ì— í–¥í›„ ë¡œê·¸ì¸ ê´€ë ¨ ì •ì±…ì´ ë³€ê²½ë˜ì–´ë„ ì´ ë¶€ë¶„ë§Œ ë³€ê²½í•˜ë©´ ì›í•˜ëŠ”ëŒ€ë¡œ ë™ì‘í•˜ê²Œ í•  ìˆ˜ ìˆìŒ!

</aside>

<h2 id="spring-interceptor">Spring Interceptor</h2>

<h3 id="ìŠ¤í”„ë§-ì¸í„°ì…‰í„°">ìŠ¤í”„ë§ ì¸í„°ì…‰í„°</h3>

<ul>
  <li><strong>ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ ì‚¬í•­ì„ íš¨ê³¼ì ìœ¼ë¡œ í•´ê²°</strong>í•  ìˆ˜ ìˆëŠ” ê¸°ìˆ </li>
  <li><strong>ì„œë¸”ë¦¿ ì´í›„</strong> ì»¨íŠ¸ë¡¤ëŸ¬ ì…êµ¬ë¥¼ ì§€í‚¤ëŠ” <strong>ìˆ˜ë¬¸ì¥</strong>ê°™ì€ ì—­í• </li>
  <li><strong>ìŠ¤í”„ë§ MVC</strong>ê°€ ì œê³µí•˜ëŠ” ê¸°ìˆ </li>
  <li>ì¸í„°ì…‰í„° ì „ë°˜ì ì¸ íë¦„
    <ul>
      <li><code class="language-plaintext highlighter-rouge">HTTP ìš”ì²­ -&gt; WAS -&gt; í•„í„° -&gt; ì„œë¸”ë¦¿ -&gt; ìŠ¤í”„ë§ ì¸í„°ì…‰í„° -&gt; ì»¨íŠ¸ë¡¤ëŸ¬</code></li>
      <li>ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿ê³¼ ì»¨íŠ¸ë¡¤ëŸ¬ ì‚¬ì´ì—ì„œ <strong>ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì§ì „ì— í˜¸ì¶œ</strong> (ìŠ¤í”„ë§ MVCê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì´ê¸° ë•Œë¬¸ì— <strong>ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿ ì´í›„</strong>ì— ë™ì‘. <strong>[ìŠ¤í”„ë§ MVCì˜ ì‹œì‘ì  = ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿]</strong>)</li>
      <li>ì„œë¸”ë¦¿ URL íŒ¨í„´ë³´ë‹¤ ë” ì •ë°€í•œ ì„¤ì • ê°€ëŠ¥</li>
    </ul>
  </li>
  <li>ì¸í„°ì…‰í„° ì œí•œ
    <ul>
      <li>ë¡œê·¸ì¸ ì‚¬ìš©ì : <code class="language-plaintext highlighter-rouge">HTTP ìš”ì²­ -&gt; WAS -&gt; í•„í„° -&gt; ì„œë¸”ë¦¿ -&gt; ìŠ¤í”„ë§ ì¸í„°ì…‰í„° -&gt; ì»¨íŠ¸ë¡¤ëŸ¬</code></li>
      <li>ë¹„ ë¡œê·¸ì¸ ì‚¬ìš©ì : <code class="language-plaintext highlighter-rouge">HTTP ìš”ì²­ -&gt; WAS -&gt; í•„í„° -&gt; ì„œë¸”ë¦¿ -&gt; ìŠ¤í”„ë§ ì¸í„°ì…‰í„°</code></li>
      <li>í•„í„°ì™€ ë§ˆì°¬ê°€ì§€ë¡œ <strong>ì¸í„°ì…‰í„°ì—ì„œ</strong> ì ì ˆí•œ ìš”ì²­ì´ ì•„ë‹ˆë¼ê³  íŒë‹¨í•˜ë©´ <strong>ê·¸ ì¦‰ì‹œ ëë‚¼ ìˆ˜ ìˆìŒ</strong></li>
    </ul>
  </li>
  <li>ì¸í„°ì…‰í„° ì²´ì¸
    <ul>
      <li><code class="language-plaintext highlighter-rouge">HTTP ìš”ì²­ -&gt; WAS -&gt; í•„í„° -&gt; ì„œë¸”ë¦¿ -&gt; ì¸í„°ì…‰í„°1 -&gt; ì¸í„°ì…‰í„°2 -&gt; ì»¨íŠ¸ë¡¤ëŸ¬</code></li>
      <li>í•„í„°ì™€ ë§ˆì°¬ê°€ì§€ë¡œ <strong>ì—¬ëŸ¬ ì¸í„°ì…‰í„°ë¥¼ ë¼ì–´ ì‚¬ìš©</strong>í•  ìˆ˜ ìˆìŒ</li>
    </ul>
  </li>
</ul>

<aside>
âš ï¸ <strong>í•„í„°ë‘ ì¸í„°ì…‰í„°ë‘ ì°¨ì´ê°€ ì—†ëŠ” ê²ƒ ê°™ì€ë°? ì¸í„°ì…‰í„°ëŠ” ì™œ ìˆëŠ” ê±°ì§€?</strong> <br />
ë¬¼ë¡  í˜¸ì¶œë˜ëŠ” ìˆœì„œë§Œ ë‹¤ë¥´ê³  ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ ë¹„ìŠ·í•´ë³´ì´ì§€ë§Œ, ì¸í„°ì…‰í„°ëŠ” ì„œë¸”ë¦¿ í•„í„°ë³´ë‹¤ <b>í¸ë¦¬í•˜ê²Œ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ê³  ë” ì •êµí•˜ë©° ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ì§€ì›</b>í•¨!!

</aside>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">HandlerInterceptor Interface</code></p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">HandlerInterceptor</span> <span class="o">{</span>
  	<span class="k">default</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{}</span>
    
  	<span class="k">default</span> <span class="kt">void</span> <span class="nf">postHandle</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">handler</span><span class="o">,</span>
  			<span class="nd">@Nullable</span> <span class="nc">ModelAndView</span> <span class="n">modelAndView</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{}</span>
    
  	<span class="k">default</span> <span class="kt">void</span> <span class="nf">afterCompletion</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">handler</span><span class="o">,</span>
  			<span class="nd">@Nullable</span> <span class="nc">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{}</span>
  <span class="o">}</span>
</code></pre></div>    </div>

    <ul>
      <li><strong><code class="language-plaintext highlighter-rouge">preHandle</code></strong>
        <ul>
          <li>ì»¨íŠ¸ë¡¤ëŸ¬ <strong>í˜¸ì¶œ ì „</strong> ì‹¤í–‰ë˜ëŠ” Method</li>
          <li>ë°˜í™˜ê°’ì´ <strong>true</strong> ì´ë©´ <strong>ë‹¤ìŒ ì²´ì¸</strong>ìœ¼ë¡œ ë„˜ì–´ê°€ê³  <strong>false</strong> ì´ë©´ ë’¤ì— ì²´ì¸ì€ ì§„í–‰ë˜ì§€ ì•ŠìŒ</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">postHandle</code> : ì»¨íŠ¸ë¡¤ëŸ¬ <strong>í˜¸ì¶œ í›„</strong>ì— í˜¸ì¶œë¨</li>
      <li><code class="language-plaintext highlighter-rouge">afterCompletion</code> : ë·°ê°€ <strong>ë Œë”ë§ ëœ ì´í›„</strong>ì— í˜¸ì¶œë¨</li>
      <li>í•´ë‹¹ interfaceë¥¼ ìš°ë¦¬ê°€ ì‚¬ìš©í•˜ê³  ì‹¶ì€ <strong>êµ¬í˜„ì²´</strong>ë¡œ ë§Œë“¤ì–´ ì‚¬ìš©í•˜ë©´ ë¨</li>
    </ul>
  </li>
  <li>
    <p>ìŠ¤í”„ë§ ì¸í„°ì…‰í„° í˜¸ì¶œ íë¦„</p>

    <p><img src="/images/posts/post-220530/Untitled.png" alt="" /></p>

    <ul>
      <li>Interceptorê°€ ì¡´ì¬í•œ ê²½ìš°(í•˜ë‚˜), <strong>HTTP ìš”ì²­</strong>ì´ ë“¤ì–´ì˜¤ë©´ <code class="language-plaintext highlighter-rouge">DispatcherServlet</code>ì—ì„œ ë“±ë¡ëœ Interceptorì˜ <strong><code class="language-plaintext highlighter-rouge">preHandle</code>ì„ í˜¸ì¶œ</strong>, ê·¸ í›„ ìš”ì²­ì— ë§¤í•‘ëœ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë‹¤ë£° ìˆ˜ ìˆëŠ” <code class="language-plaintext highlighter-rouge">handlerAdaptor</code>ë¥¼ í˜¸ì¶œí•´ì„œ <code class="language-plaintext highlighter-rouge">controller</code> ì‹¤í–‰. ê·¸ í›„ ì‹¤í–‰ ê²°ê³¼ë¡œ <code class="language-plaintext highlighter-rouge">ModelAndView</code>ë¥¼ ë°˜í™˜í•˜ê³  <code class="language-plaintext highlighter-rouge">postHandle</code>ë¡œ ë„˜ì–´ê° (ê³ ë¡œ <code class="language-plaintext highlighter-rouge">postHandle</code>ì—ì„  <code class="language-plaintext highlighter-rouge">ModleAndView</code> ì‚¬ìš© ê°€ëŠ¥) ì´í›„ <code class="language-plaintext highlighter-rouge">Veiw</code>ë¥¼ renderingí•˜ê³  ë§ˆì§€ë§‰ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">afterCompletion</code>ì´ í˜¸ì¶œë˜ê³  ë§ˆì§€ë§‰ìœ¼ë¡œ <strong>HTTP ì‘ë‹µ</strong>ì´ ë‚˜ê°.</li>
      <li>ì—¬ê¸°ì„œë„ <strong>í•„í„°ì™€ì˜ ì°¨ì´</strong>ë¥¼ ëŠë‚„ ìˆ˜ ìˆìŒ (ë” ì„¸ë¶€ì ì„!)</li>
    </ul>
  </li>
  <li>
    <p>ìŠ¤í”„ë§ ì¸í„°ì…‰í„° ì˜ˆì™¸ ìƒí™©</p>

    <p><img src="/images/posts/post-220530/Untitled 1.png" alt="" /></p>

    <ul>
      <li>ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì˜ˆì™¸ ë°œìƒ ì‹œ
        <ul>
          <li><code class="language-plaintext highlighter-rouge">preHandle</code> ì€ ì „ê³¼ ë™ì¼í•˜ê²Œ í˜¸ì¶œ ë¨</li>
          <li><code class="language-plaintext highlighter-rouge">postHandle</code> ì€ <strong>í˜¸ì¶œë˜ì§€ ì•ŠìŒ</strong></li>
          <li><code class="language-plaintext highlighter-rouge">afterCompletion</code> ì€ ì „ê³¼ ë™ì¼í•˜ê²Œ í˜¸ì¶œ ë¨. ì¶”ê°€ë¡œ ì˜ˆì™¸ ë°œìƒ ì‹œ <strong>ì˜ˆì™¸ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ</strong> ë°›ì•„ì„œ ì–´ë–¤ ì˜ˆì™¸ê°€ ë°œìƒí–ˆëŠ”ì§€ ë¡œê·¸ë¡œ ë‚¨ê¸¸ ìˆ˜ ìˆìŒ</li>
        </ul>
      </li>
      <li>ì¦‰, <strong>ì˜ˆì™¸ì™€ ë¬´ê´€í•˜ê²Œ ê³µí†µ ì²˜ë¦¬</strong>ë¥¼ í•˜ë ¤ë©´ <strong><code class="language-plaintext highlighter-rouge">afterCompletion</code></strong>ì„ ì‚¬ìš© í•´ì•¼ ë¨ (<code class="language-plaintext highlighter-rouge">postHandle</code>ì€ ì˜ˆì™¸ ë°œìƒ ì‹œ í˜¸ì¶œë˜ì§€ ì•ŠìŒ)</li>
      <li>ì—¬ê¸°ì„œ <strong>í•„í„°ì™€ì˜ í° ì°¨ì´</strong>ë¥¼ ëŠë‚„ ìˆ˜ ìˆìŒ (ë” ì •ë°€í•¨!)</li>
    </ul>
  </li>
</ul>

<h3 id="ìš”ì²­-ë¡œê·¸-by-ìŠ¤í”„ë§-ì¸í„°ì…‰í„°">ìš”ì²­ ë¡œê·¸ (by ìŠ¤í”„ë§ ì¸í„°ì…‰í„°)</h3>

<ul>
  <li><strong>ëª¨ë“  ìš”ì²­ ë¡œê·¸</strong>ë¥¼ ë‚¨ê¸°ëŠ” Interceptor ê°œë°œ</li>
  <li><code class="language-plaintext highlighter-rouge">LogInterceptor</code>
    <ul>
      <li>Interceptor interfaceë¥¼ <strong>êµ¬í˜„</strong>í•˜ì—¬ custom Incerceptor ìƒì„± â†’ <code class="language-plaintext highlighter-rouge">public class LogInterceptor implements HandlerInterceptor {}</code></li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">preHandle</code></p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
      <span class="nc">String</span> <span class="n">requestURI</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">();</span>
      <span class="nc">String</span> <span class="n">uuid</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span> <span class="c1">// filter ì²˜ëŸ¼ uuidë¥¼ ì¸í„°ì…‰í„°ì˜ ëë‹¨(afterCompletion)ì— ë„˜ê²¨ì¤˜ì•¼ë¨</span>
        
      <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="no">LOG_ID</span><span class="o">,</span><span class="n">uuid</span><span class="o">);</span> <span class="c1">// afterCompletionì—ì„œ ì‚¬ìš© ê°€ëŠ¥</span>
        
      <span class="c1">// @RequestMapping : HandlerMethod</span>
      <span class="c1">// ì •ì  ë¦¬ì†ŒìŠ¤ : ResourceHttpRequestHandler</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">handler</span> <span class="k">instanceof</span> <span class="nc">HandlerMethod</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// @RequestMapping ê³¼ ê´€ë ¨ëœ Handler</span>
          <span class="nc">HandlerMethod</span> <span class="n">hm</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HandlerMethod</span><span class="o">)</span> <span class="n">handler</span><span class="o">;</span> <span class="c1">// í˜¸ì¶œí•  ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì˜ ëª¨ë“  ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆìŒ</span>
      <span class="o">}</span>
        
      <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"REQUEST [{}][{}][{}]"</span><span class="o">,</span> <span class="n">uuid</span><span class="o">,</span> <span class="n">requestURI</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
      <span class="k">return</span> <span class="kc">true</span><span class="o">;</span> <span class="c1">// ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°€ê²Œ í•´ì¤Œ</span>
  <span class="o">}</span>
</code></pre></div>        </div>

        <ul>
          <li>HTTP ìš”ì²­ì´ ì˜¤ë©´ <strong>ì„œë¸”ë¦¿ ì‹¤í–‰ ì´í›„</strong> <strong><code class="language-plaintext highlighter-rouge">preHandle</code> ì´ í˜¸ì¶œ</strong>ë¨</li>
          <li><code class="language-plaintext highlighter-rouge">request.setAttribute(LOG_ID, uuid);</code> : LogInterceptor ë„ ì‹±ê¸€í†¤ ì²˜ëŸ¼ ì‚¬ìš©ë˜ê¸° ë•Œë¬¸ì— ë§´ë²„ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ì•ˆë¨. ë”°ë¼ì„œ <strong>uuidë¥¼ request ì— ë‹´ì•„ ë„˜ê²¨ì¤Œ</strong> (ì´ë ‡ê²Œ í•˜ë©´ <code class="language-plaintext highlighter-rouge">postHandle</code>, <code class="language-plaintext highlighter-rouge">afterCompletion</code> ì—ì„œë„ uuidë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ â†’ <strong>requestëŠ” ë“¤ì–´ì˜¤ê³  ë‚˜ê°ˆ ë•Œ ê¹Œì§€ ë™ì¼í•˜ë¯€ë¡œ!</strong>) (í•„í„°ëŠ” ì§€ì—­ë³€ìˆ˜ ì‚¬ìš© ê°€ëŠ¥ â†’ doFilterë°–ì— ì‚¬ìš©í•˜ì§€ ì•ŠìŒ!)</li>
          <li><code class="language-plaintext highlighter-rouge">return true</code> : <strong>trueë¡œ ë°˜í™˜</strong>í•´ì•¼ ë‹¤ìŒ ì²´ì¸ìœ¼ë¡œ ë„˜ì–´ê°. falseë©´ ê·¸ ì¦‰ì‹œ ì¤‘ë‹¨ë˜ì–´ responseë¡œ ë‚˜ê°</li>
        </ul>

        <aside>
  âš ï¸ <strong>HandlerMethod vs ResourceHttpRequestHandler</strong>
  <ul>
  <li>HandlerMethod  : ìŠ¤í”„ë§ì„ ì‚¬ìš©í•˜ë©´ ì¼ë°˜ì ìœ¼ë¡œ <code>@Controller</code> , <code>@RequestMapping</code> ì„ í™œìš©í•œ í•¸ë“¤ëŸ¬ ë§¤í•‘ì„ ì‚¬ìš©í•˜ëŠ”ë°, ì´ ê²½ìš° í•¸ë“¤ëŸ¬ ì •ë³´ë¡œ HandlerMethod ê°€ ë„˜ì–´ì˜´ </li>
  <li>ResourceHttpRequestHandler : <code>@Controller</code> ê°€ ì•„ë‹ˆë¼ /resources/static ì™€ ê°™ì€ ì •ì  ë¦¬ì†ŒìŠ¤ê°€ í˜¸ì¶œ ë˜ëŠ” ê²½ìš° <code>ResourceHttpRequestHandler</code> ê°€ í•¸ë“¤ëŸ¬ ì •ë³´ë¡œ ë„˜ì–´ ì˜´ </li>
  </ul>
  </aside>

        <aside>
  âš ï¸ <strong>HandlerAdaptor vs HandlerMapping vs HandlerMethod</strong>
  <ul>
  <li>HandlerAdaptor : í•´ë‹¹ handler(Controller)ë¥¼ ë‹¤ë£° ìˆ˜ ìˆê²Œ ë”í•˜ëŠ” ì—­í•  (Adaptor) </li>
  <li>HandlerMapping : í•´ë‹¹ë˜ëŠ” handler(Controller) </li>
  <li>HanlderMethod : í•´ë‹¹ë˜ëŠ” handler ì† í•´ë‹¹ method </li>
  </ul>
  </aside>
      </li>
      <li><code class="language-plaintext highlighter-rouge">postHandle</code>
        <ul>
          <li><strong>modelAndView</strong> ê°’ ì‚¬ìš© ê°€ëŠ¥</li>
          <li>ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ í˜¸ì¶œë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì¢…ë£Œ Logë¥¼ ë‹´ì§€ ì•ŠìŒ</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">afterCompletion</code>
        <ul>
          <li>error í™•ì¸ ê°€ëŠ¥</li>
          <li><strong>ì˜ˆì™¸ê°€ ë°œìƒí•´ë„ í˜¸ì¶œ</strong>ë˜ë¯€ë¡œ ì¢…ë£Œ Logë¥¼ ë‚¨ê¸°ê¸°ì— ì í•©</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">WebConfig</code> (Fileterì™€ëŠ” <strong>ë‹¤ë¥´ê²Œ MVCì—ì„œ ì œê³µí•˜ëŠ” Config ê¸°ëŠ¥</strong>ì„ ì‚¬ìš©í•´ì•¼ í•˜ë¯€ë¡œ <code class="language-plaintext highlighter-rouge">WebMvcConfigurer</code> <strong>ì„ implements</strong> í•´ì•¼ë¨) â†’ <code class="language-plaintext highlighter-rouge">public class WebConfig implements WebMvcConfigurer</code></p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addInterceptors</span><span class="o">(</span><span class="nc">InterceptorRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
  		<span class="n">registry</span><span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="k">new</span> <span class="nc">LogInterceptor</span><span class="o">())</span>
  						<span class="o">.</span><span class="na">order</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
  						<span class="o">.</span><span class="na">addPathPatterns</span><span class="o">(</span><span class="s">"/**"</span><span class="o">)</span>
  						<span class="o">.</span><span class="na">excludePathPatterns</span><span class="o">(</span><span class="s">"/css/**"</span><span class="o">,</span> <span class="s">"/*.ico"</span><span class="o">,</span> <span class="s">"/error"</span><span class="o">);</span>
  <span class="o">}</span>
</code></pre></div>    </div>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">WebMvcConfigurer</code> ê°€ ì œê³µí•˜ëŠ” <code class="language-plaintext highlighter-rouge">addInterceptors()</code> ë¥¼ ì‚¬ìš©í•˜ì—¬ <strong>ì¸í„°ì…‰í„°ë¥¼ ë“±ë¡ ë° ì„¤ì •</strong></li>
      <li><code class="language-plaintext highlighter-rouge">.addInterceptor(new LogInterceptor())</code> : í•´ë‹¹ LogInterceptor ì‚¬ìš©í•˜ë„ë¡ <strong>ë“±ë¡</strong></li>
      <li><code class="language-plaintext highlighter-rouge">.order(1)</code> : ì‚¬ìš©í•  í•„í„° <strong>ìˆœì„œ</strong> ì§€ì • (1ì´ ê°€ì¥ ë¨¼ì €)</li>
      <li><code class="language-plaintext highlighter-rouge">.addPathPatterns("/**")</code> : ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•  <strong>URL íŒ¨í„´ì„ ì§€ì •</strong> (í•œë²ˆì— ì—¬ëŸ¬ íŒ¨í„´ì„ ì§€ì • ê°€ëŠ¥)</li>
      <li><code class="language-plaintext highlighter-rouge">excludePathPatterns("/css/**", "/*.ico", "/error")</code> : ì¸í„°ì…‰í„°ì—ì„œ ì œì™¸í•  íŒ¨í„´ì„ ì§€ì • (<strong>Filterì™€ ë‹¤ë¥´ê²Œ ë” ì •ë°€í•˜ê³  í¸ë¦¬í•œ ë¶€ë¶„</strong>)</li>
      <li>í•´ë‹¹ URL íŒ¨í„´ ê·œì¹™ì€ ìŠ¤í”„ë§ ê³µì‹ ë©”ë‰´ì–¼ì— ì˜ ë‚˜ì™€ ìˆìŒ! <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/util/pattern/PathPattern.html">[ê³µì‹ ë©”ë‰´ì–¼]</a></li>
    </ul>
  </li>
</ul>

<h3 id="ë¡œê·¸ì¸-ì¸ì¦-by-ìŠ¤í”„ë§-ì¸í„°ìƒ™í„°">ë¡œê·¸ì¸ ì¸ì¦ (by ìŠ¤í”„ë§ ì¸í„°ìƒ™í„°)</h3>

<ul>
  <li><strong>ë¡œê·¸ì¸ ì¸ì¦ ì²´í¬ ì¸í„°ìƒ™í„°</strong>. ë¡œê·¸ì¸ ë˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ì ‘ê·¼ ë¶ˆê°€í•˜ë„ë¡!</li>
  <li><code class="language-plaintext highlighter-rouge">LoginCheckInterceptor</code>
    <ul>
      <li>í•´ë‹¹ interceptor ì•ˆì—ì„œ white list (ì ‘ê·¼ ê°€ëŠ¥ í˜ì´ì§€ ë”°ë¡œ ì„¤ì •) ì„¤ì •ì€ í•„ìš” ì—†ìŒ! â†’ Inteceptor ë“±ë¡ ì‹œ <strong>include, exclude ì„¤ì •</strong>ì„ í†µí•´ì„œ ê°€ëŠ¥! (<strong>Filter ë³´ë‹¤ ì¢‹ì€ ì </strong>)</li>
      <li>ë¡œê·¸ì¸ ì¸ì¦ì€ ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì „ì—ë§Œ ì‹¤í–‰ë˜ë©´ ë¨ â†’ <strong>preHandlerë§Œ êµ¬í˜„</strong>í•´ì£¼ë©´ ë¨ (filterëŠ” try except ë‹¤í•´ì¤˜ì•¼ë¨ ì¦‰, ì²˜ìŒë¶€í„° ëê¹Œì§€ ë‹¤ ì‹ ê²½ì¨ì•¼ë˜ì§€ë§Œ i<strong>nterceptorëŠ” prehandleë§Œ ì‹ ê²½ ì¨ë„ ë¨</strong>. (ë¡œê·¸ì¸ ë¶€ë¶„ì—ì„œ) ì¦‰, <strong>ë‚´ ê´€ì‹¬ì‚¬ì— ì§‘ì¤‘</strong>í•  ìˆ˜ ìˆìŒ)</li>
      <li>ë˜í•œ ë¡œê·¸ì¸ì´ í•„ìš”í•œ ìƒíƒœì˜ ì›¹ì‚¬ì´íŠ¸ì—ì„œë§Œ í•´ë‹¹ Inteceptorê°€ ì§„í–‰ë˜ëŠ” ê²ƒ (FilterëŠ” ì–´ë–¤ ìƒí™©ì´ë“  filterê°€ ë™ì‘í•˜ê³  ê·¸ filter ì•ˆì—ì„œ ì›¹ì‚¬ì´íŠ¸ íŒë‹¨ì„ ì§„í–‰í•¨(whiteList))</li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">preHandle</code></p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
      <span class="nc">String</span> <span class="n">requestURI</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">();</span>
      <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"ì¸ì¦ ì²´í¬ ì¸í„°ì…‰í„° ì‹¤í–‰ : {}"</span><span class="o">,</span> <span class="n">requestURI</span><span class="o">);</span>
      <span class="nc">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
        
      <span class="k">if</span> <span class="o">(</span><span class="n">session</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="nc">SessionConst</span><span class="o">.</span><span class="na">LOGIN_MEMBER</span><span class="o">)</span>  <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"ë¯¸ì¸ì¦ ì‚¬ìš©ì ìš”ì²­!"</span><span class="o">);</span>
          <span class="c1">// ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ redirect</span>
          <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">"/login?redirectURL="</span> <span class="o">+</span> <span class="n">requestURI</span><span class="o">);</span>
          <span class="k">return</span> <span class="kc">false</span><span class="o">;</span> <span class="c1">// ë” ì´ìƒ ì§„í–‰ë˜ì§€ ì•ŠìŒ.</span>
      <span class="o">}</span>
        
      <span class="k">return</span> <span class="kc">true</span><span class="o">;</span> <span class="c1">// ë‹¤ìŒ ì²´ì¸ìœ¼ë¡œ ì§„í–‰</span>
  <span class="o">}</span>
</code></pre></div>        </div>

        <ul>
          <li>HTTP ìš”ì²­ì´ ì˜¤ë©´ ì„œë¸”ë¦¿ ì‹¤í–‰ ì´í›„ <strong><code class="language-plaintext highlighter-rouge">preHandle</code> ì´ í˜¸ì¶œ</strong>ë¨</li>
          <li><strong>Session</strong>ì„ í†µí•´ ë¡œê·¸ì¸ ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸</li>
          <li>ë¡œê·¸ì¸ ë˜ì–´ ìˆì§€ ì•Šê±°ë‚˜ ë¯¸ì¸ì¦ ì‚¬ìš©ìì¼ ê²½ìš° <code class="language-plaintext highlighter-rouge">response.sendRedirect("/login?redirectURL=" + requestURI);</code> ë¥¼ í†µí•´ <strong>redirect ì‹¤í–‰</strong>
            <ul>
              <li><strong><code class="language-plaintext highlighter-rouge">return false</code></strong>ì„ í†µí•´ <strong>ë‹¤ìŒ ì²´ì¸ìœ¼ë¡œ ë„˜ì–´ê°€ì§€ ì•Šê³  í•´ë‹¹ redirectë¥¼ ë°”ë¡œ ì‹¤í–‰</strong>í•  ìˆ˜ ìˆë„ë¡ ì„¤ì • <strong>[ì¤‘ìš”]</strong></li>
            </ul>
          </li>
          <li>ë¡œê·¸ì¸ ì¸ì¦ì—ì„œ í†µê³¼í•œ ê²½ìš°
            <ul>
              <li><strong><code class="language-plaintext highlighter-rouge">return true</code></strong>ë¥¼ í†µí•´ <strong>ë‹¤ìŒ Interceptor í˜¹ì€ ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ</strong></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">WebConfig</code>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">LoginCheckInterceptor()</code> ì¶”ê°€
            <ul>
              <li>ì´ì „ê³¼ ì½”ë“œëŠ” ìœ ì‚¬</li>
              <li>í•˜ì§€ë§Œ, <strong>orderë¥¼ 2</strong>ë¡œ ë‘ ìœ¼ë¡œì¨ <code class="language-plaintext highlighter-rouge">LogInterceptor</code> <strong>ì´í›„ì— ì§„í–‰</strong>ë  ìˆ˜ ìˆë„ë¡ ì„¤ì •</li>
              <li><code class="language-plaintext highlighter-rouge">excludePathPatterns</code> ë¥¼ í†µí•´ <strong>whiteListì˜ ì—­í• </strong>ì„ ìˆ˜í–‰. (ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•˜ì§€ ì•Šì„ URL)</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<aside>
âš ï¸ <strong>ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ë¥¼ ì‚¬ìš©í•œ ê²°ê³¼!</strong> <br />
<b>ê³µí†µ ê´€ì‹¬ì‚¬</b>ë¥¼ ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ë¥¼ ì‚¬ìš©í•´ì„œ <b>í•´ê²°</b>! ì¶”ê°€ë¡œ í•„í„°ë³´ë‹¤ í›¨ì”¬ í¸ë¦¬í•˜ê³  ì„¸ë°€í•˜ê²Œ ì„¤ì •ì´ ê°€ëŠ¥í•¨! â†’ <b>í•„í„°ë³´ë‹¨ ì¸í„°ì…‰í„°</b>ë¥¼ ì‚¬ìš©í•˜ì!

</aside>

<h2 id="login-with-argumentresolver">Login with ArgumentResolver</h2>

<ul>
  <li><strong>ArgumentResolverë¥¼ í™œìš©</strong>í•´ì„œ ë¡œê·¸ì¸ ì¸ì¦ ê°ì²´ ë°›ì•„ì˜¤ê¸°</li>
  <li>HanlderMethodì˜ parameterì— <code class="language-plaintext highlighter-rouge">@Login</code> ì´ë¼ëŠ” <strong>custom annotation</strong>ì„ ë§Œë“¤ì–´ì„œ custom ArgumentResolverë¥¼ í†µí•´ ë¡œê·¸ì¸ ì¸ì¦ ê°ì²´ë¥¼ ë°›ëŠ” ê²ƒ â†’ <code class="language-plaintext highlighter-rouge">public String homeLoginV3ArgumentResolver(**@Login** Member loginMember, Model model)</code></li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">@Login</code> annotation</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@Target</span><span class="o">(</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">PARAMETER</span><span class="o">)</span>
  <span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">Login</span> <span class="o">{</span> <span class="o">}</span>
</code></pre></div>    </div>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">@Target(ElementType.PARAMETER)</code> : <strong>íŒŒë¼ë¯¸í„°ì—ë§Œ</strong> ì‚¬ìš©í•œë‹¤ëŠ” ëœ»!</li>
      <li><code class="language-plaintext highlighter-rouge">@Retention(RetentionPolicy.RUNTIME)</code> : ëŸ°íƒ€ì„ê¹Œì§€ <strong>ì• ë…¸í…Œì´ì…˜ ì •ë³´ê°€ ë‚¨ì•„</strong>ìˆì–´ í™œìš© ê°€ëŠ¥</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">LoginMemberArgumentResolver</code> ì„¤ì •
    <ul>
      <li><code class="language-plaintext highlighter-rouge">@Login</code> annotation ì„ ì²˜ë¦¬í•´ì¤„ ìˆ˜ ìˆëŠ” <strong>custom ArgumentResolver</strong></li>
      <li><strong><code class="language-plaintext highlighter-rouge">HandlerMethodArgumentResolver</code> êµ¬í˜„ì²´</strong> (Controllerì˜ Method ë‹¨ì˜ argumentì— ëŒ€í•œ resolver ì´ë¯€ë¡œ)</li>
      <li><code class="language-plaintext highlighter-rouge">public class LoginMemberArgumentResolver implements HandlerMethodArgumentResolver</code></li>
      <li>
        <p>íŒŒë¼ë¯¸í„°ê°€ í•´ë‹¹ ì–´ë…¸í…Œì´ì…˜ì— ë§¤í•‘ë˜ëŠ” ì• ì¸ì§€ í™•ì¸</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">supportsParameter</span><span class="o">(</span><span class="nc">MethodParameter</span> <span class="n">parameter</span><span class="o">)</span> <span class="o">{</span>
  	<span class="kt">boolean</span> <span class="n">hasLoginAnnotation</span> <span class="o">=</span> <span class="n">parameter</span><span class="o">.</span><span class="na">hasParameterAnnotation</span><span class="o">(</span><span class="nc">Login</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  	<span class="kt">boolean</span> <span class="n">hasMemberType</span> <span class="o">=</span> <span class="nc">Member</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="n">parameter</span><span class="o">.</span><span class="na">getParameterType</span><span class="o">());</span>
        	
  	<span class="k">return</span> <span class="n">hasLoginAnnotation</span> <span class="o">&amp;&amp;</span> <span class="n">hasMemberType</span><span class="o">;</span>
  <span class="o">}</span>
</code></pre></div>        </div>

        <ul>
          <li><code class="language-plaintext highlighter-rouge">parameter.hasParameterAnnotation(Login.class);</code> : íŒŒë¼ë¯¸í„°ì— ë‹¬ë¦° annotationì´ Login annotationì¸ì§€ í™•ì¸</li>
          <li><code class="language-plaintext highlighter-rouge">Member.class.isAssignableFrom(parameter.getParameterType());</code> : í•´ë‹¹ íŒŒë¼ë¯¸í„°ê°€ Memberì˜ í•˜ìœ„ classì¸ì§€ í™•ì¸</li>
          <li><strong>ë‘˜ ë‹¤ì— í•´ë‹¹ í•˜ë©´ true</strong> ë°˜í™˜ â†’ <strong>annotation ì‚¬ìš©</strong> ê°€ëŠ¥!</li>
          <li>ê²°ë¡ ì ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">@Login</code> ì• ë…¸í…Œì´ì…˜ì´ ìˆìœ¼ë©´ì„œ <code class="language-plaintext highlighter-rouge">Member</code> íƒ€ì…ì´ë©´ í•´ë‹¹ ArgumentResolver ê°€ ì‚¬ìš©ëœë‹¤.</li>
        </ul>
      </li>
      <li>
        <p>íŒŒë¼ë¯¸í„°ì™€ ì–´ë…¸í…Œì´ì…˜ì— ë”°ë¥¸ Argument Resolve ì§„í–‰</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@Override</span> <span class="c1">// annotation ë™ì‘</span>
  <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">resolveArgument</span><span class="o">(</span><span class="nc">MethodParameter</span> <span class="n">parameter</span><span class="o">,</span> <span class="nc">ModelAndViewContainer</span> <span class="n">mavContainer</span><span class="o">,</span> <span class="nc">NativeWebRequest</span> <span class="n">webRequest</span><span class="o">,</span> <span class="nc">WebDataBinderFactory</span> <span class="n">binderFactory</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        
      <span class="nc">HttpServletRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpServletRequest</span><span class="o">)</span> <span class="n">webRequest</span><span class="o">.</span><span class="na">getNativeRequest</span><span class="o">();</span>
      <span class="nc">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        
      <span class="c1">// ë¡œê·¸ì¸ì´ ì•ˆëœ ìƒí™©</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">session</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
      <span class="o">}</span>
        
      <span class="c1">// ë¡œê·¸ì¸ì´ ëœ ìƒí™© (Member ê°ì²´ë¥¼ ë°˜í™˜), ì¦‰ ì–´ë…¸í…Œì´ì…˜ì´ í• ë‹¹ëœ íŒŒë¼ë¯¸í„°ì— í•´ë‹¹ ë°˜í™˜ ê°ì²´ë¥¼ í• ë‹¹í•¨</span>
      <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="nc">SessionConst</span><span class="o">.</span><span class="na">LOGIN_MEMBER</span><span class="o">);</span>
  <span class="o">}</span>
</code></pre></div>        </div>

        <ul>
          <li><code class="language-plaintext highlighter-rouge">@Login</code> ì–´ë…¸í…Œì´ì…˜ì˜ <strong>ë™ì‘ ë¡œì§</strong></li>
          <li>ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì§ì „ì— í˜¸ì¶œ ë˜ì–´ì„œ <strong>í•„ìš”í•œ íŒŒë¼ë¯¸í„° ì •ë³´ë¥¼ ìƒì„±</strong>í•´ì¤Œ</li>
          <li><strong>ë¡œê·¸ì¸ ì¸ì¦ ê³¼ì •</strong> ì§„í–‰</li>
          <li>ê²°ë¡ ì ìœ¼ë¡œ ë¡œê·¸ì¸ì´ ëœ ìƒíƒœë¼ë©´ í•´ë‹¹ <strong>ë¡œê·¸ì¸ ëœ íšŒì›ì˜ ê°ì²´(Member)ê°€ ë°˜í™˜</strong>ë¨!</li>
          <li>ì´í›„ ìŠ¤í”„ë§MVCëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ì„œ ì—¬ê¸°ì—ì„œ ë°˜í™˜ëœ member ê°ì²´ë¥¼ íŒŒë¼ë¯¸í„°ì— ì „ë‹¬í•´ ì¤Œ!</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">LoginMemberArgumentResolver</code> ë“±ë¡ (<code class="language-plaintext highlighter-rouge">WebConfig</code>)
    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">WebMvcConfigurer</code>  â†’ <code class="language-plaintext highlighter-rouge">public class WebConfig implements WebMvcConfigurer</code></p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addArgumentResolvers</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">HandlerMethodArgumentResolver</span><span class="o">&gt;</span> <span class="n">resolvers</span><span class="o">)</span> <span class="o">{</span>
  	 <span class="n">resolvers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">LoginMemberArgumentResolver</span><span class="o">());</span>
  <span class="o">}</span>
</code></pre></div>        </div>

        <ul>
          <li>resolverì— custom ArgumentResolverì¸ <code class="language-plaintext highlighter-rouge">LoginMemberArgumentResolver</code> ë“±ë¡</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<aside>
âš ï¸ <strong>WebConfig</strong>
í•­ìƒ ê¸°ë³¸ ê¸°ëŠ¥ì—ì„œ ë‚´ê°€ interfaceë¥¼ í†µí•´ <b>êµ¬í˜„ í•œ ê²ƒì„ Springì—ì„œ ì‚¬ìš©</b>í•˜ë ¤ë©´ <code>WebConfing</code>ë¥¼ í†µí•´ <b>ë“±ë¡</b>í•´ì¤˜ì•¼ë¨!

</aside>
:ET