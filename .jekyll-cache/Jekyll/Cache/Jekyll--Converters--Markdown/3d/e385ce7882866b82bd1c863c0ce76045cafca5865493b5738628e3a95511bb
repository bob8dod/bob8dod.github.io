I"Å¬<h2 id="ì–´í”Œë¦¬ì¼€ì´ì…˜-êµ¬í˜„-ì¤€ë¹„">ì–´í”Œë¦¬ì¼€ì´ì…˜ êµ¬í˜„ ì¤€ë¹„</h2>

<ul>
  <li>% ì•ì„  ê³¼ì •ë“¤(ë„ë©”ì¸ ì„¤ê³„)ì€ Dataì¸¡ë©´ì—ì„œì˜ ì¤€ë¹„ì˜€ê³ , ì´ì œ ì´ëŸ° ë„ë©”ì¸ë“¤ì„ ê°€ì§€ê³  ì–´ë–»ê²Œ êµ¬í˜„í•  ê²ƒì¸ì§€ì— ëŒ€í•œ ì´ì•¼ê¸°.</li>
  <li>êµ¬í˜„ ìš”êµ¬ì‚¬í•­
    <ol>
      <li>íšŒì› ê¸°ëŠ¥ â†’ íšŒì› ë“±ë¡, íšŒì› ì¡°íšŒ</li>
      <li>ìƒí’ˆ ê¸°ëŠ¥ â†’ ìƒí’ˆ ë“±ë¡, ìƒí’ˆ ìˆ˜ì •, ìƒí’ˆ ì¡°íšŒ</li>
      <li>ì£¼ë¬¸ ê¸°ëŠ¥ â†’ ìƒí’ˆ ì£¼ë¬¸, ì£¼ë¬¸ ë‚´ì—­ ì¡°íšŒ, ì£¼ë¬¸ ì·¨ì†Œ</li>
    </ol>
  </li>
  <li>
    <p>Application Architecture</p>

    <p><img src="/images/posts/post-220312/Untitled 6.png" alt="" /></p>

    <ul>
      <li>ê³„ì¸µí˜• êµ¬ì¡°: Controller, Service, Repository, DB, Domain
        <ul>
          <li>controller, web: ì›¹ ê³„ì¸µ</li>
          <li>service: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, íŠ¸ëœì­ì…˜ ì²˜ë¦¬</li>
          <li>repository: JPAë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ê³„ì¸µ, ì—”í‹°í‹° ë§¤ë‹ˆì € ì‚¬ìš©</li>
          <li>domain: ì—”í‹°í‹°ê°€ ëª¨ì—¬ ìˆëŠ” ê³„ì¸µ, ëª¨ë“  ê³„ì¸µì—ì„œ ì‚¬ìš© ê°€ëŠ¥</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="íšŒì›-ë„ë©”ì¸-ê°œë°œ">íšŒì› ë„ë©”ì¸ ê°œë°œ</h2>

<ul>
  <li>íšŒì› Repository ê°œë°œ (MemberRepository)
    <ul>
      <li><code class="language-plaintext highlighter-rouge">@Repository</code> : componentë¡œì¨ Spring Beanìœ¼ë¡œ ìë™ ë“±ë¡</li>
      <li>ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ë° Entityë¥¼ ê´€ë¦¬í•  Entity Manger injectioní•˜ê¸°  â†’ <code class="language-plaintext highlighter-rouge">EntityManager em;</code>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">@PersistenceContext</code> : springì´ JPAì˜ entity managerì„ ìƒì„±í•˜ì—¬ í•´ë‹¹ emì— injectioní•´ì¤Œ</li>
        </ul>
      </li>
      <li>íšŒì› ì €ì¥ â†’ <code class="language-plaintext highlighter-rouge">void save(Member member)</code>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">em.persist(member)</code> : ë°›ì•„ì˜¨ memberë¥¼ ì €ì¥. (transactionì´ commit ë˜ëŠ” ì‹œì (transactionalë¡œ ê°ì‹¼ methodê°€ ì¢…ë£Œë  ë•Œ commit ë¨)ì— DBì— ë°˜ì˜ë¨.)</li>
        </ul>
      </li>
      <li>ë‹¨ì¼ ì¡°íšŒ â†’ <code class="language-plaintext highlighter-rouge">Member findOne</code>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">em.find(Member.class, id)</code> : ë‚´ê°€ ì¡°íšŒí•  Entity Class, PK</li>
        </ul>
      </li>
      <li>ë‹¤ê±´ ì¡°íšŒ â†’ <code class="language-plaintext highlighter-rouge">List&lt;Member&gt; findAll()</code>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">em.createQuery(qlString, resultClass)</code> ì‚¬ìš© â†’ jql queryëŠ” ê¸°ì¡´ sql queryì™€ëŠ” ë‹¤ë¥´ê²Œ Tableì´ ì•„ë‹Œ Entity ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ queryë¥¼ ì‘ì„±í•´ì•¼ë¨. ì¦‰, fromì˜ ëŒ€ìƒì´ tableì´ ì•„ë‹Œ Entity
            <ul>
              <li><code class="language-plaintext highlighter-rouge">qlString</code> : <code class="language-plaintext highlighter-rouge">"select m from Member m"</code> â†’ ëŒ€ìƒì´ Tableì´ ì•„ë‹Œ Entity!</li>
              <li><code class="language-plaintext highlighter-rouge">resultClass</code> : <code class="language-plaintext highlighter-rouge">Member.class</code> â†’ ë‚´ê°€ ì¡°íšŒí•  Entity Class (DBì…ì¥ì—ì„  Table)</li>
              <li><code class="language-plaintext highlighter-rouge">.getResultList();</code> : ê²°ê³¼ë¥¼ Listë¡œ ë°˜í™˜</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>ë‹¤ê±´ ì¡°íšŒ (ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰) â†’ <code class="language-plaintext highlighter-rouge">List&lt;Member&gt; findByName(String name)</code>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">qlString</code> : <code class="language-plaintext highlighter-rouge">"</code><code class="language-plaintext highlighter-rouge">select m from Member m where m.name = :name"</code> â†’ whereë¬¸ ì‘ì„±. nameì„ parameterë¡œ ë°”ì¸ë”©
            <ul>
              <li><code class="language-plaintext highlighter-rouge">.setParameter("name", name)</code> â†’ nameì„ parameterë¡œ ë°”ì¸ë”©</li>
            </ul>
          </li>
          <li><code class="language-plaintext highlighter-rouge">resultClass</code> : <code class="language-plaintext highlighter-rouge">Member.class</code></li>
          <li><code class="language-plaintext highlighter-rouge">.getResultList();</code> : ê²°ê³¼ë¥¼ Listë¡œ ë°˜í™˜</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>íšŒì› Service ê°œë°œ (MemberService) â†’ <code class="language-plaintext highlighter-rouge">class MemberService</code>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">@Service</code> : componentë¡œì¨ Spring Beanìœ¼ë¡œ ìë™ ë“±ë¡</li>
      <li><code class="language-plaintext highlighter-rouge">@Transactional</code> : [í•„ìˆ˜] JPAì˜ ëª¨ë“  ë°ì´í„° ë³€ê²½, ì¡°íšŒëŠ” Transactional ì•ˆì—ì„œ ì‹¤í–‰ ë˜ì–´ì•¼ í•¨. â†’ ë³¸ì§ˆì ìœ¼ë¡œ repositoryì—ì„œ ë°ì´í„° ì €ì¥, ë³€ê²½, ì¡°íšŒê°€ ì´ë£¨ì–´ì§€ì§€ë§Œ, repositoryëŠ” service í•˜ìœ„ì— ì¡´ì¬í•˜ê¸°ì— serviceì— transactional annotationì„ ë‹¬ì•„ì¤Œ
        <ul>
          <li>ì—¬ê¸°ì„œ ë§Œì•½ ì¡°íšŒë§Œ í•œë‹¤ í•˜ë©´ <code class="language-plaintext highlighter-rouge">@Transactional(readOnly = true)</code> ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„±ëŠ¥ì„ ë” ì˜¬ë¦´ ìˆ˜ ìˆìŒ â†’ ì´ë¥¼ ê°ê° methodì— annotationì„ ë‹¬ì•„ overrideí•  ìˆ˜ë„ ìˆìŒ!</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">@RequiredArgsConstructor</code> : finalì´ ë¶™ì–´ ìˆëŠ” ì• ë“¤ì— ëŒ€í•´ì„œ ìë™ìœ¼ë¡œ ìƒì„±ìë¥¼ í†µí•´ Autowired(DI) ì‹¤ì‹œ. ì¦‰, ìë™ìœ¼ë¡œ constructor injection ì‹¤ì‹œ -&gt; lombok ê¸°ëŠ¥ â†’ <code class="language-plaintext highlighter-rouge">private **final** MemberRepository memberRepository;</code> (memberServiceì—ì„  ì €ì¥ì†Œë¥¼ ê°€ì§€ê³  ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸°ì— repositoryë¥¼ DI ë°›ì•„ì•¼í•¨.)
        <ul>
          <li>field injection : í¸ë¦¬í•¨. í•˜ì§€ë§Œ ì¶”ê°€ì ì¸ ì„¤ì •(injection í•˜ëŠ” ëŒ€ìƒì„ ë³€ê²½í•˜ëŠ” ë“±)ì´ ë¶ˆê°€ëŠ¥</li>
          <li>setter injection : ì¶”ê°€ì ì¸ ì„¤ì • ê°€ëŠ¥. but ì™¸ë¶€ì—ì„œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤ëŠ” ë‹¨ì ì„ ê°€ì§€ê³  ìˆìŒ</li>
          <li>
            <p>constructor injection : ì¶”ê°€ì ì¸ ì„¤ì • + ì™¸ë¶€ì—ì„œ ë³€ê²½ ë¶ˆê°€ëŠ¥</p>

            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@Autowired</span>
  <span class="kd">public</span> <span class="nf">MemberService</span><span class="o">(</span><span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">memberRepository</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">;</span>
  <span class="o">}</span>
</code></pre></div>            </div>

            <ul>
              <li>ì´ê²Œ @RequiredArgsConstructorë¥¼ í†µí•´ ìë™ìœ¼ë¡œ ìƒì„±ëœë‹¤ëŠ” ê²ƒ!</li>
              <li>ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‹¤ë¥¸ classì—ì„œ ì´ì „ì— Autowired ëœ ê²ƒë“¤ì„ ë³€ê²½í•´ì£¼ë©´ ë¨!</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>ê¸°ëŠ¥ êµ¬í˜„
        <ul>
          <li>íšŒì› ê°€ì… â†’ <code class="language-plaintext highlighter-rouge">Long join(Member member)</code>
            <ul>
              <li>ì¤‘ë³µ íšŒì› ê²€ì¦ : <code class="language-plaintext highlighter-rouge">validateDuplicated(member);</code>
                <ul>
                  <li>ì¤‘ë³µëœ íšŒì›ì´ë©´ EXCEPTION throw! â†’ <code class="language-plaintext highlighter-rouge">throw new IllegalStateException("Already Exited Member!")</code></li>
                  <li>ë™ì¼í•œ ì´ë¦„ì„ ê°€ì§„ memberê°€ ë‹¨ í•˜ë‚˜ë¼ë„ ë°œê²¬ë˜ë©´ ì•ˆë¨ â†’ <code class="language-plaintext highlighter-rouge">memberRepository.findByName(member.getName()).stream().findAny();</code> <code class="language-plaintext highlighter-rouge">if (findMember1.isPresent()) {...}</code></li>
                </ul>
              </li>
              <li><code class="language-plaintext highlighter-rouge">memberRepository.save(member);</code></li>
              <li><code class="language-plaintext highlighter-rouge">return member.getId();</code> :  ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ë“¤ì–´ê°€ëŠ” ìˆœê°„, idê°’ì„ ë¶€ì—¬ë°›ê¸° ë•Œë¬¸ì—, DBì— commití•˜ì§€ ì•Šì•„ë„ idë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŒ</li>
            </ul>
          </li>
          <li>íšŒì› ì¡°íšŒ
            <ul>
              <li>ë‹¨ì¼ íšŒì› ì¡°íšŒ
                <ul>
                  <li><code class="language-plaintext highlighter-rouge">@Transactional(readOnly = true)</code> â†’ ì¡°íšŒ ì„±ëŠ¥ ì˜¬ë¦¬ê¸°</li>
                  <li><code class="language-plaintext highlighter-rouge">return memberRepository.findOne(memberId);</code></li>
                </ul>
              </li>
              <li>ì „ì²´ ì¡°íšŒ
                <ul>
                  <li><code class="language-plaintext highlighter-rouge">@Transactional(readOnly = true)</code> â†’ ì¡°íšŒ ì„±ëŠ¥ ì˜¬ë¦¬ê¸°</li>
                  <li><code class="language-plaintext highlighter-rouge">return memberRepository.findAll();</code></li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>ê¸°ëŠ¥ TEST
    <ul>
      <li>
        <p>tdd â†’ inteliJ settingsì˜ live templateì„ í†µí•´ ê¸°ë³¸ test case templateì„ ë§Œë“¤ì–´ ë‘ê³  ì‚¬ìš© ê°€ëŠ¥!</p>

        <p><img src="/images/posts/post-220312/Untitled 7.png" alt="" /></p>
      </li>
      <li>íšŒì› Service Test (MemberServiceTest) â†’ <code class="language-plaintext highlighter-rouge">class MemberServiceTest</code>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">@SpringBootTest</code> : Spring Boot ìƒì—ì„œ Testí•˜ê² ë‹¤ëŠ” ëœ». ì´ annotationì´ ì—†ë‹¤ë©´ Javaìƒì—ì„œ Testê°€ ëŒì•„ê°€ê²Œ ë¨.</li>
          <li><code class="language-plaintext highlighter-rouge">@Transactional</code> : Rollbackì„ ìœ„í•¨. serviceì—ì„œ ì‘ì„±í•œ ê²ƒê³¼ëŠ” ë³„ê°œë¡œ í•„ìš”í•¨ -&gt; Rollbackì„ ìœ„í•´. ì¦‰, Testì—ì„œì˜ transactionalì€ serviceì—ì„œì˜ transactionalê³¼ ë‹¬ë¦¬ ê¸°ë³¸ì ìœ¼ë¡œ Commití•˜ì§€ ì•Šê³  Rollbackí•´ë²„ë¦¼</li>
          <li>DI í•´ì¤˜ì•¼ í•˜ëŠ” ê²ƒë“¤ : <code class="language-plaintext highlighter-rouge">MemberService</code>, <code class="language-plaintext highlighter-rouge">MemberRepository</code>, <code class="language-plaintext highlighter-rouge">EntityManager</code> (emì€ ì‚¬ì‹¤ flushë¥¼ ìœ„í•¨, í•„ìˆ˜ëŠ” ì•„ë‹˜)
            <ul>
              <li>memberserviceì™€ memberrepositoryë¥¼ í†µí•œ Testê°€ ì´ë£¨ì–´ì§€ë¯€ë¡œ</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>íšŒì› ê°€ì… Test â†’ <code class="language-plaintext highlighter-rouge">void join() throws Exception</code>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">given (ì£¼ì–´ì§„ ê²ƒë“¤ì„ í†µí•´)</code> , <code class="language-plaintext highlighter-rouge">when (ì´ëŸ° ê¸°ëŠ¥ì„ ë™ì‘í–ˆì„ ë•Œ)</code> , <code class="language-plaintext highlighter-rouge">then (ì´ëŸ° ê²°ê³¼ë¥¼ í™•ì¸í•  ê²ƒ)</code> ì˜ í˜•ì‹ì„ ì´ìš©</li>
          <li>givenì— Memberë¥¼ ìƒì„±, whenì— memberë¥¼ memberserviceë¥¼ í†µí•´ ì €ì¥. thenì„ í†µí•´ ìƒì„±ëœ memberê°€ ì´ë¯¸ ì¡´ì¬í•œ íšŒì›ì¸ì§€ë¥¼ í™•ì¸ â†’ *<code class="language-plaintext highlighter-rouge">assertEquals*(member, memberService.findOne(savedId));</code> (ê°™ì€ transactional (ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸) ì•ˆì—ì„œ Id(PK)ê°’ì´ ë˜‘ê°™ìœ¼ë©´ ì˜¤ë¥˜ ë°œìƒ!)
            <ul>
              <li>AssertëŠ” Testì—ì„œ êµ‰ì¥íˆ ìœ ìš©í•˜ê²Œ ì“°ì´ëŠ” library</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>íšŒì› ì¤‘ë³µ ê°€ì… Test â†’ <code class="language-plaintext highlighter-rouge">void duplicatedJoin() throws Exception</code>
        <ul>
          <li>given - ë™ì¼í•œ ì´ë¦„ì„ ê°€ì§„ memberë¥¼ 2ê°œ ìƒì„±</li>
          <li>when - ë¨¼ì € ì²«ë²ˆì§¸ memberë¥¼ ì €ì¥</li>
          <li>
            <p>then - ë™ì¼í•œ ì´ë¦„ì„ ê°€ì§„ 2ë²ˆì§¸ memberë¥¼ ì €ì¥. ì—¬ê¸°ì„œ ì˜¤ë¥˜ ë°œìƒì„ ê¸°ëŒ€í•˜ëŠ” ê²ƒ! (ì¤‘ë³µ ê°ì§€ methodì—ì„œ throwëœ exceptionì„ ë°›ì•„ì•¼ë¨.)</p>

            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nc">IllegalStateException</span> <span class="n">thrown</span> <span class="o">=</span><span class="n">assertThrows</span><span class="o">(</span><span class="nc">IllegalStateException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">memberService</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="n">member2</span><span class="o">));</span>
  <span class="n">assertEquals</span><span class="o">(</span><span class="s">"Already Exited Member!"</span><span class="o">,</span> <span class="n">thrown</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
</code></pre></div>            </div>

            <ul>
              <li>try catch ëŒ€ì‹  assertEqualsë¡œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆëŠ”ì§€ íŒë‹¨.</li>
            </ul>
          </li>
          <li>ì¶”ê°€ë¡œ <code class="language-plaintext highlighter-rouge">Assert</code>ì˜ <code class="language-plaintext highlighter-rouge">fail()</code>ì„ í†µí•´ ì˜ˆì™¸ë¥¼ ê°•ì œë¡œ ë°œìƒí•˜ì—¬ í•´ë‹¹ ì½”ë“œê¹Œì§€ ì§„í–‰ë˜ë©´ ì•ˆë˜ê²Œë” ì„¤ì •ë„ ê°€ëŠ¥í•¨.</li>
        </ul>
      </li>
      <li>ì„œë²„ DBë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ë‚´ì¥ Memory DBë¥¼ ì‚¬ìš©í•˜ì—¬ Test ì§„í–‰í•˜ëŠ” ë²•!
        <ul>
          <li>ì™¸ë¶€ DBë¥¼ í‚¤ì§€ ì•Šê³  ë‚´ì¥ Membory DBë¥¼ í†µí•´ ë¹ ë¥´ê²Œ Testê°€ ê°€ëŠ¥í•¨.</li>
          <li>ë˜í•œ, ì‹¤ì œ Mainì—ì„œ ì§„í–‰í•˜ëŠ” ì½”ë“œë“¤ê³¼ Testì—ì„œ ì§„í–‰í•˜ëŠ” testëŠ” ì—„ì—°íˆ ë‹¤ë¥¸ ê²ƒ! â†’ DBë¥¼ êµ¬ë¶„í•´ì¤„ í•„ìš”ê°€ ìˆìŒ!!!</li>
          <li>
            <p>ì´ëŠ” Testì— resourcesë¥¼ ìƒˆë¡œ ìƒì„±í•´ì„œ Testìš© application.ymlì„ ì„¤ì •í•´ì£¼ë©´ ë¨.</p>

            <p><img src="/images/posts/post-220312/Untitled 8.png" alt="" /></p>

            <ul>
              <li>
                <p>ê·¸ í›„ í•´ë‹¹ application.ymlì— ìƒˆë¡œìš´ DB ì—°ê²° ì •ë³´ë¥¼ ë„£ì–´ì£¼ë©´ ë¨.</p>

                <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">spring</span><span class="pi">:</span> <span class="c1">#springbootì— ì—°ê²°í•  DBê´€ë ¨ ì •ë³´</span>
    <span class="na">datasource</span><span class="pi">:</span>
      <span class="na">url</span><span class="pi">:</span> <span class="s">jdbc:h2:mem:test</span>
</code></pre></div>                </div>
              </li>
              <li><em><code class="language-plaintext highlighter-rouge">jdbc:h2:mem:test</code> â†’</em> ë‚´ì¥ ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” DB</li>
              <li>í•˜ì§€ë§Œ ì‚¬ì‹¤ ì´ ëª¨ë“  ì„¤ì •ì„ í•˜ì§€ ì•Šê³  testì— resourcesë§Œ ìƒì„±í•´ ì¤€ë‹¤ë©´ Spring BootëŠ” ìë™ìœ¼ë¡œ DBë¥¼ ë‚´ì¥ë©”ëª¨ë¦¬ë¡œ ì‚¬ìš©í•˜ê²Œ ë¨.</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="ìƒí’ˆ-ë„ë©”ì¸-ê°œë°œ">ìƒí’ˆ ë„ë©”ì¸ ê°œë°œ</h2>

<ul>
  <li>ìƒí’ˆ Entity ê°œë°œ
    <ul>
      <li>[ì¤‘ìš”!] Serviceì— ë¹„ì§€ë‹ˆìŠ¤ë¥¼ ìƒˆë¡œ ë§Œë“œëŠ” ê²ƒì´ ì•„ë‹Œ, ìƒí’ˆ Entity ìì²´ì— ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì„ ì¶”ê°€í•˜ëŠ” ê²ƒ.</li>
      <li>ì¦‰, Item Entityì— ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ methodë¥¼ ì¶”ê°€í•´ì£¼ëŠ” ê²ƒ.
        <ul>
          <li>ì›ë˜ ê°™ìœ¼ë©´ Serviceì—ì„œ set ìœ¼ë¡œ í•´ë‹¹ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì„ êµ¬í˜„í•˜ê² ì§€ë§Œ, ê°ì²´ ì§€í–¥ì ìœ¼ë¡œ ìƒê°í•´ë³´ë©´ í•´ë‹¹ ê°ì²´ì˜ ê°’ì„ ë³€ê²½í•˜ëŠ” ê²ƒì€ ê·¸ ê°ì²´ ì•ˆì—ì„œ ì§„í–‰í•˜ëŠ” ê²ƒì´ ê°€ì¥ BEST (ì‘ì§‘ë ¥ UP) â†’ ì´ë¥¼ í†µí•´ Setterë¥¼ ìƒì„±í•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” ê²ƒ. Setter ì—†ì´ í”„ë¡œê·¸ë¨ì„ ë§Œë“œëŠ” ê²Œ ì•ˆì „í•¨!</li>
          <li>ì¬ê³  ì¦ê°€ ë¡œì§ (method) â†’ <code class="language-plaintext highlighter-rouge">void addStock(int quantity)</code>
            <ul>
              <li><code class="language-plaintext highlighter-rouge">this.stockQuantity += quantity;</code></li>
            </ul>
          </li>
          <li>ì¬ê³  ê°ì†Œ ë¡œì§ (method) â†’ <code class="language-plaintext highlighter-rouge">void removeStock(int quantity)</code>
            <ul>
              <li>ê°ì†Œëœ ì¬ê³ ê°€ 0ë³´ë‹¤ ì‘ìœ¼ë©´ Exceptionì„ thorw í•´ì¤˜ì•¼ë¨. â†’ <code class="language-plaintext highlighter-rouge">throw new NotEnoughStockException("Not Enough Stock now!!");</code></li>
              <li>Exception ìƒì„± : <code class="language-plaintext highlighter-rouge">class NotEnoughStockException extends RuntimeException</code> ìƒì„± í›„ RuntimeException Override!</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>ìƒí’ˆ Repository ê°œë°œ
    <ul>
      <li>ìƒí’ˆ ì €ì¥ â†’ <code class="language-plaintext highlighter-rouge">void save(Item item)</code>
        <ul>
          <li>ìƒˆë¡œ ì €ì¥ë˜ëŠ” itemì¸ì§€, ìˆ˜ì •í•˜ëŠ” itemì¸ì§€ êµ¬ë¶„ í•„ìš”.
            <ul>
              <li><code class="language-plaintext highlighter-rouge">if(item.getId() == null){ em.persist(item); }</code> : ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì˜¬ë¼ê¸°ì§€ ì•Šì€ ìƒíƒœì˜ ìƒˆë¡œìš´ Itemì€ Idê°€ ë¶€ì—¬ë˜ì§€ ì•ŠìŒ. â†’ ê·¸ë ‡ê¸°ì— persistë¥¼ í†µí•´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì˜¬ë¦¬ê³  ì €ì¥í•˜ë©´ ë¨.</li>
              <li><code class="language-plaintext highlighter-rouge">else</code> : í•˜ì§€ë§Œ, ì´ë¯¸ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì˜¬ë¼ê°€ Idë¥¼ ë¶€ì—¬ë°›ì€ ìƒíƒœ (ì¦‰, ì €ì¥ë˜ì–´ ìˆëŠ” item) ì¼ ê²½ìš°, <code class="language-plaintext highlighter-rouge">em.merge(item);</code> ë¥¼ í†µí•´ ì¤€ì˜ì† ìƒíƒœì˜ ì—”í‹°í‹°ë¥¼ ì˜ì† ìƒíƒœë¡œ ë³€ê²½ â†’ (merge ë¶€ë¶„ì€ ë’¤ì—ì„œ ë” ìì„¸íˆ ë‹¤ë£° ì—ì •)</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>ìƒí’ˆ ì¡°íšŒ
        <ul>
          <li>ë‹¨ê±´ ì¡°íšŒ : <code class="language-plaintext highlighter-rouge">return em.find(Item.class, id);</code></li>
          <li>ë‹¤ê±´ ì¡°íšŒ : <code class="language-plaintext highlighter-rouge">return em.createQuery("select i from Item i", Item.class.getResultList()</code>;</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>ìƒí’ˆ Service ê°œë°œ
    <ul>
      <li>ì‚¬ì‹¤ ì´ë¶€ë¶„ì—ì„  ìƒí’ˆ Repositoryì— ê¸°ëŠ¥ì„ ìœ„ì„í•˜ëŠ” ì •ë„ ë°–ì— ì—†ìŒ</li>
      <li>ê·¸ë˜ì„œ ì´ ë¶€ë¶„ì„ êµ³ì´ Serviceë¥¼ ê±°ì³ì•¼ í•˜ë‚˜ë¥¼ ê³ ë¯¼í•´ë³¼ í•„ìš”ê°€ ìˆìŒ</li>
      <li>ê¸°ë³¸ì ìœ¼ë¡œ í•„ìš”í•œ <code class="language-plaintext highlighter-rouge">@Service @Transactional(readOnly = true) @RequiredArgsConstructor</code> annotation ë‹¬ì•„ì£¼ê³ </li>
      <li>ItemRepositoryë¥¼ DI ì‹œì¼œì¤€ í›„, ì €ì¥, ì¡°íšŒê¸°ëŠ¥ì„ repositoryì™€ ì—°ê²°í•´ì£¼ë©´ ë</li>
    </ul>
  </li>
</ul>

<h2 id="ì£¼ë¬¸-ë„ë©”ì¸-ê°œë°œ">ì£¼ë¬¸ ë„ë©”ì¸ ê°œë°œ</h2>

<ul>
  <li>ì£¼ë¬¸ Entity ê°œë°œ
    <ul>
      <li>Order Class
        <ol>
          <li>Orderì—ëŠ” ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ê°€ ìˆìœ¼ë©° Orderê°€ ê·¸ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì—ì„œ ìš°ìœ„ë¥¼ ì í•˜ê³  ìˆëŠ” ê²ƒë“¤ì´ ë§ìŒ. â†’ ìƒì„± ë©”ì„œë“œë¥¼ Entity ìì²´ì— ë§Œë“¤ì–´ì£¼ë©´ ì¢‹ìŒ! â†’ <code class="language-plaintext highlighter-rouge">**static** Order createOrder(Member member, Delivery delivery, OrderItem... orderItems)</code>
            <ul>
              <li>Orderê°€ ìƒì„±ë  ë•Œ ë¬´ì¡°ê±´ í˜¸ì¶œë˜ì–´ì•¼ í•˜ëŠ” ë†ˆ</li>
              <li>ì—°ê´€ê´€ê³„ ë§¤í•‘ ë° ê°’ì„ ì„¤ì •í•˜ëŠ” ì—­í• </li>
            </ul>

            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1">//==ìƒì„± ë©”ì„œë“œ==// (ì‘ì§‘ì„± í–¥ìƒ)</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Order</span> <span class="nf">createOrder</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">,</span> <span class="nc">Delivery</span> <span class="n">delivery</span><span class="o">,</span> <span class="nc">OrderItem</span><span class="o">...</span> <span class="n">orderItems</span><span class="o">){</span> <span class="c1">// ...ì€ args ëŠë‚Œ</span>
   <span class="nc">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Order</span><span class="o">();</span>
   <span class="n">order</span><span class="o">.</span><span class="na">setMember</span><span class="o">(</span><span class="n">member</span><span class="o">);</span> <span class="c1">// ì—°ê´€ê´€ê³„ ë§¤í•‘</span>
   <span class="n">order</span><span class="o">.</span><span class="na">setDelivery</span><span class="o">(</span><span class="n">delivery</span><span class="o">);</span> <span class="c1">// ì—°ê´€ê´€ê³„ ë§¤í•‘</span>
   <span class="k">for</span> <span class="o">(</span><span class="nc">OrderItem</span> <span class="n">orderItem</span> <span class="o">:</span> <span class="n">orderItems</span><span class="o">){</span>
       <span class="n">order</span><span class="o">.</span><span class="na">addOrderItem</span><span class="o">(</span><span class="n">orderItem</span><span class="o">);</span> <span class="c1">// ê° orderItemì— ëŒ€í•œ ì—°ê´€ê´€ê³„ ë§¤í•‘</span>
   <span class="o">}</span>
   <span class="n">order</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="nc">OrderStatus</span><span class="o">.</span><span class="na">ORDER</span><span class="o">);</span> <span class="c1">// ê°’ ì„¤ì •</span>
   <span class="n">order</span><span class="o">.</span><span class="na">setOrderDate</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">());</span> <span class="c1">// ê°’ ì„¤ì •</span>
   <span class="k">return</span> <span class="n">order</span><span class="o">;</span> <span class="c1">// ìƒì„±ëœ order ë°˜í™˜</span>
 <span class="o">}</span>
</code></pre></div>            </div>

            <ul>
              <li>ì´ëŸ° ìƒì„±ë©”ì„œë“œë§Œì„ ì‚¬ìš©í•˜ê²Œ í•˜ê¸° ìœ„í•´ì„œ Order Classì— <code class="language-plaintext highlighter-rouge">@NoArgsConstructor(access = AccessLevel.PROTECTED)</code> ë¥¼ ì¶”ê°€í•´ì¤Œ
                <ul>
                  <li><code class="language-plaintext highlighter-rouge">@NoArgsConstructor(access = AccessLevel.PROTECTED)</code> : preotected í˜•íƒœì˜ ìƒì„±ìë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•´ ì£¼ëŠ” ê²ƒ. ì¦‰, ì™¸ë¶€ì—ì„œ ìƒì„±ìë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ê²Œ í•˜ì—¬, ìƒìƒ ë©”ì„œë“œë¥¼ í•„ìˆ˜ë¡œ ì‚¬ìš©í•˜ê²Œë” í•˜ëŠ” ì „ëµ.</li>
                </ul>
              </li>
            </ul>
          </li>
          <li>[ì¤‘ìš”!] Serviceì— ë¹„ì§€ë‹ˆìŠ¤ë¥¼ ìƒˆë¡œ ë§Œë“œëŠ” ê²ƒì´ ì•„ë‹Œ, ìƒí’ˆ Entity ìì²´ì— ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì„ ì¶”ê°€í•˜ëŠ” ê²ƒ. (â€ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§â€)
            <ul>
              <li>ì¦‰, Order Entityì— ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ methodë¥¼ ì¶”ê°€í•´ì£¼ëŠ” ê²ƒ.</li>
              <li>ì£¼ë¬¸ ì·¨ì†Œ
                <ul>
                  <li>Serviceì—ì„œ Setterë¥¼ ì‚¬ìš©í•œ ê°’ ë³€ê²½ì´ ì•„ë‹Œ Entity ìì²´ì—ì„œ ë³€ê²½ -&gt; ë” ì•ˆì •ì ì¸ í”„ë¡œê·¸ë¨ ê°€ëŠ¥</li>
                </ul>

                <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">cancel</span><span class="o">(){</span>
  	  <span class="k">if</span><span class="o">(</span><span class="n">delivery</span><span class="o">.</span><span class="na">getStatus</span><span class="o">()</span> <span class="o">==</span> <span class="nc">DelivieryStatus</span><span class="o">.</span><span class="na">COMPLETE</span><span class="o">){</span>
  	      <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="s">"ì´ë¯¸ ë°°ì†¡ ì™„ë£Œëœ ìƒí’ˆì€ ì·¨ì†Œê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤."</span><span class="o">);</span>
  	  <span class="o">}</span>
                	
  	  <span class="k">this</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="nc">OrderStatus</span><span class="o">.</span><span class="na">CANCEL</span><span class="o">);</span>
  	  <span class="k">for</span> <span class="o">(</span><span class="nc">OrderItem</span> <span class="n">orderItem</span> <span class="o">:</span> <span class="n">orderItems</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// ì£¼ë¬¸ì—ì„œ ìš”êµ¬í–ˆë˜ itemë“¤ì— ëŒ€í•´ ì·¨ì†Œì‹œì¼œì¤Œ</span>
  	      <span class="n">orderItem</span><span class="o">.</span><span class="na">cancel</span><span class="o">();</span> <span class="c1">// Orderì™€ orderItemì€ ì¼ëŒ€ë‹¤ ì´ê¸°ì— ê·¸ 'ë‹¤'ì˜ ëª¨ë“  orderItem ê°ê°ì— ëŒ€í•´ ì·¨ì†Œí•´ì¤˜ì•¼ë¨</span>
  	  <span class="o">}</span>
  <span class="o">}</span>
</code></pre></div>                </div>
              </li>
              <li>ì „ì²´ ê°€ê²© ì¡°íšŒ
                <ul>
                  <li>ì£¼ë¬¸ì—ì„œì˜ ê° orderItemì—ëŠ” í•´ë‹¹ ì•„ì´í…œì´ ì–¼ë§Œì§€, ì•„ì´í…œì„ ëª‡ê°œë¥¼ ìƒ€ëŠ”ì§€ ì˜ ì •ë³´ê°€ ìˆìŒ, ì´ë“¤ì„ ê³±í•´ì„œ ë”í•´ì¤˜ì•¼ë¨</li>
                </ul>

                <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getTotalPrice</span><span class="o">(){</span>
          <span class="k">return</span> <span class="n">orderItems</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                  <span class="o">.</span><span class="na">mapToInt</span><span class="o">(</span><span class="nl">OrderItem:</span><span class="o">:</span><span class="n">getTotalPrice</span><span class="o">)</span>
                  <span class="o">.</span><span class="na">sum</span><span class="o">();</span> <span class="c1">// ê°€ê²©*ìˆ˜ëŸ‰ ì´ ëˆ„ì ë˜ì–´ì•¼ ë¨</span>
      <span class="o">}</span>
</code></pre></div>                </div>
              </li>
            </ul>
          </li>
        </ol>
      </li>
      <li>OrderItem Class
        <ol>
          <li>ìƒì„± ë©”ì„œë“œ â†’ <code class="language-plaintext highlighter-rouge">static OrderItem createOrderItem</code>
            <ul>
              <li>Order ì²˜ëŸ¼ ìƒì„±ë  ë•Œ ì—°ê´€ê´€ê³„ë„ ìˆê³  í•´ì„œ ê°„ë‹¨í•˜ì§€ ì•ŠìŒ.</li>
              <li>ê·¸ë˜ì„œ Serviceì—ì„œ ìƒì„±ë¡œì§ì„ êµ¬í˜„í•˜ëŠ” ê²ƒ ë³´ë‹¤ëŠ” Entity ìì²´ì—ì„œ ìƒì„±ë©”ì„œë“œë¥¼ êµ¬í˜„í•˜ëŠ” ê²ƒì´ ì‘ì§‘ë ¥ì„ ë†’ì„</li>
              <li>í•˜ì§€ë§Œ, OrderItemê³¼ Itemì€ ì–‘ë°©í–¥ì´ ì•„ë‹Œ, ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ì´ê¸°ì— ì—°ê´€ê´€ê³„ ë§¤í•‘ì€ í•„ìš” ì—†ì–´ì„œ, ìƒì„±ë©”ì„œë“œì— ì—°ê´€ê´€ê³„ ë§¤í•‘ ê´€ë ¨ methodëŠ” ì¡´ì¬í•˜ì§€ ì•ŠìŒ.</li>
              <li>í•˜ì§€ë§Œ, Itemì—ì„œ orderì— ë”°ë¥¸ ìˆ˜ëŸ‰ì´ ë³€ê²½ë˜ê¸° ë•Œë¬¸ì—, ê·¸ ë¶€ë¶„ì— ìˆì–´ì„œì˜ ì—°ê´€ê´€ê³„ì— ë”°ë¥¸ ì„¤ì •ì€ í•„ìš”í•¨.</li>
            </ul>

            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1">//==ìƒì„± ë©”ì„œë“œ==//</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="nc">OrderItem</span> <span class="nf">createOrderItem</span><span class="o">(</span><span class="nc">Item</span> <span class="n">item</span><span class="o">,</span> <span class="kt">int</span> <span class="n">orderPrice</span><span class="o">,</span> <span class="kt">int</span> <span class="n">count</span><span class="o">){</span>
     <span class="nc">OrderItem</span> <span class="n">orderItem</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OrderItem</span><span class="o">();</span>
     <span class="n">orderItem</span><span class="o">.</span><span class="na">setItem</span><span class="o">(</span><span class="n">item</span><span class="o">);</span> <span class="c1">// ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ ë§¤í•‘ </span>
     <span class="n">orderItem</span><span class="o">.</span><span class="na">setOrderPrice</span><span class="o">(</span><span class="n">orderPrice</span><span class="o">);</span> <span class="c1">// ê°’ ì„¤ì • </span>
     <span class="n">orderItem</span><span class="o">.</span><span class="na">setCount</span><span class="o">(</span><span class="n">count</span><span class="o">);</span> <span class="c1">// ê°’ ì„¤ì •</span>
            
     <span class="n">item</span><span class="o">.</span><span class="na">removeStock</span><span class="o">(</span><span class="n">count</span><span class="o">);</span> <span class="c1">// OrderItemì—ì„œ Itemê³¼ì˜ ì—°ê´€ê´€ê³„ ë©”ì„œë“œê°€ ì—†ëŠ” ì´ìœ . </span>
 		<span class="c1">//-&gt; Itemì—ì„œ OrderItemì€ ì¼ëŒ€ ë‹¤ ê´€ê³„ì´ì§€ë§Œ ì´ OrderItemì„ ë¦¬ìŠ¤íŠ¸ë¡œ ë‹´ì•„ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ ê·¸ì € ìˆ˜ëŸ‰ë§Œì„ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸</span>
     <span class="k">return</span> <span class="n">orderItem</span><span class="o">;</span>
 <span class="o">}</span>
</code></pre></div>            </div>

            <ul>
              <li>ì´ëŸ° ìƒì„±ë©”ì„œë“œë§Œì„ ì‚¬ìš©í•˜ê²Œ í•˜ê¸° ìœ„í•´ì„œ OrderItem Classì— <code class="language-plaintext highlighter-rouge">@NoArgsConstructor(access = AccessLevel.PROTECTED)</code> ë¥¼ ì¶”ê°€í•´ì¤Œ</li>
            </ul>
          </li>
          <li>ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§
            <ul>
              <li>ì£¼ë¬¸ ì·¨ì†Œ (Orderë° Itemê³¼ ì—°ê³„ë˜ì–´ ë™ì‘)
                <ul>
                  <li>ì£¼ë¬¸ ì·¨ì†ŒëŠ” Orderì— ì˜í•´ ì—°ê³„ë˜ì–´ ì‹¤í–‰ë˜ê³ , í•´ë‹¹ Orderitemì˜ ì·¨ì†ŒëŠ” ë‹¤ì‹œ Itemì— ì—°ê³„ë˜ì–´ ë™ì‘í•˜ê²Œ ë¨. (ì·¨ì†Œí•˜ë©´ Itemì˜ ìˆ˜ëŸ‰ì€ ëŠ˜ì–´ë‚˜ì•¼ ë¨.)</li>
                  <li><code class="language-plaintext highlighter-rouge">public void cancel() { getItem().addStock(count); }</code></li>
                </ul>
              </li>
              <li>ì „ì²´ ê°€ê²© ì¡°íšŒ
                <ul>
                  <li>OrderItemì´ Itemì„ í†µí•´ ë°›ì€ ìˆ˜ëŸ‰ê³¼ ê°€ê²©ì˜ ê³±ì„ í†µí•´ ì „ì²´ ê°€ê²©ì„ ì¡°íšŒí•  ìˆ˜ ìˆìŒ</li>
                  <li><code class="language-plaintext highlighter-rouge">public int getTotalPrice() { return getOrderPrice() * getCount(); }</code></li>
                </ul>
              </li>
            </ul>
          </li>
        </ol>
      </li>
    </ul>
  </li>
  <li>ì£¼ë¬¸ Repository ê°œë°œ
    <ul>
      <li>í•„ìš”í•œ annotationì¸ <code class="language-plaintext highlighter-rouge">@Repository</code> <code class="language-plaintext highlighter-rouge">@RequiredArgsConstructor</code> ë¥¼ ë‹¬ì•„ì£¼ê³  EntityManagerë¥¼ DI ë°›ì€ í›„ emì„ í†µí•´ ì €ì¥ê³¼ ë‹¨ê±´ì¡°íšŒ methodë¥¼ ë§Œë“¤ì–´ì£¼ë©´ ë¨.</li>
      <li>ì£¼ë¬¸ ì €ì¥ â†’ <code class="language-plaintext highlighter-rouge">public void save(Order order){ em.persist(order); }</code></li>
      <li>ì£¼ë¬¸ ë‹¨ê±´ ì¡°íšŒ â†’ <code class="language-plaintext highlighter-rouge">public Order findOne(Long id){ return em.find(Order.class, id); }</code></li>
      <li>ì£¼ë¬¸ ë‹¤ê±´ ì¡°íšŒ â†’  <code class="language-plaintext highlighter-rouge">public List&lt;Order&gt; findAll(OrderSearch orderSearch)</code> [ë™ì  ì¿¼ë¦¬ í•„ìš” â†’ QueryDSL(ì¶”í›„ ì´ê±¸ ì£¼ì œë¡œ ë°°ìš¸ ì˜ˆì •), í˜„ì¬ëŠ” JPA Criteriaë¡œ ë³´ì¶©]
        <ul>
          <li>OrderSearch class í•„ìš”.
            <ul>
              <li>ë™ì  ì¿¼ë¦¬ì˜ ì„ íƒì§€ê°€ ë˜ëŠ” ë‘ê°€ì§€ ë³€ìˆ˜ (íšŒì› ì´ë¦„, ì£¼ë¬¸ ìƒíƒœ)ë¥¼ ì €ì¥í•´ì„œ OrderServiceë¡œ ë³´ë‚´ì£¼ê²Œ ë˜ëŠ” ê°ì²´.</li>
              <li>íšŒì›ëª…ì´ ìˆìœ¼ë©´ íšŒì›ì— ë”°ë¥¸ whereë¬¸ , ì£¼ë¬¸ìƒíƒœê°€ ìˆìœ¼ë©´ ì£¼ë¬¸ìƒíƒœì— ë”°ë¥¸ whereë¬¸, ë‘˜ë‹¤ë©´ ë‘˜ë‹¤ì— ë”°ë¥¸ where ë¬¸ì´ ë™ì‘</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>ì£¼ë¬¸ Service ê°œë°œ
    <ul>
      <li><code class="language-plaintext highlighter-rouge">@Service</code> <code class="language-plaintext highlighter-rouge">@Transactional(readOnly = true)</code> <code class="language-plaintext highlighter-rouge">@RequiredArgsConstructor</code> annotationì„ í†µí•´ì„œ Bean ë“±ë¡, Transactionalì—ì„œ ë™ì‘, ìë™ìœ¼ë¡œ ìƒì„±ìë¥¼ í†µí•œ DI ì‹¤ì‹œ ì§„í–‰</li>
      <li>Order Serviceì—ì„œëŠ” Memberì™€ Itemì— ì ‘ê·¼í•˜ì—¬ Orderì— ì €ì¥í•˜ëŠ” ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì„ ê°€ì§€ê³  ìˆê¸°ì— orderRepository ë¿ë§Œ ì•„ë‹ˆë¼ memberRepository, itemRepository ë˜í•œ DIê°€ í•„ìš”í•¨.</li>
      <li>ì£¼ë¬¸ ê¸°ëŠ¥ â†’ <code class="language-plaintext highlighter-rouge">Long order(Long memberId, Long itemId, int count)</code>
        <ul>
          <li>ì—”í‹°í‹° ì¡°íšŒ
            <ul>
              <li>ë©¤ë²„idë¥¼ í†µí•´ Memberë¥¼ ê°€ì§€ê³  ì˜¤ëŠ” ê²ƒ. â†’ <code class="language-plaintext highlighter-rouge">memberRepository.findOne(memberId);</code></li>
              <li>Item idë¥¼ í†µí•´ Itemì„ ê°€ì§€ê³  ì˜¤ëŠ” ê²ƒ. â†’ <code class="language-plaintext highlighter-rouge">itemRepository.findOne(itemId);</code></li>
            </ul>
          </li>
          <li>ë°°ì†¡ì •ë³´ ìƒì„±
            <ul>
              <li>Delivery Entity ìƒì„± â†’ <code class="language-plaintext highlighter-rouge">Delivery delivery = new Delivery(); delivery.setAddress(member.getAddress());</code></li>
            </ul>
          </li>
          <li>ì£¼ë¬¸ ìƒí’ˆ ìƒì„±
            <ul>
              <li>Entity ê´€ê³„ë„ë¥¼ ì°¸ê³ í•˜ë©´ Orderì— ë°”ë¡œ Itemì„ ë„£ì–´ ì£¼ëŠ” ê²ƒì´ ì•„ë‹Œ OrderItemì„ ê±°ì³ì„œ ì§‘ì–´ë„£ìŒ -&gt; ë‹¤ëŒ€ë‹¤ ê´€ê³„ì´ê¸° ë•Œë¬¸</li>
              <li>OrderItem ìì²´ëŠ” ì—°ê´€ê´€ê³„ë„ ìˆê³  ê°’ë“¤ë„ ë§ê¸°ì— Entity ìì²´ì— ìƒì„±ë©”ì„œë“œë¥¼ ë§Œë“¤ì–´ ë†“ì•˜ê¸°ì—, ì´ë¥¼ í™œìš©. â†’ <code class="language-plaintext highlighter-rouge">OrderItem orderItem = OrderItem.***createOrderItem***(item, item.getPrice(), count);</code></li>
              <li>ë˜í•œ, Order ì „ì— OrderItemì„ ìƒì„±í•˜ì—¬ Order ìƒì„±ë©”ì„œë“œì˜ ì¸ìë¡œ ë„£ì–´ì¤˜ì•¼ í•˜ê¸°ì— Order ì „ì— ìƒì„±.</li>
            </ul>
          </li>
          <li>ì£¼ë¬¸ ìƒì„±
            <ul>
              <li>Orderë„ Entity ìì²´ê°€ ê°„ë‹¨í•˜ì§€ ì•Šê¸°ì— Entity ìì²´ì— ìƒì„± ë©”ì„œë“œë¥¼ ë§Œë“¤ì—ˆì—ˆìŒ</li>
              <li><code class="language-plaintext highlighter-rouge">Order order = Order.*createOrder*(member, delivery, orderItem);</code></li>
            </ul>
          </li>
          <li>ì£¼ë¬¸ ì €ì¥
            <ul>
              <li><code class="language-plaintext highlighter-rouge">orderRepository.save(order);</code> : ì•ì„  ê³¼ì •ë“¤ì„ ë°”íƒ•ìœ¼ë¡œ orderRepositoryë¥¼ í†µí•´ save ì§„í–‰.</li>
              <li>ì›ë˜ê°™ìœ¼ë©´ orderì™€ ì—°ê´€ë˜ì–´ ìˆì§€ë§Œ ë”°ë¡œ persistë¥¼ ì§„í–‰í•˜ì§€ ì•Šì•˜ë˜ delivery, orderItemë„ ë”°ë¡œ save í•˜ì—¬ presistí•´ì¤˜ì•¼ë¨. <strong>BUT!</strong> ì´ ë‘˜ë‹¤ Order Entity ì† ì—°ê´€ê´€ê³„ì—ì„œ <code class="language-plaintext highlighter-rouge">cascade = CascadeType.ALL</code> ë¡œ ì„¤ì • í–ˆê¸°ì— ìë™ìœ¼ë¡œ ì €ì¥ë¨</li>
              <li>ì´ëŠ” Order Entityê°€ emì„ persist ë  ê²½ìš° ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì•ˆìœ¼ë¡œ ë“¤ì–´ê°€ê¸°ì— ê°€ëŠ¥í•œ ë¶€ë¶„
                <ul>
                  <li>ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— Orderê°€ ì˜¬ë¼ê°€ê²Œ ë˜ë©´ ê·¸ì— ì—°ê³„ëœ Delivery, OrderItem ë˜í•œ ì˜¬ë¼ê°€ê²Œ ë¨. ì´ë•Œ Transactional ì—ì„œ commitì„ ì§„í–‰í•˜ë©´, <code class="language-plaintext highlighter-rouge">cascade = CascadeType.ALL</code> ì¸ ì—°ê³„ Entityì— ëŒ€í•´ì„œë„ commitì„ í•´ì£¼ëŠ” ê²ƒ!</li>
                  <li><code class="language-plaintext highlighter-rouge">cascade = CascadeType.ALL</code> ì€ ë‹¤ë¥¸ Entityì—ì„œ ì°¸ì¡°í•˜ì§€ ì•Šê³  í•´ë‹¹ ê°ì²´ì—ì„œë§Œ ì°¸ì¡°ë¥¼ í• ë•Œ ì‚¬ìš©í•´ì•¼ë¨.</li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li>ì·¨ì†Œ ê¸°ëŠ¥ <strong>[ì¤‘ìš”! â†’ JPAì˜ ì¥ì ì„ í™•ì¸í•  ìˆ˜ ìˆëŠ” ë¶€ë¶„] â†’</strong> <code class="language-plaintext highlighter-rouge">void cancelOrder(Long orderId)</code>
        <ul>
          <li>ì£¼ë¬¸ Entity ì¡°íšŒ â†’ <code class="language-plaintext highlighter-rouge">orderRepository.findOne(orderId);</code></li>
          <li>ì£¼ë¬¸ ì·¨ì†Œ â†’ <code class="language-plaintext highlighter-rouge">order.cancel();</code>
            <ul>
              <li>ë§Œì•½ JPAë¥¼ í™œìš©í•˜ì§€ ì•Šì•˜ë”ë¼ë©´ -&gt; cancelí•˜ë©´ì„œ ë³€ê²½ëœ <strong>orderì˜ state</strong>, <strong>orderitemsì˜ itemì˜ ìˆ˜ëŸ‰</strong>ë“¤ì„ ëª¨ë‘ ë³€ê²½í•˜ê³  ë‹¤ì‹œ DBì— ì—…ë°ì´íŠ¸ ì‹œì¼œì¤˜ì•¼ë¨ (ì¦‰, ê°ê°ì— ëŒ€í•œ queryë¥¼ ë‚ ë ¤ì¤˜ì•¼ ëœë‹¤ëŠ” ê²ƒ.)</li>
              <li>í•˜ì§€ë§Œ JPAëŠ” Entityë‚´ì—ì„œ ë³€ê²½ëœ ì ì„ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ í•´ì¤Œ. ì¦‰, ë³€ê²½ëœ ì§€ì ì„ ì°¾ì•„ì„œ ê·¸ ì§€ì ì— ê´€í•œ update queryë¥¼ ìë™ìœ¼ë¡œ DBë¡œ ë³´ë‚¸ë‹¤ëŠ” ê²ƒ -&gt; dirty checking(ë³€ê²½ ê°ì§€)</li>
              <li>ì´ê²Œ ê°€ëŠ¥í•œ ì´ìœ ëŠ” ì§€ê¸ˆ ì·¨ì†Œí•˜ë ¤ëŠ” ì£¼ë¬¸ ìì²´ê°€ emì„ í†µí•´ DBì—ì„œ ê°€ì ¸ì™”ê¸° ë•Œë¬¸ (<code class="language-plaintext highlighter-rouge">orderRepository.findOne(orderId);</code>) â†’ emì´ DBì—ì„œ Entityë¥¼ ê°€ì ¸ì˜¤ê²Œ ë˜ë©´, ê·¸ EntityëŠ” emì˜ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ë¨¸ë¬´ë¥´ê²Œ ë¨. â†’ ì´ë•Œ ê·¸ Entityì˜ ê°’ë“¤ì´ ë³€ê²½ë˜ê²Œ ë˜ë©´ emì€ ì´ë¥¼ ê°ì§€í•˜ê³  (ë³€ê²½ê°ì§€, dirty checking) í•´ë‹¹ methodì˜ Transactionalì´ ëë‚˜ commitì´ ì´ë£¨ì–´ì§€ë©´, ì´ì™€ ê´€ë ¨ëœ ëª¨ë“  qeuryë¥¼ ìë™ìœ¼ë¡œ ë‚ ë ¤ì£¼ëŠ” ê²ƒ.</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>ì£¼ë¬¸ ì¡°íšŒ â†’ ë™ì  ì¿¼ë¦¬ ì‚¬ìš© (ë’¤ì—ì„œ ì„¤ëª…)</li>
    </ul>

    <aside>

ğŸ’¡ <strong> [ì°¸ê³ ] </strong> <br /> ì£¼ë¬¸ ì„œë¹„ìŠ¤ì˜ ì£¼ë¬¸ê³¼ ì£¼ë¬¸ ì·¨ì†Œ ë©”ì„œë“œë¥¼ ë³´ë©´ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ëŒ€ë¶€ë¶„ì´ ì—”í‹°í‹°ì— ìˆë‹¤. ì„œë¹„ìŠ¤ ê³„ì¸µì€ ë‹¨ìˆœíˆ ì—”í‹°í‹°ì— í•„ìš”í•œ ìš”ì²­ì„ ìœ„ì„í•˜ëŠ” ì—­í• ì„ í•œë‹¤. ì´ì²˜ëŸ¼ ì—”í‹°í‹°ê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ê°€ì§€ê³  ê°ì²´ ì§€í–¥ì˜ íŠ¹ì„±ì„ ì ê·¹ í™œìš©í•˜ëŠ” ê²ƒì„ <strong> ë„ë©”ì¸ ëª¨ë¸ íŒ¨í„´ </strong>ì´ë¼ í•œë‹¤. ë°˜ëŒ€ë¡œ ì—”í‹°í‹°ì—ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ê±°ì˜ ì—†ê³  ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ ëŒ€ë¶€ë¶„ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬í•˜ëŠ” ê²ƒì„ íŠ¸ëœì­ì…˜ ìŠ¤í¬ë¦½íŠ¸ íŒ¨í„´ì´ë¼ í•œë‹¤. (ë³´í†µ JPAë‚˜ ORMì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ë„ë©”ì¸ ëª¨ë¸ íŒ¨í„´ì„ ì´ìš©í•¨)

  </aside>
  </li>
  <li>ì£¼ë¬¸ ê¸°ëŠ¥ Test
    <ul>
      <li><code class="language-plaintext highlighter-rouge">@SpringBootTest @Transactional</code> annotation í•„ìˆ˜ + <code class="language-plaintext highlighter-rouge">@Test</code></li>
      <li>ì‚¬ì‹¤ TestëŠ” SpringBoot ìœ„ì—ì„œ ì§„í–‰í•˜ëŠ” ê²ƒ ë³´ë‹¤ëŠ” SpringBoot ì—†ì´, ì¦‰ DB ì—°ê²° ì—†ì´ ë‹¨ì¼ì ìœ¼ë¡œ ë¹„ì§€ë‹ˆìŠ¤ë§Œì„ ì²´í¬í•˜ëŠ” Testê°€ ì¢‹ì€ Test. (í•˜ì§€ë§Œ ì—¬ê¸°ì„  JPAì˜ ë™ì‘ì„ í™•ì¸í•˜ëŠ” ê²ƒì´ê¸°ì— SpringBoot ìœ„ì—ì„œ Test ì§„í–‰)</li>
      <li>ìƒí’ˆ ì£¼ë¬¸ Test
        <ul>
          <li>ì£¼ë¬¸ì´ ë“¤ì–´ ê°”ì„ ë•Œ â†’ ì£¼ë¬¸ ìƒíƒœ, ì£¼ë¬¸ëœ ìƒí’ˆì˜ ì¢…ë¥˜, ì£¼ë¬¸ ì´ ê¸ˆì•¡, ì£¼ë¬¸ í›„ í•´ë‹¹ ìƒí’ˆì˜ ë‚¨ì€ ìˆ˜ëŸ‰ì´ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì— ë§ê²Œ ì˜ ì„¤ì • ë˜ëŠ”ì§€ <em><code class="language-plaintext highlighter-rouge">assertEquals(expected, actual, message)</code></em> ë¥¼ í†µí•´ í™•ì¸</li>
          <li>given : <code class="language-plaintext highlighter-rouge">Member member, Item item, int orderCount</code></li>
          <li>when : <code class="language-plaintext highlighter-rouge">Long orderId = orderService.order(member.getId(), item.getId(), orderCount);</code></li>
          <li>
            <p>then</p>

            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nc">Order</span> <span class="n">ordered</span> <span class="o">=</span> <span class="n">orderRepository</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">orderId</span><span class="o">);</span>
  <span class="n">assertEquals</span><span class="o">(</span><span class="nc">OrderStatus</span><span class="o">.</span><span class="na">ORDER</span><span class="o">,</span> <span class="n">ordered</span><span class="o">.</span><span class="na">getStatus</span><span class="o">(),</span> <span class="s">"ìƒí’ˆ ì£¼ë¬¸ ì‹œ ìƒíƒœëŠ” ORDER"</span><span class="o">);</span>
  <span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="n">ordered</span><span class="o">.</span><span class="na">getOrderItems</span><span class="o">().</span><span class="na">size</span><span class="o">(),</span> <span class="s">"ì£¼ë¬¸í•œ ìƒí’ˆ ì¢…ë¥˜ ìˆ˜ê°€ ì •í™•í•´ì•¼ í•œë‹¤"</span><span class="o">);</span>
  <span class="n">assertEquals</span><span class="o">(</span><span class="mi">10000</span><span class="o">*</span><span class="mi">2</span><span class="o">,</span> <span class="n">ordered</span><span class="o">.</span><span class="na">getTotalPrice</span><span class="o">(),</span> <span class="s">"ì£¼ë¬¸ ê°€ê²©ì€ ê°€ê²© * ìˆ˜ëŸ‰"</span><span class="o">);</span>
  <span class="n">assertEquals</span><span class="o">(</span><span class="mi">20</span><span class="o">-</span><span class="mi">2</span><span class="o">,</span> <span class="n">item</span><span class="o">.</span><span class="na">getStockQuantity</span><span class="o">(),</span> <span class="s">"ì£¼ë¬¸ ìˆ˜ëŸ‰ë§Œí¼ ì¬ê³ ê°€ ì¤„ì–´ì•¼ í•œë‹¤."</span><span class="o">);</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>ìƒí’ˆì£¼ë¬¸ ì‹œ ì¬ê³ ìˆ˜ëŸ‰ ì´ˆê³¼ Test
        <ul>
          <li>ì£¼ë¬¸í•œ ìˆ˜ëŸ‰ì´ ì¬ê³ ë³´ë‹¤ ë„˜ì„ ê²½ìš° <em><code class="language-plaintext highlighter-rouge">assertEquals(expected, actual)</code></em>ë¥¼ í†µí•´ Exceptionì´ ë°œìƒí•˜ê³  ê·¸ Exception messageê°€ expectedì™€ ë™ì¼í•œì§€ í™•ì¸</li>
          <li>given : <code class="language-plaintext highlighter-rouge">Member member, Item item, int orderCount</code> â†’ ì—¬ê¸°ì„œ orderCountê°€ itemì— ì„¤ì •ëœ ìˆ˜ëŸ‰ë³´ë‹¤ ë§ê²Œ ì„¤ì •</li>
          <li>when : <code class="language-plaintext highlighter-rouge">NotEnoughStockException thrown = *assertThrows*(NotEnoughStockException.class, () -&gt; orderService.order(member.getId(), book.getId(), orderCount));</code> â†’ ì´ˆê³¼ëœ ìˆ˜ëŸ‰ìœ¼ë¡œ ì£¼ë¬¸ì„ í•  ë•Œì˜ íŠ€ì–´ë‚˜ì˜¤ëŠ” Exceptionì„ catchí•´ì„œ ì €ì¥í•´ë‘ </li>
          <li>then : *<code class="language-plaintext highlighter-rouge">assertEquals*("Not Enough Stock now!!", thrown.getMessage());</code> â†’ ë™ì¼í•œ messageë¡œ Exceptionì´ ë°œìƒí–ˆëŠ”ì§€ í™•ì¸</li>
        </ul>
      </li>
      <li>ì£¼ë¬¸ ì·¨ì†Œ Test
        <ul>
          <li>ì£¼ë¬¸ ì·¨ì†Œ ì‹œ â†’ orderì˜ statusê°€ CANCEL ë¡œ ë³€í•˜ëŠ”ì§€ í™•ì¸, ì·¨ì†Œ ìˆ˜ëŸ‰ì´ ì›ë³µë˜ëŠ” ì§€ í™•ì¸</li>
          <li>given : <code class="language-plaintext highlighter-rouge">Member member, Item item, int orderCount</code>, <code class="language-plaintext highlighter-rouge">Long orderedId = orderService.order(member.getId(), item.getId(), orderCount);</code></li>
          <li>when : <code class="language-plaintext highlighter-rouge">orderService.cancelOrder(orderedId);</code></li>
          <li>
            <p>then</p>

            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nc">Order</span> <span class="n">ordered</span> <span class="o">=</span> <span class="n">orderRepository</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">orderedId</span><span class="o">);</span>
  <span class="n">assertEquals</span><span class="o">(</span><span class="nc">OrderStatus</span><span class="o">.</span><span class="na">CANCEL</span><span class="o">,</span> <span class="n">ordered</span><span class="o">.</span><span class="na">getStatus</span><span class="o">(),</span> <span class="s">"ì£¼ë¬¸ ì·¨ì†Œ ì‹œ ìƒíƒœëŠ” CANCEL ì´ë‹¤."</span><span class="o">);</span>
  <span class="n">assertEquals</span><span class="o">(</span><span class="mi">20</span><span class="o">,</span> <span class="n">item</span><span class="o">.</span><span class="na">getStockQuantity</span><span class="o">(),</span> <span class="s">"ì·¨ì†Œëœ ìƒí’ˆì€ ì¬ê³ ê°€ ë‹¤ì‹œ ì›ë³µë˜ì–´ì•¼ í•¨"</span><span class="o">);</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

:ET